import{r as C,I as Nt,_ as me,a as N,b as ie,c as te,d as he,e as A,K as bn,R as ne,C as wn,f as yt,g as D,h as Sn,i as Ar,m as Pr,j as tr,k as ai,l as xn,n as vt,u as mi,o as Un,p as En,w as Oe,q as Cn,s as Ir,t as Fn,v as Tr,x as Br,y as Ot,z as $,A as Dt,B as Vt,D as Ee,E as wt,F as Ze,G as Be,H as ir,J as kn,L as zr,M as je,N as Rr,O as An,P as Pn,W as In,T as Tn,Q as Bn,S as zn,U as Rn,V as Ln,X as Te,Y as Mn,Z as Nn}from"./index-L5IkEMt5.js";var On={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"},Dn=function(r,a){return C.createElement(Nt,me({},r,{ref:a,icon:On}))},Vn=C.forwardRef(Dn),Gn={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"},Hn=function(r,a){return C.createElement(Nt,me({},r,{ref:a,icon:Gn}))},$n=C.forwardRef(Hn),Yn={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"},Wn=function(r,a){return C.createElement(Nt,me({},r,{ref:a,icon:Yn}))},jn=C.forwardRef(Wn),qn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"},Zn=function(r,a){return C.createElement(Nt,me({},r,{ref:a,icon:qn}))},Kn=C.forwardRef(Zn),Xn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"},Jn=function(r,a){return C.createElement(Nt,me({},r,{ref:a,icon:Xn}))},Qn=C.forwardRef(Jn),es=`accept acceptCharset accessKey action allowFullScreen allowTransparency
    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge
    charSet checked classID className colSpan cols content contentEditable contextMenu
    controls coords crossOrigin data dateTime default defer dir disabled download draggable
    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder
    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity
    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media
    mediaGroup method min minLength multiple muted name noValidate nonce open
    optimum pattern placeholder poster preload radioGroup readOnly rel required
    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected
    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style
    summary tabIndex target title type useMap value width wmode wrap`,ts=`onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown
    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick
    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown
    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel
    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough
    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata
    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError`,is="".concat(es," ").concat(ts).split(/[\s\n]+/),rs="aria-",ns="data-";function rr(c,r){return c.indexOf(r)===0}function Lr(c){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a;r===!1?a={aria:!0,data:!0,attr:!0}:r===!0?a={aria:!0}:a=N({},r);var o={};return Object.keys(c).forEach(function(l){(a.aria&&(l==="role"||rr(l,rs))||a.data&&rr(l,ns)||a.attr&&is.includes(l))&&(o[l]=c[l])}),o}var Mr=C.forwardRef(function(c,r){var a=c.prefixCls,o=c.style,l=c.className,u=c.duration,f=u===void 0?4.5:u,s=c.showProgress,_=c.pauseOnHover,y=_===void 0?!0:_,m=c.eventKey,x=c.content,e=c.closable,t=c.closeIcon,n=t===void 0?"x":t,d=c.props,h=c.onClick,g=c.onNoticeClose,p=c.times,v=c.hovering,b=C.useState(!1),S=ie(b,2),U=S[0],F=S[1],k=C.useState(0),w=ie(k,2),I=w[0],P=w[1],R=C.useState(0),z=ie(R,2),T=z[0],O=z[1],L=v||U,Y=f>0&&s,re=function(){g(m)},ee=function(H){(H.key==="Enter"||H.code==="Enter"||H.keyCode===bn.ENTER)&&re()};C.useEffect(function(){if(!L&&f>0){var q=Date.now()-T,H=setTimeout(function(){re()},f*1e3-T);return function(){y&&clearTimeout(H),O(Date.now()-q)}}},[f,L,p]),C.useEffect(function(){if(!L&&Y&&(y||T===0)){var q=performance.now(),H,J=function Ie(){cancelAnimationFrame(H),H=requestAnimationFrame(function(yi){var et=yi+T-q,De=Math.min(et/(f*1e3),1);P(De*100),De<1&&Ie()})};return J(),function(){y&&cancelAnimationFrame(H)}}},[f,T,L,Y,p]);var se=C.useMemo(function(){return te(e)==="object"&&e!==null?e:e?{closeIcon:n}:{}},[e,n]),V=Lr(se,!0),Pe=100-(!I||I<0?0:I>100?100:I),ae="".concat(a,"-notice");return C.createElement("div",me({},d,{ref:r,className:he(ae,l,A({},"".concat(ae,"-closable"),e)),style:o,onMouseEnter:function(H){var J;F(!0),d==null||(J=d.onMouseEnter)===null||J===void 0||J.call(d,H)},onMouseLeave:function(H){var J;F(!1),d==null||(J=d.onMouseLeave)===null||J===void 0||J.call(d,H)},onClick:h}),C.createElement("div",{className:"".concat(ae,"-content")},x),e&&C.createElement("a",me({tabIndex:0,className:"".concat(ae,"-close"),onKeyDown:ee,"aria-label":"Close"},V,{onClick:function(H){H.preventDefault(),H.stopPropagation(),re()}}),se.closeIcon),Y&&C.createElement("progress",{className:"".concat(ae,"-progress"),max:"100",value:Pe},Pe+"%"))}),Nr=ne.createContext({}),ss=function(r){var a=r.children,o=r.classNames;return ne.createElement(Nr.Provider,{value:{classNames:o}},a)},nr=8,sr=3,ar=16,as=function(r){var a={offset:nr,threshold:sr,gap:ar};if(r&&te(r)==="object"){var o,l,u;a.offset=(o=r.offset)!==null&&o!==void 0?o:nr,a.threshold=(l=r.threshold)!==null&&l!==void 0?l:sr,a.gap=(u=r.gap)!==null&&u!==void 0?u:ar}return[!!r,a]},os=["className","style","classNames","styles"],ls=function(r){var a=r.configList,o=r.placement,l=r.prefixCls,u=r.className,f=r.style,s=r.motion,_=r.onAllNoticeRemoved,y=r.onNoticeClose,m=r.stack,x=C.useContext(Nr),e=x.classNames,t=C.useRef({}),n=C.useState(null),d=ie(n,2),h=d[0],g=d[1],p=C.useState([]),v=ie(p,2),b=v[0],S=v[1],U=a.map(function(L){return{config:L,key:String(L.key)}}),F=as(m),k=ie(F,2),w=k[0],I=k[1],P=I.offset,R=I.threshold,z=I.gap,T=w&&(b.length>0||U.length<=R),O=typeof s=="function"?s(o):s;return C.useEffect(function(){w&&b.length>1&&S(function(L){return L.filter(function(Y){return U.some(function(re){var ee=re.key;return Y===ee})})})},[b,U,w]),C.useEffect(function(){var L;if(w&&t.current[(L=U[U.length-1])===null||L===void 0?void 0:L.key]){var Y;g(t.current[(Y=U[U.length-1])===null||Y===void 0?void 0:Y.key])}},[U,w]),ne.createElement(wn,me({key:o,className:he(l,"".concat(l,"-").concat(o),e==null?void 0:e.list,u,A(A({},"".concat(l,"-stack"),!!w),"".concat(l,"-stack-expanded"),T)),style:f,keys:U,motionAppear:!0},O,{onAllRemoved:function(){_(o)}}),function(L,Y){var re=L.config,ee=L.className,se=L.style,V=L.index,Pe=re,ae=Pe.key,q=Pe.times,H=String(ae),J=re,Ie=J.className,yi=J.style,et=J.classNames,De=J.styles,gn=yt(J,os),vi=U.findIndex(function(Wt){return Wt.key===H}),Yt={};if(w){var bt=U.length-1-(vi>-1?vi:V-1),Qi=o==="top"||o==="bottom"?"-50%":"0";if(bt>0){var bi,wi,Si;Yt.height=T?(bi=t.current[H])===null||bi===void 0?void 0:bi.offsetHeight:h==null?void 0:h.offsetHeight;for(var er=0,xi=0;xi<bt;xi++){var Ui;er+=((Ui=t.current[U[U.length-1-xi].key])===null||Ui===void 0?void 0:Ui.offsetHeight)+z}var _n=(T?er:bt*P)*(o.startsWith("top")?1:-1),yn=!T&&h!==null&&h!==void 0&&h.offsetWidth&&(wi=t.current[H])!==null&&wi!==void 0&&wi.offsetWidth?((h==null?void 0:h.offsetWidth)-P*2*(bt<3?bt:3))/((Si=t.current[H])===null||Si===void 0?void 0:Si.offsetWidth):1;Yt.transform="translate3d(".concat(Qi,", ").concat(_n,"px, 0) scaleX(").concat(yn,")")}else Yt.transform="translate3d(".concat(Qi,", 0, 0)")}return ne.createElement("div",{ref:Y,className:he("".concat(l,"-notice-wrapper"),ee,et==null?void 0:et.wrapper),style:N(N(N({},se),Yt),De==null?void 0:De.wrapper),onMouseEnter:function(){return S(function(Ve){return Ve.includes(H)?Ve:[].concat(D(Ve),[H])})},onMouseLeave:function(){return S(function(Ve){return Ve.filter(function(vn){return vn!==H})})}},ne.createElement(Mr,me({},gn,{ref:function(Ve){vi>-1?t.current[H]=Ve:delete t.current[H]},prefixCls:l,classNames:et,styles:De,className:he(Ie,e==null?void 0:e.notice),style:yi,times:q,key:ae,eventKey:ae,onNoticeClose:y,hovering:w&&b.length>0})))})},ds=C.forwardRef(function(c,r){var a=c.prefixCls,o=a===void 0?"rc-notification":a,l=c.container,u=c.motion,f=c.maxCount,s=c.className,_=c.style,y=c.onAllRemoved,m=c.stack,x=c.renderNotifications,e=C.useState([]),t=ie(e,2),n=t[0],d=t[1],h=function(w){var I,P=n.find(function(R){return R.key===w});P==null||(I=P.onClose)===null||I===void 0||I.call(P),d(function(R){return R.filter(function(z){return z.key!==w})})};C.useImperativeHandle(r,function(){return{open:function(w){d(function(I){var P=D(I),R=P.findIndex(function(O){return O.key===w.key}),z=N({},w);if(R>=0){var T;z.times=(((T=I[R])===null||T===void 0?void 0:T.times)||0)+1,P[R]=z}else z.times=0,P.push(z);return f>0&&P.length>f&&(P=P.slice(-f)),P})},close:function(w){h(w)},destroy:function(){d([])}}});var g=C.useState({}),p=ie(g,2),v=p[0],b=p[1];C.useEffect(function(){var k={};n.forEach(function(w){var I=w.placement,P=I===void 0?"topRight":I;P&&(k[P]=k[P]||[],k[P].push(w))}),Object.keys(v).forEach(function(w){k[w]=k[w]||[]}),b(k)},[n]);var S=function(w){b(function(I){var P=N({},I),R=P[w]||[];return R.length||delete P[w],P})},U=C.useRef(!1);if(C.useEffect(function(){Object.keys(v).length>0?U.current=!0:U.current&&(y==null||y(),U.current=!1)},[v]),!l)return null;var F=Object.keys(v);return Sn.createPortal(C.createElement(C.Fragment,null,F.map(function(k){var w=v[k],I=C.createElement(ls,{key:k,configList:w,placement:k,prefixCls:o,className:s==null?void 0:s(k),style:_==null?void 0:_(k),motion:u,onNoticeClose:h,onAllNoticeRemoved:S,stack:m});return x?x(I,{prefixCls:o,key:k}):I})),l)}),cs=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],hs=function(){return document.body},or=0;function us(){for(var c={},r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.forEach(function(l){l&&Object.keys(l).forEach(function(u){var f=l[u];f!==void 0&&(c[u]=f)})}),c}function fs(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=c.getContainer,a=r===void 0?hs:r,o=c.motion,l=c.prefixCls,u=c.maxCount,f=c.className,s=c.style,_=c.onAllRemoved,y=c.stack,m=c.renderNotifications,x=yt(c,cs),e=C.useState(),t=ie(e,2),n=t[0],d=t[1],h=C.useRef(),g=C.createElement(ds,{container:n,ref:h,prefixCls:l,motion:o,maxCount:u,className:f,style:s,onAllRemoved:_,stack:y,renderNotifications:m}),p=C.useState([]),v=ie(p,2),b=v[0],S=v[1],U=C.useMemo(function(){return{open:function(k){var w=us(x,k);(w.key===null||w.key===void 0)&&(w.key="rc-notification-".concat(or),or+=1),S(function(I){return[].concat(D(I),[{type:"open",config:w}])})},close:function(k){S(function(w){return[].concat(D(w),[{type:"close",key:k}])})},destroy:function(){S(function(k){return[].concat(D(k),[{type:"destroy"}])})}}},[]);return C.useEffect(function(){d(a())}),C.useEffect(function(){h.current&&b.length&&(b.forEach(function(F){switch(F.type){case"open":h.current.open(F.config);break;case"close":h.current.close(F.key);break;case"destroy":h.current.destroy();break}}),S(function(F){return F.filter(function(k){return!b.includes(k)})}))},[b]),[U,g]}const ps=c=>{const{componentCls:r,iconCls:a,boxShadow:o,colorText:l,colorSuccess:u,colorError:f,colorWarning:s,colorInfo:_,fontSizeLG:y,motionEaseInOutCirc:m,motionDurationSlow:x,marginXS:e,paddingXS:t,borderRadiusLG:n,zIndexPopup:d,contentPadding:h,contentBg:g}=c,p=`${r}-notice`,v=new tr("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:t,transform:"translateY(0)",opacity:1}}),b=new tr("MessageMoveOut",{"0%":{maxHeight:c.height,padding:t,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),S={padding:t,textAlign:"center",[`${r}-custom-content`]:{display:"flex",alignItems:"center"},[`${r}-custom-content > ${a}`]:{marginInlineEnd:e,fontSize:y},[`${p}-content`]:{display:"inline-block",padding:h,background:g,borderRadius:n,boxShadow:o,pointerEvents:"all"},[`${r}-success > ${a}`]:{color:u},[`${r}-error > ${a}`]:{color:f},[`${r}-warning > ${a}`]:{color:s},[`${r}-info > ${a},
      ${r}-loading > ${a}`]:{color:_}};return[{[r]:Object.assign(Object.assign({},ai(c)),{color:l,position:"fixed",top:e,width:"100%",pointerEvents:"none",zIndex:d,[`${r}-move-up`]:{animationFillMode:"forwards"},[`
        ${r}-move-up-appear,
        ${r}-move-up-enter
      `]:{animationName:v,animationDuration:x,animationPlayState:"paused",animationTimingFunction:m},[`
        ${r}-move-up-appear${r}-move-up-appear-active,
        ${r}-move-up-enter${r}-move-up-enter-active
      `]:{animationPlayState:"running"},[`${r}-move-up-leave`]:{animationName:b,animationDuration:x,animationPlayState:"paused",animationTimingFunction:m},[`${r}-move-up-leave${r}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[r]:{[`${p}-wrapper`]:Object.assign({},S)}},{[`${r}-notice-pure-panel`]:Object.assign(Object.assign({},S),{padding:0,textAlign:"start"})}]},ms=c=>({zIndexPopup:c.zIndexPopupBase+xn+10,contentBg:c.colorBgElevated,contentPadding:`${(c.controlHeightLG-c.fontSize*c.lineHeight)/2}px ${c.paddingSM}px`}),Or=Ar("Message",c=>{const r=Pr(c,{height:150});return[ps(r)]},ms);var gs=function(c,r){var a={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&r.indexOf(o)<0&&(a[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(c);l<o.length;l++)r.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(c,o[l])&&(a[o[l]]=c[o[l]]);return a};const _s={info:C.createElement(Qn,null),success:C.createElement(Vn,null),error:C.createElement($n,null),warning:C.createElement(Kn,null),loading:C.createElement(Un,null)},Dr=c=>{let{prefixCls:r,type:a,icon:o,children:l}=c;return C.createElement("div",{className:he(`${r}-custom-content`,`${r}-${a}`)},o||_s[a],C.createElement("span",null,l))},ys=c=>{const{prefixCls:r,className:a,type:o,icon:l,content:u}=c,f=gs(c,["prefixCls","className","type","icon","content"]),{getPrefixCls:s}=C.useContext(vt),_=r||s("message"),y=mi(_),[m,x,e]=Or(_,y);return m(C.createElement(Mr,Object.assign({},f,{prefixCls:_,className:he(a,x,`${_}-notice-pure-panel`,e,y),eventKey:"pure",duration:null,content:C.createElement(Dr,{prefixCls:_,type:o,icon:l},u)})))};function vs(c,r){return{motionName:r??`${c}-move-up`}}function ji(c){let r;const a=new Promise(l=>{r=c(()=>{l(!0)})}),o=()=>{r==null||r()};return o.then=(l,u)=>a.then(l,u),o.promise=a,o}var bs=function(c,r){var a={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&r.indexOf(o)<0&&(a[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(c);l<o.length;l++)r.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(c,o[l])&&(a[o[l]]=c[o[l]]);return a};const ws=8,Ss=3,xs=c=>{let{children:r,prefixCls:a}=c;const o=mi(a),[l,u,f]=Or(a,o);return l(C.createElement(ss,{classNames:{list:he(u,f,o)}},r))},Us=(c,r)=>{let{prefixCls:a,key:o}=r;return C.createElement(xs,{prefixCls:a,key:o},c)},Es=C.forwardRef((c,r)=>{const{top:a,prefixCls:o,getContainer:l,maxCount:u,duration:f=Ss,rtl:s,transitionName:_,onAllRemoved:y}=c,{getPrefixCls:m,getPopupContainer:x,message:e,direction:t}=C.useContext(vt),n=o||m("message"),d=()=>({left:"50%",transform:"translateX(-50%)",top:a??ws}),h=()=>he({[`${n}-rtl`]:s??t==="rtl"}),g=()=>vs(n,_),p=C.createElement("span",{className:`${n}-close-x`},C.createElement(jn,{className:`${n}-close-icon`})),[v,b]=fs({prefixCls:n,style:d,className:h,motion:g,closable:!1,closeIcon:p,duration:f,getContainer:()=>(l==null?void 0:l())||(x==null?void 0:x())||document.body,maxCount:u,onAllRemoved:y,renderNotifications:Us});return C.useImperativeHandle(r,()=>Object.assign(Object.assign({},v),{prefixCls:n,message:e})),b});let lr=0;function Vr(c){const r=C.useRef(null);return En(),[C.useMemo(()=>{const o=_=>{var y;(y=r.current)===null||y===void 0||y.close(_)},l=_=>{if(!r.current){const U=()=>{};return U.then=()=>{},U}const{open:y,prefixCls:m,message:x}=r.current,e=`${m}-notice`,{content:t,icon:n,type:d,key:h,className:g,style:p,onClose:v}=_,b=bs(_,["content","icon","type","key","className","style","onClose"]);let S=h;return S==null&&(lr+=1,S=`antd-message-${lr}`),ji(U=>(y(Object.assign(Object.assign({},b),{key:S,content:C.createElement(Dr,{prefixCls:m,type:d,icon:n},t),placement:"top",className:he(d&&`${e}-${d}`,g,x==null?void 0:x.className),style:Object.assign(Object.assign({},x==null?void 0:x.style),p),onClose:()=>{v==null||v(),U()}})),()=>{o(S)}))},f={open:l,destroy:_=>{var y;_!==void 0?o(_):(y=r.current)===null||y===void 0||y.destroy()}};return["info","success","warning","error","loading"].forEach(_=>{const y=(m,x,e)=>{let t;m&&typeof m=="object"&&"content"in m?t=m:t={content:m};let n,d;typeof x=="function"?d=x:(n=x,d=e);const h=Object.assign(Object.assign({onClose:d,duration:n},t),{type:_});return l(h)};f[_]=y}),f},[]),C.createElement(Es,Object.assign({key:"message-holder"},c,{ref:r}))]}function Cs(c){return Vr(c)}var Ke="RC_FORM_INTERNAL_HOOKS",W=function(){Oe(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},_t=C.createContext({getFieldValue:W,getFieldsValue:W,getFieldError:W,getFieldWarning:W,getFieldsError:W,isFieldsTouched:W,isFieldTouched:W,isFieldValidating:W,isFieldsValidating:W,resetFields:W,setFields:W,setFieldValue:W,setFieldsValue:W,validateFields:W,submit:W,getInternalHooks:function(){return W(),{dispatch:W,initEntityValue:W,registerField:W,useSubscribe:W,setInitialValues:W,destroyForm:W,setCallbacks:W,registerWatch:W,getFields:W,setValidateMessages:W,setPreserve:W,getInitialValue:W}}}),oi=C.createContext(null);function ki(c){return c==null?[]:Array.isArray(c)?c:[c]}function Fs(c){return c&&!!c._init}function Ai(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var r=JSON.parse(JSON.stringify(this));return r.clone=this.clone,r}}}var Pi=Ai();function ks(c){try{return Function.toString.call(c).indexOf("[native code]")!==-1}catch{return typeof c=="function"}}function As(c,r,a){if(Cn())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,r);var l=new(c.bind.apply(c,o));return a&&Ir(l,a.prototype),l}function Ii(c){var r=typeof Map=="function"?new Map:void 0;return Ii=function(o){if(o===null||!ks(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(o))return r.get(o);r.set(o,l)}function l(){return As(o,arguments,Fn(this).constructor)}return l.prototype=Object.create(o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),Ir(l,o)},Ii(c)}var Ps=/%[sdj%]/g,Is=function(){};function Ti(c){if(!c||!c.length)return null;var r={};return c.forEach(function(a){var o=a.field;r[o]=r[o]||[],r[o].push(a)}),r}function ce(c){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];var l=0,u=a.length;if(typeof c=="function")return c.apply(null,a);if(typeof c=="string"){var f=c.replace(Ps,function(s){if(s==="%%")return"%";if(l>=u)return s;switch(s){case"%s":return String(a[l++]);case"%d":return Number(a[l++]);case"%j":try{return JSON.stringify(a[l++])}catch{return"[Circular]"}break;default:return s}});return f}return c}function Ts(c){return c==="string"||c==="url"||c==="hex"||c==="email"||c==="date"||c==="pattern"}function X(c,r){return!!(c==null||r==="array"&&Array.isArray(c)&&!c.length||Ts(r)&&typeof c=="string"&&!c)}function Bs(c,r,a){var o=[],l=0,u=c.length;function f(s){o.push.apply(o,D(s||[])),l++,l===u&&a(o)}c.forEach(function(s){r(s,f)})}function dr(c,r,a){var o=0,l=c.length;function u(f){if(f&&f.length){a(f);return}var s=o;o=o+1,s<l?r(c[s],u):a([])}u([])}function zs(c){var r=[];return Object.keys(c).forEach(function(a){r.push.apply(r,D(c[a]||[]))}),r}var cr=function(c){Tr(a,c);var r=Br(a);function a(o,l){var u;return Ot(this,a),u=r.call(this,"Async Validation Error"),A($(u),"errors",void 0),A($(u),"fields",void 0),u.errors=o,u.fields=l,u}return Dt(a)}(Ii(Error));function Rs(c,r,a,o,l){if(r.first){var u=new Promise(function(e,t){var n=function(g){return o(g),g.length?t(new cr(g,Ti(g))):e(l)},d=zs(c);dr(d,a,n)});return u.catch(function(e){return e}),u}var f=r.firstFields===!0?Object.keys(c):r.firstFields||[],s=Object.keys(c),_=s.length,y=0,m=[],x=new Promise(function(e,t){var n=function(h){if(m.push.apply(m,h),y++,y===_)return o(m),m.length?t(new cr(m,Ti(m))):e(l)};s.length||(o(m),e(l)),s.forEach(function(d){var h=c[d];f.indexOf(d)!==-1?dr(h,a,n):Bs(h,a,n)})});return x.catch(function(e){return e}),x}function Ls(c){return!!(c&&c.message!==void 0)}function Ms(c,r){for(var a=c,o=0;o<r.length;o++){if(a==null)return a;a=a[r[o]]}return a}function hr(c,r){return function(a){var o;return c.fullFields?o=Ms(r,c.fullFields):o=r[a.field||c.fullField],Ls(a)?(a.field=a.field||c.fullField,a.fieldValue=o,a):{message:typeof a=="function"?a():a,fieldValue:o,field:a.field||c.fullField}}}function ur(c,r){if(r){for(var a in r)if(r.hasOwnProperty(a)){var o=r[a];te(o)==="object"&&te(c[a])==="object"?c[a]=N(N({},c[a]),o):c[a]=o}}return c}var tt="enum",Ns=function(r,a,o,l,u){r[tt]=Array.isArray(r[tt])?r[tt]:[],r[tt].indexOf(a)===-1&&l.push(ce(u.messages[tt],r.fullField,r[tt].join(", ")))},Os=function(r,a,o,l,u){if(r.pattern){if(r.pattern instanceof RegExp)r.pattern.lastIndex=0,r.pattern.test(a)||l.push(ce(u.messages.pattern.mismatch,r.fullField,a,r.pattern));else if(typeof r.pattern=="string"){var f=new RegExp(r.pattern);f.test(a)||l.push(ce(u.messages.pattern.mismatch,r.fullField,a,r.pattern))}}},Ds=function(r,a,o,l,u){var f=typeof r.len=="number",s=typeof r.min=="number",_=typeof r.max=="number",y=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,m=a,x=null,e=typeof a=="number",t=typeof a=="string",n=Array.isArray(a);if(e?x="number":t?x="string":n&&(x="array"),!x)return!1;n&&(m=a.length),t&&(m=a.replace(y,"_").length),f?m!==r.len&&l.push(ce(u.messages[x].len,r.fullField,r.len)):s&&!_&&m<r.min?l.push(ce(u.messages[x].min,r.fullField,r.min)):_&&!s&&m>r.max?l.push(ce(u.messages[x].max,r.fullField,r.max)):s&&_&&(m<r.min||m>r.max)&&l.push(ce(u.messages[x].range,r.fullField,r.min,r.max))},Gr=function(r,a,o,l,u,f){r.required&&(!o.hasOwnProperty(r.field)||X(a,f||r.type))&&l.push(ce(u.messages.required,r.fullField))},jt;const Vs=function(){if(jt)return jt;var c="[a-fA-F\\d:]",r=function(U){return U&&U.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(c,")|(?<=").concat(c,")(?=\\s|$))"):""},a="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",o="[a-fA-F\\d]{1,4}",l=["(?:".concat(o,":){7}(?:").concat(o,"|:)"),"(?:".concat(o,":){6}(?:").concat(a,"|:").concat(o,"|:)"),"(?:".concat(o,":){5}(?::").concat(a,"|(?::").concat(o,"){1,2}|:)"),"(?:".concat(o,":){4}(?:(?::").concat(o,"){0,1}:").concat(a,"|(?::").concat(o,"){1,3}|:)"),"(?:".concat(o,":){3}(?:(?::").concat(o,"){0,2}:").concat(a,"|(?::").concat(o,"){1,4}|:)"),"(?:".concat(o,":){2}(?:(?::").concat(o,"){0,3}:").concat(a,"|(?::").concat(o,"){1,5}|:)"),"(?:".concat(o,":){1}(?:(?::").concat(o,"){0,4}:").concat(a,"|(?::").concat(o,"){1,6}|:)"),"(?::(?:(?::".concat(o,"){0,5}:").concat(a,"|(?::").concat(o,"){1,7}|:))")],u="(?:%[0-9a-zA-Z]{1,})?",f="(?:".concat(l.join("|"),")").concat(u),s=new RegExp("(?:^".concat(a,"$)|(?:^").concat(f,"$)")),_=new RegExp("^".concat(a,"$")),y=new RegExp("^".concat(f,"$")),m=function(U){return U&&U.exact?s:new RegExp("(?:".concat(r(U)).concat(a).concat(r(U),")|(?:").concat(r(U)).concat(f).concat(r(U),")"),"g")};m.v4=function(S){return S&&S.exact?_:new RegExp("".concat(r(S)).concat(a).concat(r(S)),"g")},m.v6=function(S){return S&&S.exact?y:new RegExp("".concat(r(S)).concat(f).concat(r(S)),"g")};var x="(?:(?:[a-z]+:)?//)",e="(?:\\S+(?::\\S*)?@)?",t=m.v4().source,n=m.v6().source,d="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",h="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",p="(?::\\d{2,5})?",v='(?:[/?#][^\\s"]*)?',b="(?:".concat(x,"|www\\.)").concat(e,"(?:localhost|").concat(t,"|").concat(n,"|").concat(d).concat(h).concat(g,")").concat(p).concat(v);return jt=new RegExp("(?:^".concat(b,"$)"),"i"),jt};var fr={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},St={integer:function(r){return St.number(r)&&parseInt(r,10)===r},float:function(r){return St.number(r)&&!St.integer(r)},array:function(r){return Array.isArray(r)},regexp:function(r){if(r instanceof RegExp)return!0;try{return!!new RegExp(r)}catch{return!1}},date:function(r){return typeof r.getTime=="function"&&typeof r.getMonth=="function"&&typeof r.getYear=="function"&&!isNaN(r.getTime())},number:function(r){return isNaN(r)?!1:typeof r=="number"},object:function(r){return te(r)==="object"&&!St.array(r)},method:function(r){return typeof r=="function"},email:function(r){return typeof r=="string"&&r.length<=320&&!!r.match(fr.email)},url:function(r){return typeof r=="string"&&r.length<=2048&&!!r.match(Vs())},hex:function(r){return typeof r=="string"&&!!r.match(fr.hex)}},Gs=function(r,a,o,l,u){if(r.required&&a===void 0){Gr(r,a,o,l,u);return}var f=["integer","float","array","regexp","object","method","email","number","date","url","hex"],s=r.type;f.indexOf(s)>-1?St[s](a)||l.push(ce(u.messages.types[s],r.fullField,r.type)):s&&te(a)!==r.type&&l.push(ce(u.messages.types[s],r.fullField,r.type))},Hs=function(r,a,o,l,u){(/^\s+$/.test(a)||a==="")&&l.push(ce(u.messages.whitespace,r.fullField))};const G={required:Gr,whitespace:Hs,type:Gs,range:Ds,enum:Ns,pattern:Os};var $s=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u)}o(f)},Ys=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(a==null&&!r.required)return o();G.required(r,a,l,f,u,"array"),a!=null&&(G.type(r,a,l,f,u),G.range(r,a,l,f,u))}o(f)},Ws=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&G.type(r,a,l,f,u)}o(f)},js=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a,"date")&&!r.required)return o();if(G.required(r,a,l,f,u),!X(a,"date")){var _;a instanceof Date?_=a:_=new Date(a),G.type(r,_,l,f,u),_&&G.range(r,_.getTime(),l,f,u)}}o(f)},qs="enum",Zs=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&G[qs](r,a,l,f,u)}o(f)},Ks=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&(G.type(r,a,l,f,u),G.range(r,a,l,f,u))}o(f)},Xs=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&(G.type(r,a,l,f,u),G.range(r,a,l,f,u))}o(f)},Js=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&G.type(r,a,l,f,u)}o(f)},Qs=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(a===""&&(a=void 0),X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&(G.type(r,a,l,f,u),G.range(r,a,l,f,u))}o(f)},ea=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),a!==void 0&&G.type(r,a,l,f,u)}o(f)},ta=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a,"string")&&!r.required)return o();G.required(r,a,l,f,u),X(a,"string")||G.pattern(r,a,l,f,u)}o(f)},ia=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a)&&!r.required)return o();G.required(r,a,l,f,u),X(a)||G.type(r,a,l,f,u)}o(f)},ra=function(r,a,o,l,u){var f=[],s=Array.isArray(a)?"array":te(a);G.required(r,a,l,f,u,s),o(f)},na=function(r,a,o,l,u){var f=[],s=r.required||!r.required&&l.hasOwnProperty(r.field);if(s){if(X(a,"string")&&!r.required)return o();G.required(r,a,l,f,u,"string"),X(a,"string")||(G.type(r,a,l,f,u),G.range(r,a,l,f,u),G.pattern(r,a,l,f,u),r.whitespace===!0&&G.whitespace(r,a,l,f,u))}o(f)},Ei=function(r,a,o,l,u){var f=r.type,s=[],_=r.required||!r.required&&l.hasOwnProperty(r.field);if(_){if(X(a,f)&&!r.required)return o();G.required(r,a,l,s,u,f),X(a,f)||G.type(r,a,l,s,u)}o(s)};const zt={string:na,method:Js,number:Qs,boolean:Ws,regexp:ia,integer:Xs,float:Ks,array:Ys,object:ea,enum:Zs,pattern:ta,date:js,url:Ei,hex:Ei,email:Ei,required:ra,any:$s};var Gt=function(){function c(r){Ot(this,c),A(this,"rules",null),A(this,"_messages",Pi),this.define(r)}return Dt(c,[{key:"define",value:function(a){var o=this;if(!a)throw new Error("Cannot configure a schema with no rules");if(te(a)!=="object"||Array.isArray(a))throw new Error("Rules must be an object");this.rules={},Object.keys(a).forEach(function(l){var u=a[l];o.rules[l]=Array.isArray(u)?u:[u]})}},{key:"messages",value:function(a){return a&&(this._messages=ur(Ai(),a)),this._messages}},{key:"validate",value:function(a){var o=this,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},f=a,s=l,_=u;if(typeof s=="function"&&(_=s,s={}),!this.rules||Object.keys(this.rules).length===0)return _&&_(null,f),Promise.resolve(f);function y(n){var d=[],h={};function g(v){if(Array.isArray(v)){var b;d=(b=d).concat.apply(b,D(v))}else d.push(v)}for(var p=0;p<n.length;p++)g(n[p]);d.length?(h=Ti(d),_(d,h)):_(null,f)}if(s.messages){var m=this.messages();m===Pi&&(m=Ai()),ur(m,s.messages),s.messages=m}else s.messages=this.messages();var x={},e=s.keys||Object.keys(this.rules);e.forEach(function(n){var d=o.rules[n],h=f[n];d.forEach(function(g){var p=g;typeof p.transform=="function"&&(f===a&&(f=N({},f)),h=f[n]=p.transform(h),h!=null&&(p.type=p.type||(Array.isArray(h)?"array":te(h)))),typeof p=="function"?p={validator:p}:p=N({},p),p.validator=o.getValidationMethod(p),p.validator&&(p.field=n,p.fullField=p.fullField||n,p.type=o.getType(p),x[n]=x[n]||[],x[n].push({rule:p,value:h,source:f,field:n}))})});var t={};return Rs(x,s,function(n,d){var h=n.rule,g=(h.type==="object"||h.type==="array")&&(te(h.fields)==="object"||te(h.defaultField)==="object");g=g&&(h.required||!h.required&&n.value),h.field=n.field;function p(F,k){return N(N({},k),{},{fullField:"".concat(h.fullField,".").concat(F),fullFields:h.fullFields?[].concat(D(h.fullFields),[F]):[F]})}function v(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],k=Array.isArray(F)?F:[F];!s.suppressWarning&&k.length&&c.warning("async-validator:",k),k.length&&h.message!==void 0&&(k=[].concat(h.message));var w=k.map(hr(h,f));if(s.first&&w.length)return t[h.field]=1,d(w);if(!g)d(w);else{if(h.required&&!n.value)return h.message!==void 0?w=[].concat(h.message).map(hr(h,f)):s.error&&(w=[s.error(h,ce(s.messages.required,h.field))]),d(w);var I={};h.defaultField&&Object.keys(n.value).map(function(z){I[z]=h.defaultField}),I=N(N({},I),n.rule.fields);var P={};Object.keys(I).forEach(function(z){var T=I[z],O=Array.isArray(T)?T:[T];P[z]=O.map(p.bind(null,z))});var R=new c(P);R.messages(s.messages),n.rule.options&&(n.rule.options.messages=s.messages,n.rule.options.error=s.error),R.validate(n.value,n.rule.options||s,function(z){var T=[];w&&w.length&&T.push.apply(T,D(w)),z&&z.length&&T.push.apply(T,D(z)),d(T.length?T:null)})}}var b;if(h.asyncValidator)b=h.asyncValidator(h,n.value,v,n.source,s);else if(h.validator){try{b=h.validator(h,n.value,v,n.source,s)}catch(F){var S,U;(S=(U=console).error)===null||S===void 0||S.call(U,F),s.suppressValidatorError||setTimeout(function(){throw F},0),v(F.message)}b===!0?v():b===!1?v(typeof h.message=="function"?h.message(h.fullField||h.field):h.message||"".concat(h.fullField||h.field," fails")):b instanceof Array?v(b):b instanceof Error&&v(b.message)}b&&b.then&&b.then(function(){return v()},function(F){return v(F)})},function(n){y(n)},f)}},{key:"getType",value:function(a){if(a.type===void 0&&a.pattern instanceof RegExp&&(a.type="pattern"),typeof a.validator!="function"&&a.type&&!zt.hasOwnProperty(a.type))throw new Error(ce("Unknown rule type %s",a.type));return a.type||"string"}},{key:"getValidationMethod",value:function(a){if(typeof a.validator=="function")return a.validator;var o=Object.keys(a),l=o.indexOf("message");return l!==-1&&o.splice(l,1),o.length===1&&o[0]==="required"?zt.required:zt[this.getType(a)]||void 0}}]),c}();A(Gt,"register",function(r,a){if(typeof a!="function")throw new Error("Cannot register a validator by type, validator is not a function");zt[r]=a});A(Gt,"warning",Is);A(Gt,"messages",Pi);A(Gt,"validators",zt);var oe="'${name}' is not a valid ${type}",Hr={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:oe,method:oe,array:oe,object:oe,number:oe,date:oe,boolean:oe,integer:oe,float:oe,regexp:oe,email:oe,url:oe,hex:oe},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},pr=Gt;function sa(c,r){return c.replace(/\$\{\w+\}/g,function(a){var o=a.slice(2,-1);return r[o]})}var mr="CODE_LOGIC_ERROR";function Bi(c,r,a,o,l){return zi.apply(this,arguments)}function zi(){return zi=Vt(Ee().mark(function c(r,a,o,l,u){var f,s,_,y,m,x,e,t,n;return Ee().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return f=N({},o),delete f.ruleIndex,pr.warning=function(){},f.validator&&(s=f.validator,f.validator=function(){try{return s.apply(void 0,arguments)}catch(g){return console.error(g),Promise.reject(mr)}}),_=null,f&&f.type==="array"&&f.defaultField&&(_=f.defaultField,delete f.defaultField),y=new pr(A({},r,[f])),m=wt(Hr,l.validateMessages),y.messages(m),x=[],h.prev=10,h.next=13,Promise.resolve(y.validate(A({},r,a),N({},l)));case 13:h.next=18;break;case 15:h.prev=15,h.t0=h.catch(10),h.t0.errors&&(x=h.t0.errors.map(function(g,p){var v=g.message,b=v===mr?m.default:v;return C.isValidElement(b)?C.cloneElement(b,{key:"error_".concat(p)}):b}));case 18:if(!(!x.length&&_)){h.next=23;break}return h.next=21,Promise.all(a.map(function(g,p){return Bi("".concat(r,".").concat(p),g,_,l,u)}));case 21:return e=h.sent,h.abrupt("return",e.reduce(function(g,p){return[].concat(D(g),D(p))},[]));case 23:return t=N(N({},o),{},{name:r,enum:(o.enum||[]).join(", ")},u),n=x.map(function(g){return typeof g=="string"?sa(g,t):g}),h.abrupt("return",n);case 26:case"end":return h.stop()}},c,null,[[10,15]])})),zi.apply(this,arguments)}function aa(c,r,a,o,l,u){var f=c.join("."),s=a.map(function(m,x){var e=m.validator,t=N(N({},m),{},{ruleIndex:x});return e&&(t.validator=function(n,d,h){var g=!1,p=function(){for(var S=arguments.length,U=new Array(S),F=0;F<S;F++)U[F]=arguments[F];Promise.resolve().then(function(){Oe(!g,"Your validator function has already return a promise. `callback` will be ignored."),g||h.apply(void 0,U)})},v=e(n,d,p);g=v&&typeof v.then=="function"&&typeof v.catch=="function",Oe(g,"`callback` is deprecated. Please return a promise instead."),g&&v.then(function(){h()}).catch(function(b){h(b||" ")})}),t}).sort(function(m,x){var e=m.warningOnly,t=m.ruleIndex,n=x.warningOnly,d=x.ruleIndex;return!!e==!!n?t-d:e?1:-1}),_;if(l===!0)_=new Promise(function(){var m=Vt(Ee().mark(function x(e,t){var n,d,h;return Ee().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:n=0;case 1:if(!(n<s.length)){p.next=12;break}return d=s[n],p.next=5,Bi(f,r,d,o,u);case 5:if(h=p.sent,!h.length){p.next=9;break}return t([{errors:h,rule:d}]),p.abrupt("return");case 9:n+=1,p.next=1;break;case 12:e([]);case 13:case"end":return p.stop()}},x)}));return function(x,e){return m.apply(this,arguments)}}());else{var y=s.map(function(m){return Bi(f,r,m,o,u).then(function(x){return{errors:x,rule:m}})});_=(l?la(y):oa(y)).then(function(m){return Promise.reject(m)})}return _.catch(function(m){return m}),_}function oa(c){return Ri.apply(this,arguments)}function Ri(){return Ri=Vt(Ee().mark(function c(r){return Ee().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Promise.all(r).then(function(l){var u,f=(u=[]).concat.apply(u,D(l));return f}));case 1:case"end":return o.stop()}},c)})),Ri.apply(this,arguments)}function la(c){return Li.apply(this,arguments)}function Li(){return Li=Vt(Ee().mark(function c(r){var a;return Ee().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=0,l.abrupt("return",new Promise(function(u){r.forEach(function(f){f.then(function(s){s.errors.length&&u([s]),a+=1,a===r.length&&u([])})})}));case 2:case"end":return l.stop()}},c)})),Li.apply(this,arguments)}function Z(c){return ki(c)}function gr(c,r){var a={};return r.forEach(function(o){var l=Ze(c,o);a=Be(a,o,l)}),a}function gt(c,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return c&&c.some(function(o){return $r(r,o,a)})}function $r(c,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return!c||!r||!a&&c.length!==r.length?!1:r.every(function(o,l){return c[l]===o})}function da(c,r){if(c===r)return!0;if(!c&&r||c&&!r||!c||!r||te(c)!=="object"||te(r)!=="object")return!1;var a=Object.keys(c),o=Object.keys(r),l=new Set([].concat(a,o));return D(l).every(function(u){var f=c[u],s=r[u];return typeof f=="function"&&typeof s=="function"?!0:f===s})}function ca(c){var r=arguments.length<=1?void 0:arguments[1];return r&&r.target&&te(r.target)==="object"&&c in r.target?r.target[c]:r}function _r(c,r,a){var o=c.length;if(r<0||r>=o||a<0||a>=o)return c;var l=c[r],u=r-a;return u>0?[].concat(D(c.slice(0,a)),[l],D(c.slice(a,r)),D(c.slice(r+1,o))):u<0?[].concat(D(c.slice(0,r)),D(c.slice(r+1,a+1)),[l],D(c.slice(a+1,o))):c}var ha=["name"],ue=[];function yr(c,r,a,o,l,u){return typeof c=="function"?c(r,a,"source"in u?{source:u.source}:{}):o!==l}var qi=function(c){Tr(a,c);var r=Br(a);function a(o){var l;if(Ot(this,a),l=r.call(this,o),A($(l),"state",{resetCount:0}),A($(l),"cancelRegisterFunc",null),A($(l),"mounted",!1),A($(l),"touched",!1),A($(l),"dirty",!1),A($(l),"validatePromise",void 0),A($(l),"prevValidating",void 0),A($(l),"errors",ue),A($(l),"warnings",ue),A($(l),"cancelRegister",function(){var _=l.props,y=_.preserve,m=_.isListField,x=_.name;l.cancelRegisterFunc&&l.cancelRegisterFunc(m,y,Z(x)),l.cancelRegisterFunc=null}),A($(l),"getNamePath",function(){var _=l.props,y=_.name,m=_.fieldContext,x=m.prefixName,e=x===void 0?[]:x;return y!==void 0?[].concat(D(e),D(y)):[]}),A($(l),"getRules",function(){var _=l.props,y=_.rules,m=y===void 0?[]:y,x=_.fieldContext;return m.map(function(e){return typeof e=="function"?e(x):e})}),A($(l),"refresh",function(){l.mounted&&l.setState(function(_){var y=_.resetCount;return{resetCount:y+1}})}),A($(l),"metaCache",null),A($(l),"triggerMetaEvent",function(_){var y=l.props.onMetaChange;if(y){var m=N(N({},l.getMeta()),{},{destroy:_});ir(l.metaCache,m)||y(m),l.metaCache=m}else l.metaCache=null}),A($(l),"onStoreChange",function(_,y,m){var x=l.props,e=x.shouldUpdate,t=x.dependencies,n=t===void 0?[]:t,d=x.onReset,h=m.store,g=l.getNamePath(),p=l.getValue(_),v=l.getValue(h),b=y&&gt(y,g);switch(m.type==="valueUpdate"&&m.source==="external"&&!ir(p,v)&&(l.touched=!0,l.dirty=!0,l.validatePromise=null,l.errors=ue,l.warnings=ue,l.triggerMetaEvent()),m.type){case"reset":if(!y||b){l.touched=!1,l.dirty=!1,l.validatePromise=void 0,l.errors=ue,l.warnings=ue,l.triggerMetaEvent(),d==null||d(),l.refresh();return}break;case"remove":{if(e){l.reRender();return}break}case"setField":{var S=m.data;if(b){"touched"in S&&(l.touched=S.touched),"validating"in S&&!("originRCField"in S)&&(l.validatePromise=S.validating?Promise.resolve([]):null),"errors"in S&&(l.errors=S.errors||ue),"warnings"in S&&(l.warnings=S.warnings||ue),l.dirty=!0,l.triggerMetaEvent(),l.reRender();return}else if("value"in S&&gt(y,g,!0)){l.reRender();return}if(e&&!g.length&&yr(e,_,h,p,v,m)){l.reRender();return}break}case"dependenciesUpdate":{var U=n.map(Z);if(U.some(function(F){return gt(m.relatedFields,F)})){l.reRender();return}break}default:if(b||(!n.length||g.length||e)&&yr(e,_,h,p,v,m)){l.reRender();return}break}e===!0&&l.reRender()}),A($(l),"validateRules",function(_){var y=l.getNamePath(),m=l.getValue(),x=_||{},e=x.triggerName,t=x.validateOnly,n=t===void 0?!1:t,d=Promise.resolve().then(Vt(Ee().mark(function h(){var g,p,v,b,S,U,F;return Ee().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(l.mounted){w.next=2;break}return w.abrupt("return",[]);case 2:if(g=l.props,p=g.validateFirst,v=p===void 0?!1:p,b=g.messageVariables,S=g.validateDebounce,U=l.getRules(),e&&(U=U.filter(function(I){return I}).filter(function(I){var P=I.validateTrigger;if(!P)return!0;var R=ki(P);return R.includes(e)})),!(S&&e)){w.next=10;break}return w.next=8,new Promise(function(I){setTimeout(I,S)});case 8:if(l.validatePromise===d){w.next=10;break}return w.abrupt("return",[]);case 10:return F=aa(y,m,U,_,v,b),F.catch(function(I){return I}).then(function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ue;if(l.validatePromise===d){var P;l.validatePromise=null;var R=[],z=[];(P=I.forEach)===null||P===void 0||P.call(I,function(T){var O=T.rule.warningOnly,L=T.errors,Y=L===void 0?ue:L;O?z.push.apply(z,D(Y)):R.push.apply(R,D(Y))}),l.errors=R,l.warnings=z,l.triggerMetaEvent(),l.reRender()}}),w.abrupt("return",F);case 13:case"end":return w.stop()}},h)})));return n||(l.validatePromise=d,l.dirty=!0,l.errors=ue,l.warnings=ue,l.triggerMetaEvent(),l.reRender()),d}),A($(l),"isFieldValidating",function(){return!!l.validatePromise}),A($(l),"isFieldTouched",function(){return l.touched}),A($(l),"isFieldDirty",function(){if(l.dirty||l.props.initialValue!==void 0)return!0;var _=l.props.fieldContext,y=_.getInternalHooks(Ke),m=y.getInitialValue;return m(l.getNamePath())!==void 0}),A($(l),"getErrors",function(){return l.errors}),A($(l),"getWarnings",function(){return l.warnings}),A($(l),"isListField",function(){return l.props.isListField}),A($(l),"isList",function(){return l.props.isList}),A($(l),"isPreserve",function(){return l.props.preserve}),A($(l),"getMeta",function(){l.prevValidating=l.isFieldValidating();var _={touched:l.isFieldTouched(),validating:l.prevValidating,errors:l.errors,warnings:l.warnings,name:l.getNamePath(),validated:l.validatePromise===null};return _}),A($(l),"getOnlyChild",function(_){if(typeof _=="function"){var y=l.getMeta();return N(N({},l.getOnlyChild(_(l.getControlled(),y,l.props.fieldContext))),{},{isFunction:!0})}var m=kn(_);return m.length!==1||!C.isValidElement(m[0])?{child:m,isFunction:!1}:{child:m[0],isFunction:!1}}),A($(l),"getValue",function(_){var y=l.props.fieldContext.getFieldsValue,m=l.getNamePath();return Ze(_||y(!0),m)}),A($(l),"getControlled",function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=l.props,m=y.name,x=y.trigger,e=y.validateTrigger,t=y.getValueFromEvent,n=y.normalize,d=y.valuePropName,h=y.getValueProps,g=y.fieldContext,p=e!==void 0?e:g.validateTrigger,v=l.getNamePath(),b=g.getInternalHooks,S=g.getFieldsValue,U=b(Ke),F=U.dispatch,k=l.getValue(),w=h||function(T){return A({},d,T)},I=_[x],P=m!==void 0?w(k):{},R=N(N({},_),P);R[x]=function(){l.touched=!0,l.dirty=!0,l.triggerMetaEvent();for(var T,O=arguments.length,L=new Array(O),Y=0;Y<O;Y++)L[Y]=arguments[Y];t?T=t.apply(void 0,L):T=ca.apply(void 0,[d].concat(L)),n&&(T=n(T,k,S(!0))),F({type:"updateValue",namePath:v,value:T}),I&&I.apply(void 0,L)};var z=ki(p||[]);return z.forEach(function(T){var O=R[T];R[T]=function(){O&&O.apply(void 0,arguments);var L=l.props.rules;L&&L.length&&F({type:"validateField",namePath:v,triggerName:T})}}),R}),o.fieldContext){var u=o.fieldContext.getInternalHooks,f=u(Ke),s=f.initEntityValue;s($(l))}return l}return Dt(a,[{key:"componentDidMount",value:function(){var l=this.props,u=l.shouldUpdate,f=l.fieldContext;if(this.mounted=!0,f){var s=f.getInternalHooks,_=s(Ke),y=_.registerField;this.cancelRegisterFunc=y(this)}u===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var l=this.state.resetCount,u=this.props.children,f=this.getOnlyChild(u),s=f.child,_=f.isFunction,y;return _?y=s:C.isValidElement(s)?y=C.cloneElement(s,this.getControlled(s.props)):(Oe(!s,"`children` of Field is not validate ReactElement."),y=s),C.createElement(C.Fragment,{key:l},y)}}]),a}(C.Component);A(qi,"contextType",_t);A(qi,"defaultProps",{trigger:"onChange",valuePropName:"value"});function Yr(c){var r=c.name,a=yt(c,ha),o=C.useContext(_t),l=C.useContext(oi),u=r!==void 0?Z(r):void 0,f="keep";return a.isListField||(f="_".concat((u||[]).join("_"))),C.createElement(qi,me({key:f,name:u,isListField:!!l},a,{fieldContext:o}))}function ua(c){var r=c.name,a=c.initialValue,o=c.children,l=c.rules,u=c.validateTrigger,f=c.isListField,s=C.useContext(_t),_=C.useContext(oi),y=C.useRef({keys:[],id:0}),m=y.current,x=C.useMemo(function(){var d=Z(s.prefixName)||[];return[].concat(D(d),D(Z(r)))},[s.prefixName,r]),e=C.useMemo(function(){return N(N({},s),{},{prefixName:x})},[s,x]),t=C.useMemo(function(){return{getKey:function(h){var g=x.length,p=h[g];return[m.keys[p],h.slice(g+1)]}}},[x]);if(typeof o!="function")return Oe(!1,"Form.List only accepts function as children."),null;var n=function(h,g,p){var v=p.source;return v==="internal"?!1:h!==g};return C.createElement(oi.Provider,{value:t},C.createElement(_t.Provider,{value:e},C.createElement(Yr,{name:[],shouldUpdate:n,rules:l,validateTrigger:u,initialValue:a,isList:!0,isListField:f??!!_},function(d,h){var g=d.value,p=g===void 0?[]:g,v=d.onChange,b=s.getFieldValue,S=function(){var w=b(x||[]);return w||[]},U={add:function(w,I){var P=S();I>=0&&I<=P.length?(m.keys=[].concat(D(m.keys.slice(0,I)),[m.id],D(m.keys.slice(I))),v([].concat(D(P.slice(0,I)),[w],D(P.slice(I))))):(m.keys=[].concat(D(m.keys),[m.id]),v([].concat(D(P),[w]))),m.id+=1},remove:function(w){var I=S(),P=new Set(Array.isArray(w)?w:[w]);P.size<=0||(m.keys=m.keys.filter(function(R,z){return!P.has(z)}),v(I.filter(function(R,z){return!P.has(z)})))},move:function(w,I){if(w!==I){var P=S();w<0||w>=P.length||I<0||I>=P.length||(m.keys=_r(m.keys,w,I),v(_r(P,w,I)))}}},F=p||[];return Array.isArray(F)||(F=[]),o(F.map(function(k,w){var I=m.keys[w];return I===void 0&&(m.keys[w]=m.id,I=m.keys[w],m.id+=1),{name:w,key:I,isListField:!0}}),U,h)})))}function fa(c){var r=!1,a=c.length,o=[];return c.length?new Promise(function(l,u){c.forEach(function(f,s){f.catch(function(_){return r=!0,_}).then(function(_){a-=1,o[s]=_,!(a>0)&&(r&&u(o),l(o))})})}):Promise.resolve([])}var Wr="__@field_split__";function Ci(c){return c.map(function(r){return"".concat(te(r),":").concat(r)}).join(Wr)}var it=function(){function c(){Ot(this,c),A(this,"kvs",new Map)}return Dt(c,[{key:"set",value:function(a,o){this.kvs.set(Ci(a),o)}},{key:"get",value:function(a){return this.kvs.get(Ci(a))}},{key:"update",value:function(a,o){var l=this.get(a),u=o(l);u?this.set(a,u):this.delete(a)}},{key:"delete",value:function(a){this.kvs.delete(Ci(a))}},{key:"map",value:function(a){return D(this.kvs.entries()).map(function(o){var l=ie(o,2),u=l[0],f=l[1],s=u.split(Wr);return a({key:s.map(function(_){var y=_.match(/^([^:]*):(.*)$/),m=ie(y,3),x=m[1],e=m[2];return x==="number"?Number(e):e}),value:f})})}},{key:"toJSON",value:function(){var a={};return this.map(function(o){var l=o.key,u=o.value;return a[l.join(".")]=u,null}),a}}]),c}(),pa=["name"],ma=Dt(function c(r){var a=this;Ot(this,c),A(this,"formHooked",!1),A(this,"forceRootUpdate",void 0),A(this,"subscribable",!0),A(this,"store",{}),A(this,"fieldEntities",[]),A(this,"initialValues",{}),A(this,"callbacks",{}),A(this,"validateMessages",null),A(this,"preserve",null),A(this,"lastValidatePromise",null),A(this,"getForm",function(){return{getFieldValue:a.getFieldValue,getFieldsValue:a.getFieldsValue,getFieldError:a.getFieldError,getFieldWarning:a.getFieldWarning,getFieldsError:a.getFieldsError,isFieldsTouched:a.isFieldsTouched,isFieldTouched:a.isFieldTouched,isFieldValidating:a.isFieldValidating,isFieldsValidating:a.isFieldsValidating,resetFields:a.resetFields,setFields:a.setFields,setFieldValue:a.setFieldValue,setFieldsValue:a.setFieldsValue,validateFields:a.validateFields,submit:a.submit,_init:!0,getInternalHooks:a.getInternalHooks}}),A(this,"getInternalHooks",function(o){return o===Ke?(a.formHooked=!0,{dispatch:a.dispatch,initEntityValue:a.initEntityValue,registerField:a.registerField,useSubscribe:a.useSubscribe,setInitialValues:a.setInitialValues,destroyForm:a.destroyForm,setCallbacks:a.setCallbacks,setValidateMessages:a.setValidateMessages,getFields:a.getFields,setPreserve:a.setPreserve,getInitialValue:a.getInitialValue,registerWatch:a.registerWatch}):(Oe(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),A(this,"useSubscribe",function(o){a.subscribable=o}),A(this,"prevWithoutPreserves",null),A(this,"setInitialValues",function(o,l){if(a.initialValues=o||{},l){var u,f=wt(o,a.store);(u=a.prevWithoutPreserves)===null||u===void 0||u.map(function(s){var _=s.key;f=Be(f,_,Ze(o,_))}),a.prevWithoutPreserves=null,a.updateStore(f)}}),A(this,"destroyForm",function(o){if(o)a.updateStore({});else{var l=new it;a.getFieldEntities(!0).forEach(function(u){a.isMergedPreserve(u.isPreserve())||l.set(u.getNamePath(),!0)}),a.prevWithoutPreserves=l}}),A(this,"getInitialValue",function(o){var l=Ze(a.initialValues,o);return o.length?wt(l):l}),A(this,"setCallbacks",function(o){a.callbacks=o}),A(this,"setValidateMessages",function(o){a.validateMessages=o}),A(this,"setPreserve",function(o){a.preserve=o}),A(this,"watchList",[]),A(this,"registerWatch",function(o){return a.watchList.push(o),function(){a.watchList=a.watchList.filter(function(l){return l!==o})}}),A(this,"notifyWatch",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(a.watchList.length){var l=a.getFieldsValue(),u=a.getFieldsValue(!0);a.watchList.forEach(function(f){f(l,u,o)})}}),A(this,"timeoutId",null),A(this,"warningUnhooked",function(){}),A(this,"updateStore",function(o){a.store=o}),A(this,"getFieldEntities",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return o?a.fieldEntities.filter(function(l){return l.getNamePath().length}):a.fieldEntities}),A(this,"getFieldsMap",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,l=new it;return a.getFieldEntities(o).forEach(function(u){var f=u.getNamePath();l.set(f,u)}),l}),A(this,"getFieldEntitiesForNamePathList",function(o){if(!o)return a.getFieldEntities(!0);var l=a.getFieldsMap(!0);return o.map(function(u){var f=Z(u);return l.get(f)||{INVALIDATE_NAME_PATH:Z(u)}})}),A(this,"getFieldsValue",function(o,l){a.warningUnhooked();var u,f,s;if(o===!0||Array.isArray(o)?(u=o,f=l):o&&te(o)==="object"&&(s=o.strict,f=o.filter),u===!0&&!f)return a.store;var _=a.getFieldEntitiesForNamePathList(Array.isArray(u)?u:null),y=[];return _.forEach(function(m){var x,e,t="INVALIDATE_NAME_PATH"in m?m.INVALIDATE_NAME_PATH:m.getNamePath();if(s){var n,d;if((n=(d=m).isList)!==null&&n!==void 0&&n.call(d))return}else if(!u&&(x=(e=m).isListField)!==null&&x!==void 0&&x.call(e))return;if(!f)y.push(t);else{var h="getMeta"in m?m.getMeta():null;f(h)&&y.push(t)}}),gr(a.store,y.map(Z))}),A(this,"getFieldValue",function(o){a.warningUnhooked();var l=Z(o);return Ze(a.store,l)}),A(this,"getFieldsError",function(o){a.warningUnhooked();var l=a.getFieldEntitiesForNamePathList(o);return l.map(function(u,f){return u&&!("INVALIDATE_NAME_PATH"in u)?{name:u.getNamePath(),errors:u.getErrors(),warnings:u.getWarnings()}:{name:Z(o[f]),errors:[],warnings:[]}})}),A(this,"getFieldError",function(o){a.warningUnhooked();var l=Z(o),u=a.getFieldsError([l])[0];return u.errors}),A(this,"getFieldWarning",function(o){a.warningUnhooked();var l=Z(o),u=a.getFieldsError([l])[0];return u.warnings}),A(this,"isFieldsTouched",function(){a.warningUnhooked();for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];var f=l[0],s=l[1],_,y=!1;l.length===0?_=null:l.length===1?Array.isArray(f)?(_=f.map(Z),y=!1):(_=null,y=f):(_=f.map(Z),y=s);var m=a.getFieldEntities(!0),x=function(h){return h.isFieldTouched()};if(!_)return y?m.every(function(d){return x(d)||d.isList()}):m.some(x);var e=new it;_.forEach(function(d){e.set(d,[])}),m.forEach(function(d){var h=d.getNamePath();_.forEach(function(g){g.every(function(p,v){return h[v]===p})&&e.update(g,function(p){return[].concat(D(p),[d])})})});var t=function(h){return h.some(x)},n=e.map(function(d){var h=d.value;return h});return y?n.every(t):n.some(t)}),A(this,"isFieldTouched",function(o){return a.warningUnhooked(),a.isFieldsTouched([o])}),A(this,"isFieldsValidating",function(o){a.warningUnhooked();var l=a.getFieldEntities();if(!o)return l.some(function(f){return f.isFieldValidating()});var u=o.map(Z);return l.some(function(f){var s=f.getNamePath();return gt(u,s)&&f.isFieldValidating()})}),A(this,"isFieldValidating",function(o){return a.warningUnhooked(),a.isFieldsValidating([o])}),A(this,"resetWithFieldInitialValue",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=new it,u=a.getFieldEntities(!0);u.forEach(function(_){var y=_.props.initialValue,m=_.getNamePath();if(y!==void 0){var x=l.get(m)||new Set;x.add({entity:_,value:y}),l.set(m,x)}});var f=function(y){y.forEach(function(m){var x=m.props.initialValue;if(x!==void 0){var e=m.getNamePath(),t=a.getInitialValue(e);if(t!==void 0)Oe(!1,"Form already set 'initialValues' with path '".concat(e.join("."),"'. Field can not overwrite it."));else{var n=l.get(e);if(n&&n.size>1)Oe(!1,"Multiple Field with path '".concat(e.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(n){var d=a.getFieldValue(e),h=m.isListField();!h&&(!o.skipExist||d===void 0)&&a.updateStore(Be(a.store,e,D(n)[0].value))}}}})},s;o.entities?s=o.entities:o.namePathList?(s=[],o.namePathList.forEach(function(_){var y=l.get(_);if(y){var m;(m=s).push.apply(m,D(D(y).map(function(x){return x.entity})))}})):s=u,f(s)}),A(this,"resetFields",function(o){a.warningUnhooked();var l=a.store;if(!o){a.updateStore(wt(a.initialValues)),a.resetWithFieldInitialValue(),a.notifyObservers(l,null,{type:"reset"}),a.notifyWatch();return}var u=o.map(Z);u.forEach(function(f){var s=a.getInitialValue(f);a.updateStore(Be(a.store,f,s))}),a.resetWithFieldInitialValue({namePathList:u}),a.notifyObservers(l,u,{type:"reset"}),a.notifyWatch(u)}),A(this,"setFields",function(o){a.warningUnhooked();var l=a.store,u=[];o.forEach(function(f){var s=f.name,_=yt(f,pa),y=Z(s);u.push(y),"value"in _&&a.updateStore(Be(a.store,y,_.value)),a.notifyObservers(l,[y],{type:"setField",data:f})}),a.notifyWatch(u)}),A(this,"getFields",function(){var o=a.getFieldEntities(!0),l=o.map(function(u){var f=u.getNamePath(),s=u.getMeta(),_=N(N({},s),{},{name:f,value:a.getFieldValue(f)});return Object.defineProperty(_,"originRCField",{value:!0}),_});return l}),A(this,"initEntityValue",function(o){var l=o.props.initialValue;if(l!==void 0){var u=o.getNamePath(),f=Ze(a.store,u);f===void 0&&a.updateStore(Be(a.store,u,l))}}),A(this,"isMergedPreserve",function(o){var l=o!==void 0?o:a.preserve;return l??!0}),A(this,"registerField",function(o){a.fieldEntities.push(o);var l=o.getNamePath();if(a.notifyWatch([l]),o.props.initialValue!==void 0){var u=a.store;a.resetWithFieldInitialValue({entities:[o],skipExist:!0}),a.notifyObservers(u,[o.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(f,s){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(a.fieldEntities=a.fieldEntities.filter(function(x){return x!==o}),!a.isMergedPreserve(s)&&(!f||_.length>1)){var y=f?void 0:a.getInitialValue(l);if(l.length&&a.getFieldValue(l)!==y&&a.fieldEntities.every(function(x){return!$r(x.getNamePath(),l)})){var m=a.store;a.updateStore(Be(m,l,y,!0)),a.notifyObservers(m,[l],{type:"remove"}),a.triggerDependenciesUpdate(m,l)}}a.notifyWatch([l])}}),A(this,"dispatch",function(o){switch(o.type){case"updateValue":{var l=o.namePath,u=o.value;a.updateValue(l,u);break}case"validateField":{var f=o.namePath,s=o.triggerName;a.validateFields([f],{triggerName:s});break}}}),A(this,"notifyObservers",function(o,l,u){if(a.subscribable){var f=N(N({},u),{},{store:a.getFieldsValue(!0)});a.getFieldEntities().forEach(function(s){var _=s.onStoreChange;_(o,l,f)})}else a.forceRootUpdate()}),A(this,"triggerDependenciesUpdate",function(o,l){var u=a.getDependencyChildrenFields(l);return u.length&&a.validateFields(u),a.notifyObservers(o,u,{type:"dependenciesUpdate",relatedFields:[l].concat(D(u))}),u}),A(this,"updateValue",function(o,l){var u=Z(o),f=a.store;a.updateStore(Be(a.store,u,l)),a.notifyObservers(f,[u],{type:"valueUpdate",source:"internal"}),a.notifyWatch([u]);var s=a.triggerDependenciesUpdate(f,u),_=a.callbacks.onValuesChange;if(_){var y=gr(a.store,[u]);_(y,a.getFieldsValue())}a.triggerOnFieldsChange([u].concat(D(s)))}),A(this,"setFieldsValue",function(o){a.warningUnhooked();var l=a.store;if(o){var u=wt(a.store,o);a.updateStore(u)}a.notifyObservers(l,null,{type:"valueUpdate",source:"external"}),a.notifyWatch()}),A(this,"setFieldValue",function(o,l){a.setFields([{name:o,value:l}])}),A(this,"getDependencyChildrenFields",function(o){var l=new Set,u=[],f=new it;a.getFieldEntities().forEach(function(_){var y=_.props.dependencies;(y||[]).forEach(function(m){var x=Z(m);f.update(x,function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return e.add(_),e})})});var s=function _(y){var m=f.get(y)||new Set;m.forEach(function(x){if(!l.has(x)){l.add(x);var e=x.getNamePath();x.isFieldDirty()&&e.length&&(u.push(e),_(e))}})};return s(o),u}),A(this,"triggerOnFieldsChange",function(o,l){var u=a.callbacks.onFieldsChange;if(u){var f=a.getFields();if(l){var s=new it;l.forEach(function(y){var m=y.name,x=y.errors;s.set(m,x)}),f.forEach(function(y){y.errors=s.get(y.name)||y.errors})}var _=f.filter(function(y){var m=y.name;return gt(o,m)});_.length&&u(_,f)}}),A(this,"validateFields",function(o,l){a.warningUnhooked();var u,f;Array.isArray(o)||typeof o=="string"||typeof l=="string"?(u=o,f=l):f=o;var s=!!u,_=s?u.map(Z):[],y=[],m=String(Date.now()),x=new Set,e=f||{},t=e.recursive,n=e.dirty;a.getFieldEntities(!0).forEach(function(p){if(s||_.push(p.getNamePath()),!(!p.props.rules||!p.props.rules.length)&&!(n&&!p.isFieldDirty())){var v=p.getNamePath();if(x.add(v.join(m)),!s||gt(_,v,t)){var b=p.validateRules(N({validateMessages:N(N({},Hr),a.validateMessages)},f));y.push(b.then(function(){return{name:v,errors:[],warnings:[]}}).catch(function(S){var U,F=[],k=[];return(U=S.forEach)===null||U===void 0||U.call(S,function(w){var I=w.rule.warningOnly,P=w.errors;I?k.push.apply(k,D(P)):F.push.apply(F,D(P))}),F.length?Promise.reject({name:v,errors:F,warnings:k}):{name:v,errors:F,warnings:k}}))}}});var d=fa(y);a.lastValidatePromise=d,d.catch(function(p){return p}).then(function(p){var v=p.map(function(b){var S=b.name;return S});a.notifyObservers(a.store,v,{type:"validateFinish"}),a.triggerOnFieldsChange(v,p)});var h=d.then(function(){return a.lastValidatePromise===d?Promise.resolve(a.getFieldsValue(_)):Promise.reject([])}).catch(function(p){var v=p.filter(function(b){return b&&b.errors.length});return Promise.reject({values:a.getFieldsValue(_),errorFields:v,outOfDate:a.lastValidatePromise!==d})});h.catch(function(p){return p});var g=_.filter(function(p){return x.has(p.join(m))});return a.triggerOnFieldsChange(g),h}),A(this,"submit",function(){a.warningUnhooked(),a.validateFields().then(function(o){var l=a.callbacks.onFinish;if(l)try{l(o)}catch(u){console.error(u)}}).catch(function(o){var l=a.callbacks.onFinishFailed;l&&l(o)})}),this.forceRootUpdate=r});function jr(c){var r=C.useRef(),a=C.useState({}),o=ie(a,2),l=o[1];if(!r.current)if(c)r.current=c;else{var u=function(){l({})},f=new ma(u);r.current=f.getForm()}return[r.current]}var Mi=C.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),ga=function(r){var a=r.validateMessages,o=r.onFormChange,l=r.onFormFinish,u=r.children,f=C.useContext(Mi),s=C.useRef({});return C.createElement(Mi.Provider,{value:N(N({},f),{},{validateMessages:N(N({},f.validateMessages),a),triggerFormChange:function(y,m){o&&o(y,{changedFields:m,forms:s.current}),f.triggerFormChange(y,m)},triggerFormFinish:function(y,m){l&&l(y,{values:m,forms:s.current}),f.triggerFormFinish(y,m)},registerForm:function(y,m){y&&(s.current=N(N({},s.current),{},A({},y,m))),f.registerForm(y,m)},unregisterForm:function(y){var m=N({},s.current);delete m[y],s.current=m,f.unregisterForm(y)}})},u)},_a=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"],ya=function(r,a){var o=r.name,l=r.initialValues,u=r.fields,f=r.form,s=r.preserve,_=r.children,y=r.component,m=y===void 0?"form":y,x=r.validateMessages,e=r.validateTrigger,t=e===void 0?"onChange":e,n=r.onValuesChange,d=r.onFieldsChange,h=r.onFinish,g=r.onFinishFailed,p=r.clearOnDestroy,v=yt(r,_a),b=C.useRef(null),S=C.useContext(Mi),U=jr(f),F=ie(U,1),k=F[0],w=k.getInternalHooks(Ke),I=w.useSubscribe,P=w.setInitialValues,R=w.setCallbacks,z=w.setValidateMessages,T=w.setPreserve,O=w.destroyForm;C.useImperativeHandle(a,function(){return N(N({},k),{},{nativeElement:b.current})}),C.useEffect(function(){return S.registerForm(o,k),function(){S.unregisterForm(o)}},[S,k,o]),z(N(N({},S.validateMessages),x)),R({onValuesChange:n,onFieldsChange:function(q){if(S.triggerFormChange(o,q),d){for(var H=arguments.length,J=new Array(H>1?H-1:0),Ie=1;Ie<H;Ie++)J[Ie-1]=arguments[Ie];d.apply(void 0,[q].concat(J))}},onFinish:function(q){S.triggerFormFinish(o,q),h&&h(q)},onFinishFailed:g}),T(s);var L=C.useRef(null);P(l,!L.current),L.current||(L.current=!0),C.useEffect(function(){return function(){return O(p)}},[]);var Y,re=typeof _=="function";if(re){var ee=k.getFieldsValue(!0);Y=_(ee,k)}else Y=_;I(!re);var se=C.useRef();C.useEffect(function(){da(se.current||[],u||[])||k.setFields(u||[]),se.current=u},[u,k]);var V=C.useMemo(function(){return N(N({},k),{},{validateTrigger:t})},[k,t]),Pe=C.createElement(oi.Provider,{value:null},C.createElement(_t.Provider,{value:V},Y));return m===!1?Pe:C.createElement(m,me({},v,{ref:b,onSubmit:function(q){q.preventDefault(),q.stopPropagation(),k.submit()},onReset:function(q){var H;q.preventDefault(),k.resetFields(),(H=v.onReset)===null||H===void 0||H.call(v,q)}}),Pe)};function vr(c){try{return JSON.stringify(c)}catch{return Math.random()}}function va(){for(var c=arguments.length,r=new Array(c),a=0;a<c;a++)r[a]=arguments[a];var o=r[0],l=r[1],u=l===void 0?{}:l,f=Fs(u)?{form:u}:u,s=f.form,_=C.useState(),y=ie(_,2),m=y[0],x=y[1],e=C.useMemo(function(){return vr(m)},[m]),t=C.useRef(e);t.current=e;var n=C.useContext(_t),d=s||n,h=d&&d._init,g=Z(o),p=C.useRef(g);return p.current=g,C.useEffect(function(){if(h){var v=d.getFieldsValue,b=d.getInternalHooks,S=b(Ke),U=S.registerWatch,F=function(P,R){var z=f.preserve?R:P;return typeof o=="function"?o(z):Ze(z,p.current)},k=U(function(I,P){var R=F(I,P),z=vr(R);t.current!==z&&(t.current=z,x(R))}),w=F(v(),v(!0));return m!==w&&x(w),k}},[h]),m}var ba=C.forwardRef(ya),Ht=ba;Ht.FormProvider=ga;Ht.Field=Yr;Ht.List=ua;Ht.useForm=jr;Ht.useWatch=va;const wa=C.createContext({}),Sa=ne.createContext({}),qr=C.createContext(null),xa=qr.Provider,Zr=C.createContext(null),Ua=Zr.Provider;var Ea=["prefixCls","className","style","checked","disabled","defaultChecked","type","title","onChange"],Ca=C.forwardRef(function(c,r){var a=c.prefixCls,o=a===void 0?"rc-checkbox":a,l=c.className,u=c.style,f=c.checked,s=c.disabled,_=c.defaultChecked,y=_===void 0?!1:_,m=c.type,x=m===void 0?"checkbox":m,e=c.title,t=c.onChange,n=yt(c,Ea),d=C.useRef(null),h=C.useRef(null),g=zr(y,{value:f}),p=ie(g,2),v=p[0],b=p[1];C.useImperativeHandle(r,function(){return{focus:function(k){var w;(w=d.current)===null||w===void 0||w.focus(k)},blur:function(){var k;(k=d.current)===null||k===void 0||k.blur()},input:d.current,nativeElement:h.current}});var S=he(o,l,A(A({},"".concat(o,"-checked"),v),"".concat(o,"-disabled"),s)),U=function(k){s||("checked"in c||b(k.target.checked),t==null||t({target:N(N({},c),{},{type:x,checked:k.target.checked}),stopPropagation:function(){k.stopPropagation()},preventDefault:function(){k.preventDefault()},nativeEvent:k.nativeEvent}))};return C.createElement("span",{className:S,title:e,style:u,ref:h},C.createElement("input",me({},n,{className:"".concat(o,"-input"),ref:d,onChange:U,disabled:s,checked:!!v,type:x})),C.createElement("span",{className:"".concat(o,"-inner")}))});const Fa=c=>{const{componentCls:r,antCls:a}=c,o=`${r}-group`;return{[o]:Object.assign(Object.assign({},ai(c)),{display:"inline-block",fontSize:0,[`&${o}-rtl`]:{direction:"rtl"},[`${a}-badge ${a}-badge-count`]:{zIndex:1},[`> ${a}-badge:not(:first-child) > ${a}-button-wrapper`]:{borderInlineStart:"none"}})}},ka=c=>{const{componentCls:r,wrapperMarginInlineEnd:a,colorPrimary:o,radioSize:l,motionDurationSlow:u,motionDurationMid:f,motionEaseInOutCirc:s,colorBgContainer:_,colorBorder:y,lineWidth:m,colorBgContainerDisabled:x,colorTextDisabled:e,paddingXS:t,dotColorDisabled:n,lineType:d,radioColor:h,radioBgColor:g,calc:p}=c,v=`${r}-inner`,S=p(l).sub(p(4).mul(2)),U=p(1).mul(l).equal({unit:!0});return{[`${r}-wrapper`]:Object.assign(Object.assign({},ai(c)),{display:"inline-flex",alignItems:"baseline",marginInlineStart:0,marginInlineEnd:a,cursor:"pointer",[`&${r}-wrapper-rtl`]:{direction:"rtl"},"&-disabled":{cursor:"not-allowed",color:c.colorTextDisabled},"&::after":{display:"inline-block",width:0,overflow:"hidden",content:'"\\a0"'},[`${r}-checked::after`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:"100%",height:"100%",border:`${je(m)} ${d} ${o}`,borderRadius:"50%",visibility:"hidden",opacity:0,content:'""'},[r]:Object.assign(Object.assign({},ai(c)),{position:"relative",display:"inline-block",outline:"none",cursor:"pointer",alignSelf:"center",borderRadius:"50%"}),[`${r}-wrapper:hover &,
        &:hover ${v}`]:{borderColor:o},[`${r}-input:focus-visible + ${v}`]:Object.assign({},Rr(c)),[`${r}:hover::after, ${r}-wrapper:hover &::after`]:{visibility:"visible"},[`${r}-inner`]:{"&::after":{boxSizing:"border-box",position:"absolute",insetBlockStart:"50%",insetInlineStart:"50%",display:"block",width:U,height:U,marginBlockStart:p(1).mul(l).div(-2).equal({unit:!0}),marginInlineStart:p(1).mul(l).div(-2).equal({unit:!0}),backgroundColor:h,borderBlockStart:0,borderInlineStart:0,borderRadius:U,transform:"scale(0)",opacity:0,transition:`all ${u} ${s}`,content:'""'},boxSizing:"border-box",position:"relative",insetBlockStart:0,insetInlineStart:0,display:"block",width:U,height:U,backgroundColor:_,borderColor:y,borderStyle:"solid",borderWidth:m,borderRadius:"50%",transition:`all ${f}`},[`${r}-input`]:{position:"absolute",inset:0,zIndex:1,cursor:"pointer",opacity:0},[`${r}-checked`]:{[v]:{borderColor:o,backgroundColor:g,"&::after":{transform:`scale(${c.calc(c.dotSize).div(l).equal()})`,opacity:1,transition:`all ${u} ${s}`}}},[`${r}-disabled`]:{cursor:"not-allowed",[v]:{backgroundColor:x,borderColor:y,cursor:"not-allowed","&::after":{backgroundColor:n}},[`${r}-input`]:{cursor:"not-allowed"},[`${r}-disabled + span`]:{color:e,cursor:"not-allowed"},[`&${r}-checked`]:{[v]:{"&::after":{transform:`scale(${p(S).div(l).equal()})`}}}},[`span${r} + *`]:{paddingInlineStart:t,paddingInlineEnd:t}})}},Aa=c=>{const{buttonColor:r,controlHeight:a,componentCls:o,lineWidth:l,lineType:u,colorBorder:f,motionDurationSlow:s,motionDurationMid:_,buttonPaddingInline:y,fontSize:m,buttonBg:x,fontSizeLG:e,controlHeightLG:t,controlHeightSM:n,paddingXS:d,borderRadius:h,borderRadiusSM:g,borderRadiusLG:p,buttonCheckedBg:v,buttonSolidCheckedColor:b,colorTextDisabled:S,colorBgContainerDisabled:U,buttonCheckedBgDisabled:F,buttonCheckedColorDisabled:k,colorPrimary:w,colorPrimaryHover:I,colorPrimaryActive:P,buttonSolidCheckedBg:R,buttonSolidCheckedHoverBg:z,buttonSolidCheckedActiveBg:T,calc:O}=c;return{[`${o}-button-wrapper`]:{position:"relative",display:"inline-block",height:a,margin:0,paddingInline:y,paddingBlock:0,color:r,fontSize:m,lineHeight:je(O(a).sub(O(l).mul(2)).equal()),background:x,border:`${je(l)} ${u} ${f}`,borderBlockStartWidth:O(l).add(.02).equal(),borderInlineStartWidth:0,borderInlineEndWidth:l,cursor:"pointer",transition:[`color ${_}`,`background ${_}`,`box-shadow ${_}`].join(","),a:{color:r},[`> ${o}-button`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,zIndex:-1,width:"100%",height:"100%"},"&:not(:first-child)":{"&::before":{position:"absolute",insetBlockStart:O(l).mul(-1).equal(),insetInlineStart:O(l).mul(-1).equal(),display:"block",boxSizing:"content-box",width:1,height:"100%",paddingBlock:l,paddingInline:0,backgroundColor:f,transition:`background-color ${s}`,content:'""'}},"&:first-child":{borderInlineStart:`${je(l)} ${u} ${f}`,borderStartStartRadius:h,borderEndStartRadius:h},"&:last-child":{borderStartEndRadius:h,borderEndEndRadius:h},"&:first-child:last-child":{borderRadius:h},[`${o}-group-large &`]:{height:t,fontSize:e,lineHeight:je(O(t).sub(O(l).mul(2)).equal()),"&:first-child":{borderStartStartRadius:p,borderEndStartRadius:p},"&:last-child":{borderStartEndRadius:p,borderEndEndRadius:p}},[`${o}-group-small &`]:{height:n,paddingInline:O(d).sub(l).equal(),paddingBlock:0,lineHeight:je(O(n).sub(O(l).mul(2)).equal()),"&:first-child":{borderStartStartRadius:g,borderEndStartRadius:g},"&:last-child":{borderStartEndRadius:g,borderEndEndRadius:g}},"&:hover":{position:"relative",color:w},"&:has(:focus-visible)":Object.assign({},Rr(c)),[`${o}-inner, input[type='checkbox'], input[type='radio']`]:{width:0,height:0,opacity:0,pointerEvents:"none"},[`&-checked:not(${o}-button-wrapper-disabled)`]:{zIndex:1,color:w,background:v,borderColor:w,"&::before":{backgroundColor:w},"&:first-child":{borderColor:w},"&:hover":{color:I,borderColor:I,"&::before":{backgroundColor:I}},"&:active":{color:P,borderColor:P,"&::before":{backgroundColor:P}}},[`${o}-group-solid &-checked:not(${o}-button-wrapper-disabled)`]:{color:b,background:R,borderColor:R,"&:hover":{color:b,background:z,borderColor:z},"&:active":{color:b,background:T,borderColor:T}},"&-disabled":{color:S,backgroundColor:U,borderColor:f,cursor:"not-allowed","&:first-child, &:hover":{color:S,backgroundColor:U,borderColor:f}},[`&-disabled${o}-button-wrapper-checked`]:{color:k,backgroundColor:F,borderColor:f,boxShadow:"none"}}}},Pa=c=>{const{wireframe:r,padding:a,marginXS:o,lineWidth:l,fontSizeLG:u,colorText:f,colorBgContainer:s,colorTextDisabled:_,controlItemBgActiveDisabled:y,colorTextLightSolid:m,colorPrimary:x,colorPrimaryHover:e,colorPrimaryActive:t,colorWhite:n}=c,d=4,h=u,g=r?h-d*2:h-(d+l)*2;return{radioSize:h,dotSize:g,dotColorDisabled:_,buttonSolidCheckedColor:m,buttonSolidCheckedBg:x,buttonSolidCheckedHoverBg:e,buttonSolidCheckedActiveBg:t,buttonBg:s,buttonCheckedBg:s,buttonColor:f,buttonCheckedBgDisabled:y,buttonCheckedColorDisabled:_,buttonPaddingInline:a-l,wrapperMarginInlineEnd:o,radioColor:r?x:n,radioBgColor:r?s:x}},Kr=Ar("Radio",c=>{const{controlOutline:r,controlOutlineWidth:a}=c,o=`0 0 0 ${je(a)} ${r}`,u=Pr(c,{radioFocusShadow:o,radioButtonFocusShadow:o});return[Fa(u),ka(u),Aa(u)]},Pa,{unitless:{radioSize:!0,dotSize:!0}});var Ia=function(c,r){var a={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&r.indexOf(o)<0&&(a[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(c);l<o.length;l++)r.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(c,o[l])&&(a[o[l]]=c[o[l]]);return a};const Ta=(c,r)=>{var a,o;const l=C.useContext(qr),u=C.useContext(Zr),{getPrefixCls:f,direction:s,radio:_}=C.useContext(vt),y=C.useRef(null),m=An(r,y),{isFormItemInput:x}=C.useContext(wa),e=T=>{var O,L;(O=c.onChange)===null||O===void 0||O.call(c,T),(L=l==null?void 0:l.onChange)===null||L===void 0||L.call(l,T)},{prefixCls:t,className:n,rootClassName:d,children:h,style:g,title:p}=c,v=Ia(c,["prefixCls","className","rootClassName","children","style","title"]),b=f("radio",t),S=((l==null?void 0:l.optionType)||u)==="button",U=S?`${b}-button`:b,F=mi(b),[k,w,I]=Kr(b,F),P=Object.assign({},v),R=C.useContext(Pn);l&&(P.name=l.name,P.onChange=e,P.checked=c.value===l.value,P.disabled=(a=P.disabled)!==null&&a!==void 0?a:l.disabled),P.disabled=(o=P.disabled)!==null&&o!==void 0?o:R;const z=he(`${U}-wrapper`,{[`${U}-wrapper-checked`]:P.checked,[`${U}-wrapper-disabled`]:P.disabled,[`${U}-wrapper-rtl`]:s==="rtl",[`${U}-wrapper-in-form-item`]:x},_==null?void 0:_.className,n,d,w,I,F);return k(C.createElement(In,{component:"Radio",disabled:P.disabled},C.createElement("label",{className:z,style:Object.assign(Object.assign({},_==null?void 0:_.style),g),onMouseEnter:c.onMouseEnter,onMouseLeave:c.onMouseLeave,title:p},C.createElement(Ca,Object.assign({},P,{className:he(P.className,{[Tn]:!S}),type:"radio",prefixCls:U,ref:m})),h!==void 0?C.createElement("span",null,h):null)))},li=C.forwardRef(Ta),Ba=C.forwardRef((c,r)=>{const{getPrefixCls:a,direction:o}=C.useContext(vt),[l,u]=zr(c.defaultValue,{value:c.value}),f=T=>{const O=l,L=T.target.value;"value"in c||u(L);const{onChange:Y}=c;Y&&L!==O&&Y(T)},{prefixCls:s,className:_,rootClassName:y,options:m,buttonStyle:x="outline",disabled:e,children:t,size:n,style:d,id:h,onMouseEnter:g,onMouseLeave:p,onFocus:v,onBlur:b}=c,S=a("radio",s),U=`${S}-group`,F=mi(S),[k,w,I]=Kr(S,F);let P=t;m&&m.length>0&&(P=m.map(T=>typeof T=="string"||typeof T=="number"?C.createElement(li,{key:T.toString(),prefixCls:S,disabled:e,value:T,checked:l===T},T):C.createElement(li,{key:`radio-group-value-options-${T.value}`,prefixCls:S,disabled:T.disabled||e,value:T.value,checked:l===T.value,title:T.title,style:T.style,id:T.id,required:T.required},T.label)));const R=Bn(n),z=he(U,`${U}-${x}`,{[`${U}-${R}`]:R,[`${U}-rtl`]:o==="rtl"},_,y,w,I,F);return k(C.createElement("div",Object.assign({},Lr(c,{aria:!0,data:!0}),{className:z,style:d,onMouseEnter:g,onMouseLeave:p,onFocus:v,onBlur:b,id:h,ref:r}),C.createElement(xa,{value:{onChange:f,value:l,disabled:c.disabled,name:c.name,optionType:c.optionType}},P)))}),za=C.memo(Ba);var Ra=function(c,r){var a={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&r.indexOf(o)<0&&(a[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(c);l<o.length;l++)r.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(c,o[l])&&(a[o[l]]=c[o[l]]);return a};const La=(c,r)=>{const{getPrefixCls:a}=C.useContext(vt),{prefixCls:o}=c,l=Ra(c,["prefixCls"]),u=a("radio",o);return C.createElement(Ua,{value:"button"},C.createElement(li,Object.assign({prefixCls:u},l,{type:"radio",ref:r})))},Ma=C.forwardRef(La),Xe=li;Xe.Button=Ma;Xe.Group=za;Xe.__ANT_RADIO=!0;let pe=null,Je=c=>c(),Rt=[],Lt={};function br(){const{getContainer:c,duration:r,rtl:a,maxCount:o,top:l}=Lt,u=(c==null?void 0:c())||document.body;return{getContainer:()=>u,duration:r,rtl:a,maxCount:o,top:l}}const Na=ne.forwardRef((c,r)=>{const{messageConfig:a,sync:o}=c,{getPrefixCls:l}=C.useContext(vt),u=Lt.prefixCls||l("message"),f=C.useContext(Sa),[s,_]=Vr(Object.assign(Object.assign(Object.assign({},a),{prefixCls:u}),f.message));return ne.useImperativeHandle(r,()=>{const y=Object.assign({},s);return Object.keys(y).forEach(m=>{y[m]=function(){return o(),s[m].apply(s,arguments)}}),{instance:y,sync:o}}),_}),Oa=ne.forwardRef((c,r)=>{const[a,o]=ne.useState(br),l=()=>{o(br)};ne.useEffect(l,[]);const u=Ln(),f=u.getRootPrefixCls(),s=u.getIconPrefixCls(),_=u.getTheme(),y=ne.createElement(Na,{ref:r,sync:l,messageConfig:a});return ne.createElement(Rn,{prefixCls:f,iconPrefixCls:s,theme:_},u.holderRender?u.holderRender(y):y)});function gi(){if(!pe){const c=document.createDocumentFragment(),r={fragment:c};pe=r,Je(()=>{zn(ne.createElement(Oa,{ref:a=>{const{instance:o,sync:l}=a||{};Promise.resolve().then(()=>{!r.instance&&o&&(r.instance=o,r.sync=l,gi())})}}),c)});return}pe.instance&&(Rt.forEach(c=>{const{type:r,skipped:a}=c;if(!a)switch(r){case"open":{Je(()=>{const o=pe.instance.open(Object.assign(Object.assign({},Lt),c.config));o==null||o.then(c.resolve),c.setCloseFn(o)});break}case"destroy":Je(()=>{pe==null||pe.instance.destroy(c.key)});break;default:Je(()=>{var o;const l=(o=pe.instance)[r].apply(o,D(c.args));l==null||l.then(c.resolve),c.setCloseFn(l)})}}),Rt=[])}function Da(c){Lt=Object.assign(Object.assign({},Lt),c),Je(()=>{var r;(r=pe==null?void 0:pe.sync)===null||r===void 0||r.call(pe)})}function Va(c){const r=ji(a=>{let o;const l={type:"open",config:c,resolve:a,setCloseFn:u=>{o=u}};return Rt.push(l),()=>{o?Je(()=>{o()}):l.skipped=!0}});return gi(),r}function Ga(c,r){const a=ji(o=>{let l;const u={type:c,args:r,resolve:o,setCloseFn:f=>{l=f}};return Rt.push(u),()=>{l?Je(()=>{l()}):u.skipped=!0}});return gi(),a}const Ha=c=>{Rt.push({type:"destroy",key:c}),gi()},$a=["success","info","warning","error","loading"],Ya={open:Va,destroy:Ha,config:Da,useMessage:Cs,_InternalPanelDoNotUseOrYouWillBeFired:ys},Xr=Ya;$a.forEach(c=>{Xr[c]=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return Ga(c,a)}});var Wa=Object.defineProperty,ja=(c,r,a)=>r in c?Wa(c,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[r]=a,K=(c,r,a)=>(ja(c,typeof r!="symbol"?r+"":r,a),a),Zi=(c,r,a)=>{if(!r.has(c))throw TypeError("Cannot "+a)},E=(c,r,a)=>(Zi(c,r,"read from private field"),a?a.call(c):r.get(c)),M=(c,r,a)=>{if(r.has(c))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(c):r.set(c,a)},B=(c,r,a,o)=>(Zi(c,r,"write to private field"),r.set(c,a),a),rt=(c,r,a)=>(Zi(c,r,"access private method"),a),Jr=(c,r,a)=>{if(!r.has(c))throw TypeError("Cannot "+a)},j=(c,r,a)=>(Jr(c,r,"read from private field"),a?a.call(c):r.get(c)),Ae=(c,r,a)=>{if(r.has(c))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(c):r.set(c,a)},Ue=(c,r,a,o)=>(Jr(c,r,"write to private field"),r.set(c,a),a);const Qr="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGcocil7aWYocj09PSIvIilyZXR1cm57cGFyZW50Om51bGwsbmFtZToiIn07Y29uc3QgZT1yLnNwbGl0KCIvIikuZmlsdGVyKGk9PmkubGVuZ3RoPjApO2lmKGUubGVuZ3RoPT09MCl0aHJvdyBFcnJvcigiSW52YWxpZCBwYXRoIik7Y29uc3Qgbj1lW2UubGVuZ3RoLTFdLGE9Ii8iK2Uuc2xpY2UoMCwtMSkuam9pbigiLyIpO3JldHVybntuYW1lOm4scGFyZW50OmF9fWFzeW5jIGZ1bmN0aW9uIHUocixlKXtjb25zdHtwYXJlbnQ6bixuYW1lOmF9PWcocik7aWYobj09bnVsbClyZXR1cm4gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7Y29uc3QgaT1uLnNwbGl0KCIvIikuZmlsdGVyKHQ9PnQubGVuZ3RoPjApO3RyeXtsZXQgdD1hd2FpdCBuYXZpZ2F0b3Iuc3RvcmFnZS5nZXREaXJlY3RvcnkoKTtmb3IoY29uc3QgcyBvZiBpKXQ9YXdhaXQgdC5nZXREaXJlY3RvcnlIYW5kbGUocyx7Y3JlYXRlOmUuY3JlYXRlfSk7cmV0dXJuIGUuaXNGaWxlP2F3YWl0IHQuZ2V0RmlsZUhhbmRsZShhLHtjcmVhdGU6ZS5jcmVhdGV9KTphd2FpdCB0LmdldERpcmVjdG9yeUhhbmRsZShhLHtjcmVhdGU6ZS5jcmVhdGV9KX1jYXRjaHtyZXR1cm4gbnVsbH19Y29uc3QgZj17fTtzZWxmLm9ubWVzc2FnZT1hc3luYyByPT57dmFyIGk7Y29uc3R7ZXZ0VHlwZTplLGFyZ3M6bn09ci5kYXRhO2xldCBhPWZbbi5maWxlUGF0aF07dHJ5e2xldCB0O2NvbnN0IHM9W107aWYoZT09PSJyZWdpc3RlciIpe2NvbnN0IGw9YXdhaXQgdShuLmZpbGVQYXRoLHtjcmVhdGU6ITAsaXNGaWxlOiEwfSk7aWYobD09bnVsbCl0aHJvdyBFcnJvcihgbm90IGZvdW5kIGZpbGU6ICR7bi5maWxlUGF0aH1gKTthPWF3YWl0IGwuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpLGZbbi5maWxlUGF0aF09YX1lbHNlIGlmKGU9PT0iY2xvc2UiKWEuY2xvc2UoKSxkZWxldGUgZltuLmZpbGVQYXRoXTtlbHNlIGlmKGU9PT0idHJ1bmNhdGUiKWEudHJ1bmNhdGUobi5uZXdTaXplKTtlbHNlIGlmKGU9PT0id3JpdGUiKXtjb25zdHtkYXRhOmwsb3B0czpvfT1yLmRhdGEuYXJnczt0PWEud3JpdGUobCxvKX1lbHNlIGlmKGU9PT0icmVhZCIpe2NvbnN0e29mZnNldDpsLHNpemU6b309ci5kYXRhLmFyZ3MsYz1uZXcgQXJyYXlCdWZmZXIobyksZD1hLnJlYWQoYyx7YXQ6bH0pO3Q9ZD09PW8/YzooKGk9Yy50cmFuc2Zlcik9PW51bGw/dm9pZCAwOmkuY2FsbChjLGQpKT8/Yy5zbGljZSgwLGQpLHMucHVzaCh0KX1lbHNlIGU9PT0iZ2V0U2l6ZSI/dD1hLmdldFNpemUoKTplPT09ImZsdXNoIiYmYS5mbHVzaCgpO3NlbGYucG9zdE1lc3NhZ2Uoe2V2dFR5cGU6ImNhbGxiYWNrIixjYklkOnIuZGF0YS5jYklkLHJldHVyblZhbDp0fSxzKX1jYXRjaCh0KXtjb25zdCBzPXQ7c2VsZi5wb3N0TWVzc2FnZSh7ZXZ0VHlwZToidGhyb3dFcnJvciIsY2JJZDpyLmRhdGEuY2JJZCxlcnJNc2c6cy5uYW1lKyI6ICIrcy5tZXNzYWdlK2AKYCtKU09OLnN0cmluZ2lmeShyLmRhdGEpfSl9fX0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPW9wZnMtd29ya2VyLVFoOG1Wa295LmpzLm1hcAo=",wr=typeof window<"u"&&window.Blob&&new Blob([atob(Qr)],{type:"text/javascript;charset=utf-8"});function qa(c){let r;try{if(r=wr&&(window.URL||window.webkitURL).createObjectURL(wr),!r)throw"";const a=new Worker(r,{name:c==null?void 0:c.name});return a.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(r)}),a}catch{return new Worker("data:application/javascript;base64,"+Qr,{name:c==null?void 0:c.name})}finally{r&&(window.URL||window.webkitURL).revokeObjectURL(r)}}async function Za(c){const r=Ka();return await r("register",{filePath:c}),{read:async(a,o)=>await r("read",{filePath:c,offset:a,size:o}),write:async(a,o)=>await r("write",{filePath:c,data:a,opts:o},[ArrayBuffer.isView(a)?a.buffer:a]),close:async()=>await r("close",{filePath:c}),truncate:async a=>await r("truncate",{filePath:c,newSize:a}),getSize:async()=>await r("getSize",{filePath:c}),flush:async()=>await r("flush",{filePath:c})}}const qt=[];let Fi=0;function Ka(){if(qt.length<3){const r=c();return qt.push(r),r}else{const r=qt[Fi];return Fi=(Fi+1)%qt.length,r}function c(){const r=new qa;let a=0,o={};return r.onmessage=({data:l})=>{var u,f;l.evtType==="callback"?(u=o[l.cbId])==null||u.resolve(l.returnVal):l.evtType==="throwError"&&((f=o[l.cbId])==null||f.reject(Error(l.errMsg))),delete o[l.cbId]},async function(l,u,f=[]){a+=1;const s=new Promise((_,y)=>{o[a]={resolve:_,reject:y}});return r.postMessage({cbId:a,evtType:l,args:u},f),s}}}function _i(c){if(c==="/")return{parent:null,name:""};const r=c.split("/").filter(l=>l.length>0);if(r.length===0)throw Error("Invalid path");const a=r[r.length-1],o="/"+r.slice(0,-1).join("/");return{name:a,parent:o}}async function Ne(c,r){const{parent:a,name:o}=_i(c);if(a==null)return await navigator.storage.getDirectory();const l=a.split("/").filter(u=>u.length>0);try{let u=await navigator.storage.getDirectory();for(const f of l)u=await u.getDirectoryHandle(f,{create:r.create});return r.isFile?await u.getFileHandle(o,{create:r.create}):await u.getDirectoryHandle(o,{create:r.create})}catch{return null}}async function en(c){const{parent:r,name:a}=_i(c);if(r==null){const l=await navigator.storage.getDirectory();for await(const u of l.keys())await l.removeEntry(u,{recursive:!0});return}const o=await Ne(r,{create:!1,isFile:!1});o!=null&&await o.removeEntry(a,{recursive:!0})}function Ni(c,r){return`${c}/${r}`.replace("//","/")}function pt(c){return new tn(c)}var ye,Kt,xt;class tn{constructor(r){Ae(this,ye,void 0),Ae(this,Kt,void 0),Ae(this,xt,void 0),Ue(this,ye,r);const{parent:a,name:o}=_i(r);Ue(this,Kt,o),Ue(this,xt,a)}get kind(){return"dir"}get name(){return j(this,Kt)}get path(){return j(this,ye)}get parent(){return j(this,xt)==null?null:pt(j(this,xt))}async create(){return await Ne(j(this,ye),{create:!0,isFile:!1}),pt(j(this,ye))}async exists(){return await Ne(j(this,ye),{create:!1,isFile:!1})instanceof FileSystemDirectoryHandle}async remove(){await en(j(this,ye))}async children(){const r=await Ne(j(this,ye),{create:!1,isFile:!1});if(r==null)return[];const a=[];for await(const o of r.values())a.push((o.kind==="file"?Qe:pt)(Ni(j(this,ye),o.name)));return a}async copyTo(r){if(!await this.exists())throw Error(`dir ${this.path} not exists`);const a=await r.exists()?pt(Ni(r.path,this.name)):r;return await a.create(),await Promise.all((await this.children()).map(o=>o.copyTo(a))),a}async moveTo(r){const a=await this.copyTo(r);return await this.remove(),a}}ye=new WeakMap,Kt=new WeakMap,xt=new WeakMap;const Sr=new Map;function Qe(c){const r=Sr.get(c)??new Oi(c);return Sr.set(c,r),r}async function Ki(c,r,a={overwrite:!0}){if(r instanceof Oi){await Ki(c,await r.stream(),a);return}const o=await(c instanceof Oi?c:Qe(c)).createWriter();try{if(a.overwrite&&await o.truncate(0),r instanceof ReadableStream){const l=r.getReader();for(;;){const{done:u,value:f}=await l.read();if(u)break;await o.write(f)}}else await o.write(r)}catch(l){throw l}finally{await o.close()}}var ve,Ut,Xt,ze,Jt,Et;const Xa=class rn{constructor(r){Ae(this,ve,void 0),Ae(this,Ut,void 0),Ae(this,Xt,void 0),Ae(this,ze,0),Ae(this,Jt,(()=>{let l=null;return()=>(Ue(this,ze,j(this,ze)+1),l??(l=new Promise(async(u,f)=>{try{const s=await Za(j(this,ve));u([s,async()=>{Ue(this,ze,j(this,ze)-1),!(j(this,ze)>0)&&(l=null,await s.close())}])}catch(s){f(s)}})))})()),Ae(this,Et,!1),Ue(this,ve,r);const{parent:a,name:o}=_i(r);Ue(this,Xt,o),Ue(this,Ut,a)}get kind(){return"file"}get path(){return j(this,ve)}get name(){return j(this,Xt)}get parent(){return j(this,Ut)==null?null:pt(j(this,Ut))}async createWriter(){if(j(this,Et))throw Error("Other writer have not been closed");Ue(this,Et,!0);const r=new TextEncoder,[a,o]=await j(this,Jt).call(this);let l=await a.getSize(),u=!1;return{write:async(f,s={})=>{if(u)throw Error("Writer is closed");const _=typeof f=="string"?r.encode(f):f,y=s.at??l,m=_.byteLength;return l=y+m,await a.write(_,{at:y})},truncate:async f=>{if(u)throw Error("Writer is closed");await a.truncate(f),l>f&&(l=f)},flush:async()=>{if(u)throw Error("Writer is closed");await a.flush()},close:async()=>{if(u)throw Error("Writer is closed");u=!0,Ue(this,Et,!1),await o()}}}async createReader(){const[r,a]=await j(this,Jt).call(this);let o=!1,l=0;return{read:async(u,f={})=>{if(o)throw Error("Reader is closed");const s=f.at??l,_=await r.read(s,u);return l=s+_.byteLength,_},getSize:async()=>{if(o)throw Error("Reader is closed");return await r.getSize()},close:async()=>{if(o)throw Error("Reader is closed");o=!0,await a()}}}async text(){return new TextDecoder().decode(await this.arrayBuffer())}async arrayBuffer(){const r=await Ne(j(this,ve),{create:!1,isFile:!0});return r==null?new ArrayBuffer(0):(await r.getFile()).arrayBuffer()}async stream(){const r=await Ne(j(this,ve),{create:!1,isFile:!0});return r==null?new ReadableStream({pull:a=>{a.close()}}):(await r.getFile()).stream()}async getSize(){const r=await Ne(j(this,ve),{create:!1,isFile:!0});return r==null?0:(await r.getFile()).size}async exists(){return await Ne(j(this,ve),{create:!1,isFile:!0})instanceof FileSystemFileHandle}async remove(){if(j(this,ze))throw Error("exists unclosed reader/writer");await en(j(this,ve))}async copyTo(r){if(!await this.exists())throw Error(`file ${this.path} not exists`);if(r instanceof rn)return Qe(r.path)===this?this:(await Ki(r.path,this),Qe(r.path));if(r instanceof tn)return await this.copyTo(Qe(Ni(r.path,this.name)));throw Error("Illegal target type")}async moveTo(r){const a=await this.copyTo(r);return await this.remove(),a}};ve=new WeakMap,Ut=new WeakMap,Xt=new WeakMap,ze=new WeakMap,Jt=new WeakMap,Et=new WeakMap;let Oi=Xa;const Xi="/.opfs-tools-temp-dir";async function nn(c){try{if(c.kind==="file"){const r=await c.createWriter();await r.truncate(0),await r.close(),await c.remove()}else await c.remove();return!0}catch(r){return console.warn(r),!1}}function Ja(){setInterval(async()=>{for(const c of await pt(Xi).children()){const r=/^\d+-(\d+)$/.exec(c.name);(r==null||Date.now()-Number(r[1])>2592e5)&&await nn(c)}},60*1e3)}const Di=[];let xr=!1;async function Qa(){const c="OPFS_TOOLS_EXPIRES_TMP_FILES";xr||(xr=!0,self.addEventListener("unload",()=>{Di.length!==0&&localStorage.setItem(c,`${localStorage.getItem(c)??""},${Di.join(",")}`)}));let r=localStorage.getItem(c)??"";for(const a of r.split(","))a.length!==0&&await nn(Qe(`${Xi}/${a}`))&&(r=r.replace(a,""));localStorage.setItem(c,r.replace(/,{2,}/g,","))}(async function(){Ja(),await Qa()})();function sn(){const c=`${Math.random().toString().slice(2)}-${Date.now()}`;return Di.push(c),Qe(`${Xi}/${c}`)}function eo(c){return c instanceof Error?String(c):typeof c=="object"?JSON.stringify(c,(r,a)=>a instanceof Error?String(a):a):String(c)}function to(){const c=new Date;return`${c.getHours()}:${c.getMinutes()}:${c.getSeconds()}.${c.getMilliseconds()}`}let an=1;const on=sn();let Mt=null;(async function(){Mt=await on.createWriter()})();const Ur=["debug","info","warn","error"].reduce((c,r,a)=>Object.assign(c,{[r]:(...o)=>{an<=a&&(console[r](...o),Mt==null||Mt.write(`[${r}][${to()}]  ${o.map(l=>eo(l)).join(" ")}
`))}}),{}),$t=new Map,Q={setLogLevel:c=>{an=$t.get(c)??1},...Ur,create:c=>Object.fromEntries(Object.entries(Ur).map(([r,a])=>[r,(...o)=>a(c,...o)])),async dump(){return await(Mt==null?void 0:Mt.flush()),await on.text()}};$t.set(Q.debug,0);$t.set(Q.info,1);$t.set(Q.warn,2);$t.set(Q.error,3);const io=()=>{let c,r=16.6;self.onmessage=a=>{a.data.event==="start"&&(self.clearInterval(c),c=self.setInterval(()=>{self.postMessage({})},r)),a.data.event==="stop"&&self.clearInterval(c)}},ro=()=>{const c=new Blob([`(${io.toString()})()`]),r=URL.createObjectURL(c);return new Worker(r)},nt=new Map;let Vi=1;const Gi=ro();Gi.onmessage=()=>{Vi+=1;for(const[c,r]of nt.entries())Vi%c===0&&r.forEach(a=>a())};const no=(c,r)=>{const a=Math.round(r/16.6),o=nt.get(a)??new Set;return o.add(c),nt.set(a,o),nt.size===1&&o.size===1&&Gi.postMessage({event:"start"}),()=>{o.delete(c),o.size===0&&nt.delete(a),nt.size===0&&(Vi=0,Gi.postMessage({event:"stop"}))}};class so{constructor(r,a,o){this.length_=r,this.scaleFactor_=(r-1)/a,this.interpolate=this.cubic,o.method==="point"?this.interpolate=this.point:o.method==="linear"?this.interpolate=this.linear:o.method==="sinc"&&(this.interpolate=this.sinc),this.tangentFactor_=1-Math.max(0,Math.min(1,o.tension||0)),this.sincFilterSize_=o.sincFilterSize||1,this.kernel_=oo(o.sincWindow||ao)}point(r,a){return this.getClippedInput_(Math.round(this.scaleFactor_*r),a)}linear(r,a){r=this.scaleFactor_*r;let o=Math.floor(r);return r-=o,(1-r)*this.getClippedInput_(o,a)+r*this.getClippedInput_(o+1,a)}cubic(r,a){r=this.scaleFactor_*r;let o=Math.floor(r),l=[this.getTangent_(o,a),this.getTangent_(o+1,a)],u=[this.getClippedInput_(o,a),this.getClippedInput_(o+1,a)];r-=o;let f=r*r,s=r*f;return(2*s-3*f+1)*u[0]+(s-2*f+r)*l[0]+(-2*s+3*f)*u[1]+(s-f)*l[1]}sinc(r,a){r=this.scaleFactor_*r;let o=Math.floor(r),l=o-this.sincFilterSize_+1,u=o+this.sincFilterSize_,f=0;for(let s=l;s<=u;s++)f+=this.kernel_(r-s)*this.getClippedInput_(s,a);return f}getTangent_(r,a){return this.tangentFactor_*(this.getClippedInput_(r+1,a)-this.getClippedInput_(r-1,a))/2}getClippedInput_(r,a){return 0<=r&&r<this.length_?a[r]:0}}function ao(c){return Math.exp(-c/2*c/2)}function oo(c){return function(r){return lo(r)*c(r)}}function lo(c){return c===0?1:Math.sin(Math.PI*c)/(Math.PI*c)}class co{constructor(r,a,o){let l=2*Math.PI*o/a,u=0;this.filters=[];for(let f=0;f<=r;f++)f-r/2===0?this.filters[f]=l:(this.filters[f]=Math.sin(l*(f-r/2))/(f-r/2),this.filters[f]*=.54-.46*Math.cos(2*Math.PI*f/r)),u=u+this.filters[f];for(let f=0;f<=r;f++)this.filters[f]/=u;this.z=this.initZ_()}filter(r){this.z.buf[this.z.pointer]=r;let a=0;for(let o=0,l=this.z.buf.length;o<l;o++)a+=this.filters[o]*this.z.buf[(this.z.pointer+o)%this.z.buf.length];return this.z.pointer=(this.z.pointer+1)%this.z.buf.length,a}reset(){this.z=this.initZ_()}initZ_(){let r=[];for(let a=0;a<this.filters.length-1;a++)r.push(0);return{buf:r,pointer:0}}}class ho{constructor(r,a,o){let l=[];for(let u=0;u<r;u++)l.push(this.getCoeffs_({Fs:a,Fc:o,Q:.5/Math.sin(Math.PI/(r*2)*(u+.5))}));this.stages=[];for(let u=0;u<l.length;u++)this.stages[u]={b0:l[u].b[0],b1:l[u].b[1],b2:l[u].b[2],a1:l[u].a[0],a2:l[u].a[1],k:l[u].k,z:[0,0]}}filter(r){let a=r;for(let o=0,l=this.stages.length;o<l;o++)a=this.runStage_(o,a);return a}getCoeffs_(r){let a={};a.z=[0,0],a.a=[],a.b=[];let o=this.preCalc_(r,a);return a.k=1,a.b.push((1-o.cw)/(2*o.a0)),a.b.push(2*a.b[0]),a.b.push(a.b[0]),a}preCalc_(r,a){let o={},l=2*Math.PI*r.Fc/r.Fs;return o.alpha=Math.sin(l)/(2*r.Q),o.cw=Math.cos(l),o.a0=1+o.alpha,a.a0=o.a0,a.a.push(-2*o.cw/o.a0),a.k=1,a.a.push((1-o.alpha)/o.a0),o}runStage_(r,a){let o=a*this.stages[r].k-this.stages[r].a1*this.stages[r].z[0]-this.stages[r].a2*this.stages[r].z[1],l=this.stages[r].b0*o+this.stages[r].b1*this.stages[r].z[0]+this.stages[r].b2*this.stages[r].z[1];return this.stages[r].z[1]=this.stages[r].z[0],this.stages[r].z[0]=o,l}reset(){for(let r=0;r<this.stages.length;r++)this.stages[r].z=[0,0]}}const uo={point:!1,linear:!1,cubic:!0,sinc:!0},Er={IIR:16,FIR:71},fo={IIR:ho,FIR:co};function po(c,r,a,o={}){let l=(a-r)/r+1,u=new Float64Array(c.length*l);o.method=o.method||"cubic";let f=new so(c.length,u.length,{method:o.method,tension:o.tension||0,sincFilterSize:o.sincFilterSize||6,sincWindow:o.sincWindow||void 0});if(o.LPF===void 0&&(o.LPF=uo[o.method]),o.LPF){o.LPFType=o.LPFType||"IIR";const s=fo[o.LPFType];if(a>r){let _=new s(o.LPFOrder||Er[o.LPFType],a,r/2);mo(c,u,f,_)}else{let _=new s(o.LPFOrder||Er[o.LPFType],r,a/2);go(c,u,f,_)}}else ln(c,u,f);return u}function ln(c,r,a){for(let o=0,l=r.length;o<l;o++)r[o]=a.interpolate(o,c)}function mo(c,r,a,o){for(let l=0,u=r.length;l<u;l++)r[l]=o.filter(a.interpolate(l,c));o.reset();for(let l=r.length-1;l>=0;l--)r[l]=o.filter(r[l])}function go(c,r,a,o){for(let l=0,u=c.length;l<u;l++)c[l]=o.filter(c[l]);o.reset();for(let l=c.length-1;l>=0;l--)c[l]=o.filter(c[l]);ln(c,r,a)}function _o(c){const r=new Float32Array(c.map(o=>o.length).reduce((o,l)=>o+l));let a=0;for(const o of c)r.set(o,a),a+=o.length;return r}function yo(c){const r=[];for(let a=0;a<c.length;a+=1)for(let o=0;o<c[a].length;o+=1)r[o]==null&&(r[o]=[]),r[o].push(c[a][o]);return r.map(_o)}function vo(c){if(c.format==="f32-planar"){const r=[];for(let a=0;a<c.numberOfChannels;a+=1){const o=c.allocationSize({planeIndex:a}),l=new ArrayBuffer(o);c.copyTo(l,{planeIndex:a}),r.push(new Float32Array(l))}return r}else if(c.format==="s16"){const r=new ArrayBuffer(c.allocationSize({planeIndex:0}));return c.copyTo(r,{planeIndex:0}),bo(new Int16Array(r),c.numberOfChannels)}throw Error("Unsupported audio data format")}function bo(c,r){const a=c.length/r,o=Array.from({length:r},()=>new Float32Array(a));for(let l=0;l<a;l++)for(let u=0;u<r;u++){const f=c[l*r+u];o[u][l]=f/32768}return o}function dn(c){return Array(c.numberOfChannels).fill(0).map((r,a)=>c.getChannelData(a))}async function wo(c,r,a){const o=c.length,l=Array(a.chanCount).fill(0).map(()=>new Float32Array(0));if(o===0)return l;const u=Math.max(...c.map(y=>y.length));if(u===0)return l;if(globalThis.OfflineAudioContext==null)return c.map(y=>new Float32Array(po(y,r,a.rate,{method:"sinc",LPF:!1})));const f=new globalThis.OfflineAudioContext(a.chanCount,u*a.rate/r,a.rate),s=f.createBufferSource(),_=f.createBuffer(o,u,r);return c.forEach((y,m)=>_.copyToChannel(y,m)),s.buffer=_,s.connect(f.destination),s.start(),dn(await f.startRendering())}function cn(c){return new Promise(r=>{const a=no(()=>{a(),r()},c)})}function Cr(c,r,a){const o=a-r,l=new Float32Array(o);let u=0;for(;u<o;)l[u]=c[(r+u)%c.length],u+=1;return l}function hn(c,r){let a=!1;async function o(){const l=c.getReader();for(;!a;){const{value:u,done:f}=await l.read();if(f){r.onDone();return}await r.onChunk(u)}l.releaseLock(),await c.cancel()}return o().catch(Q.error),()=>{a=!0}}function So(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var un={};(function(c){var r=function(){var e=new Date,t=4,n=3,d=2,h=1,g=t,p={setLogLevel:function(v){v==this.debug?g=h:v==this.info?g=d:v==this.warn?g=n:(v==this.error,g=t)},debug:function(v,b){console.debug===void 0&&(console.debug=console.log),h>=g&&console.debug("["+r.getDurationString(new Date-e,1e3)+"]","["+v+"]",b)},log:function(v,b){this.debug(v.msg)},info:function(v,b){d>=g&&console.info("["+r.getDurationString(new Date-e,1e3)+"]","["+v+"]",b)},warn:function(v,b){n>=g&&console.warn("["+r.getDurationString(new Date-e,1e3)+"]","["+v+"]",b)},error:function(v,b){t>=g&&console.error("["+r.getDurationString(new Date-e,1e3)+"]","["+v+"]",b)}};return p}();r.getDurationString=function(e,t){var n;function d(S,U){for(var F=""+S,k=F.split(".");k[0].length<U;)k[0]="0"+k[0];return k.join(".")}e<0?(n=!0,e=-e):n=!1;var h=t||1,g=e/h,p=Math.floor(g/3600);g-=p*3600;var v=Math.floor(g/60);g-=v*60;var b=g*1e3;return g=Math.floor(g),b-=g*1e3,b=Math.floor(b),(n?"-":"")+p+":"+d(v,2)+":"+d(g,2)+"."+d(b,3)},r.printRanges=function(e){var t=e.length;if(t>0){for(var n="",d=0;d<t;d++)d>0&&(n+=","),n+="["+r.getDurationString(e.start(d))+","+r.getDurationString(e.end(d))+"]";return n}else return"(empty)"},c.Log=r;var a=function(e){if(e instanceof ArrayBuffer)this.buffer=e,this.dataview=new DataView(e);else throw"Needs an array buffer";this.position=0};a.prototype.getPosition=function(){return this.position},a.prototype.getEndPosition=function(){return this.buffer.byteLength},a.prototype.getLength=function(){return this.buffer.byteLength},a.prototype.seek=function(e){var t=Math.max(0,Math.min(this.buffer.byteLength,e));return this.position=isNaN(t)||!isFinite(t)?0:t,!0},a.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},a.prototype.readAnyInt=function(e,t){var n=0;if(this.position+e<=this.buffer.byteLength){switch(e){case 1:t?n=this.dataview.getInt8(this.position):n=this.dataview.getUint8(this.position);break;case 2:t?n=this.dataview.getInt16(this.position):n=this.dataview.getUint16(this.position);break;case 3:if(t)throw"No method for reading signed 24 bits values";n=this.dataview.getUint8(this.position)<<16,n|=this.dataview.getUint8(this.position+1)<<8,n|=this.dataview.getUint8(this.position+2);break;case 4:t?n=this.dataview.getInt32(this.position):n=this.dataview.getUint32(this.position);break;case 8:if(t)throw"No method for reading signed 64 bits values";n=this.dataview.getUint32(this.position)<<32,n|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+e}return this.position+=e,n}else throw"Not enough bytes in buffer"},a.prototype.readUint8=function(){return this.readAnyInt(1,!1)},a.prototype.readUint16=function(){return this.readAnyInt(2,!1)},a.prototype.readUint24=function(){return this.readAnyInt(3,!1)},a.prototype.readUint32=function(){return this.readAnyInt(4,!1)},a.prototype.readUint64=function(){return this.readAnyInt(8,!1)},a.prototype.readString=function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readUint8());return t}else throw"Not enough bytes in buffer"},a.prototype.readCString=function(){for(var e=[];;){var t=this.readUint8();if(t!==0)e.push(t);else break}return String.fromCharCode.apply(null,e)},a.prototype.readInt8=function(){return this.readAnyInt(1,!0)},a.prototype.readInt16=function(){return this.readAnyInt(2,!0)},a.prototype.readInt32=function(){return this.readAnyInt(4,!0)},a.prototype.readInt64=function(){return this.readAnyInt(8,!1)},a.prototype.readUint8Array=function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readUint8();return t},a.prototype.readInt16Array=function(e){for(var t=new Int16Array(e),n=0;n<e;n++)t[n]=this.readInt16();return t},a.prototype.readUint16Array=function(e){for(var t=new Int16Array(e),n=0;n<e;n++)t[n]=this.readUint16();return t},a.prototype.readUint32Array=function(e){for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=this.readUint32();return t},a.prototype.readInt32Array=function(e){for(var t=new Int32Array(e),n=0;n<e;n++)t[n]=this.readInt32();return t},c.MP4BoxStream=a;var o=function(e,t,n){this._byteOffset=t||0,e instanceof ArrayBuffer?this.buffer=e:typeof e=="object"?(this.dataView=e,t&&(this._byteOffset+=t)):this.buffer=new ArrayBuffer(e||0),this.position=0,this.endianness=n??o.LITTLE_ENDIAN};o.prototype={},o.prototype.getPosition=function(){return this.position},o.prototype._realloc=function(e){if(this._dynamicSize){var t=this._byteOffset+this.position+e,n=this._buffer.byteLength;if(t<=n){t>this._byteLength&&(this._byteLength=t);return}for(n<1&&(n=1);t>n;)n*=2;var d=new ArrayBuffer(n),h=new Uint8Array(this._buffer),g=new Uint8Array(d,0,h.length);g.set(h),this.buffer=d,this._byteLength=t}},o.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),n=new Uint8Array(this._buffer,0,t.length);t.set(n),this.buffer=e}},o.BIG_ENDIAN=!1,o.LITTLE_ENDIAN=!0,o.prototype._byteLength=0,Object.defineProperty(o.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(o.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(o.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(o.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),o.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},o.prototype.isEof=function(){return this.position>=this._byteLength},o.prototype.mapUint8Array=function(e){this._realloc(e*1);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=e*1,t},o.prototype.readInt32Array=function(e,t){e=e??this.byteLength-this.position/4;var n=new Int32Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readInt16Array=function(e,t){e=e??this.byteLength-this.position/2;var n=new Int16Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readInt8Array=function(e){e=e??this.byteLength-this.position;var t=new Int8Array(e);return o.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},o.prototype.readUint32Array=function(e,t){e=e??this.byteLength-this.position/4;var n=new Uint32Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readUint16Array=function(e,t){e=e??this.byteLength-this.position/2;var n=new Uint16Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readUint8Array=function(e){e=e??this.byteLength-this.position;var t=new Uint8Array(e);return o.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},o.prototype.readFloat64Array=function(e,t){e=e??this.byteLength-this.position/8;var n=new Float64Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readFloat32Array=function(e,t){e=e??this.byteLength-this.position/4;var n=new Float32Array(e);return o.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),o.arrayToNative(n,t??this.endianness),this.position+=n.byteLength,n},o.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,e??this.endianness);return this.position+=4,t},o.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,e??this.endianness);return this.position+=2,t},o.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},o.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,e??this.endianness);return this.position+=4,t},o.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,e??this.endianness);return this.position+=2,t},o.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},o.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,e??this.endianness);return this.position+=4,t},o.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,e??this.endianness);return this.position+=8,t},o.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,o.memcpy=function(e,t,n,d,h){var g=new Uint8Array(e,t,h),p=new Uint8Array(n,d,h);g.set(p)},o.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},o.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},o.flipArrayEndianness=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=e.BYTES_PER_ELEMENT)for(var d=n+e.BYTES_PER_ELEMENT-1,h=n;d>h;d--,h++){var g=t[h];t[h]=t[d],t[d]=g}return e},o.prototype.failurePosition=0,String.fromCharCodeUint8=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return String.fromCharCode.apply(null,t)},o.prototype.readString=function(e,t){return t==null||t=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(e??this.byteLength-this.position)]):new TextDecoder(t).decode(this.mapUint8Array(e))},o.prototype.readCString=function(e){var t=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),d=t;e!=null&&(d=Math.min(e,t));for(var h=0;h<d&&n[h]!==0;h++);var g=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(h)]);return e!=null?this.position+=d-h:h!=t&&(this.position+=1),g};var l=Math.pow(2,32);o.prototype.readInt64=function(){return this.readInt32()*l+this.readUint32()},o.prototype.readUint64=function(){return this.readUint32()*l+this.readUint32()},o.prototype.readInt64=function(){return this.readUint32()*l+this.readUint32()},o.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},c.DataStream=o,o.prototype.save=function(e){var t=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var n=window.URL.createObjectURL(t),d=document.createElement("a");document.body.appendChild(d),d.setAttribute("href",n),d.setAttribute("download",e),d.setAttribute("target","_self"),d.click(),window.URL.revokeObjectURL(n)}else throw"DataStream.save: Can't create object URL."},o.prototype._dynamicSize=!0,Object.defineProperty(o.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),o.prototype.shift=function(e){var t=new ArrayBuffer(this._byteLength-e),n=new Uint8Array(t),d=new Uint8Array(this._buffer,e,n.length);n.set(d),this.buffer=t,this.position-=e},o.prototype.writeInt32Array=function(e,t){if(this._realloc(e.length*4),e instanceof Int32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt32(e[n],t)},o.prototype.writeInt16Array=function(e,t){if(this._realloc(e.length*2),e instanceof Int16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt16(e[n],t)},o.prototype.writeInt8Array=function(e){if(this._realloc(e.length*1),e instanceof Int8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},o.prototype.writeUint32Array=function(e,t){if(this._realloc(e.length*4),e instanceof Uint32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint32(e[n],t)},o.prototype.writeUint16Array=function(e,t){if(this._realloc(e.length*2),e instanceof Uint16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint16(e[n],t)},o.prototype.writeUint8Array=function(e){if(this._realloc(e.length*1),e instanceof Uint8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},o.prototype.writeFloat64Array=function(e,t){if(this._realloc(e.length*8),e instanceof Float64Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat64Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat64(e[n],t)},o.prototype.writeFloat32Array=function(e,t){if(this._realloc(e.length*4),e instanceof Float32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)o.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat32(e[n],t)},o.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,t??this.endianness),this.position+=4},o.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,t??this.endianness),this.position+=2},o.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},o.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,t??this.endianness),this.position+=4},o.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,t??this.endianness),this.position+=2},o.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},o.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,t??this.endianness),this.position+=4},o.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,t??this.endianness),this.position+=8},o.prototype.writeUCS2String=function(e,t,n){n==null&&(n=e.length);for(var d=0;d<e.length&&d<n;d++)this.writeUint16(e.charCodeAt(d),t);for(;d<n;d++)this.writeUint16(0)},o.prototype.writeString=function(e,t,n){var d=0;if(t==null||t=="ASCII")if(n!=null){var h=Math.min(e.length,n);for(d=0;d<h;d++)this.writeUint8(e.charCodeAt(d));for(;d<n;d++)this.writeUint8(0)}else for(d=0;d<e.length;d++)this.writeUint8(e.charCodeAt(d));else this.writeUint8Array(new TextEncoder(t).encode(e.substring(0,n)))},o.prototype.writeCString=function(e,t){var n=0;if(t!=null){var d=Math.min(e.length,t);for(n=0;n<d;n++)this.writeUint8(e.charCodeAt(n));for(;n<t;n++)this.writeUint8(0)}else{for(n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));this.writeUint8(0)}},o.prototype.writeStruct=function(e,t){for(var n=0;n<e.length;n+=2){var d=e[n+1];this.writeType(d,t[e[n]],t)}},o.prototype.writeType=function(e,t,n){var d;if(typeof e=="function")return e(this,t);if(typeof e=="object"&&!(e instanceof Array))return e.set(this,t,n);var h=null,g="ASCII",p=this.position;switch(typeof e=="string"&&/:/.test(e)&&(d=e.split(":"),e=d[0],h=parseInt(d[1])),typeof e=="string"&&/,/.test(e)&&(d=e.split(","),e=d[0],g=parseInt(d[1])),e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,o.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,o.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,o.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,o.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,o.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,o.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,o.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,o.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,o.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,o.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,o.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,o.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,h);break;case"string":this.writeString(t,g,h);break;case"u16string":this.writeUCS2String(t,this.endianness,h);break;case"u16stringle":this.writeUCS2String(t,o.LITTLE_ENDIAN,h);break;case"u16stringbe":this.writeUCS2String(t,o.BIG_ENDIAN,h);break;default:if(e.length==3){for(var v=e[1],b=0;b<t.length;b++)this.writeType(v,t[b]);break}else{this.writeStruct(e,t);break}}h!=null&&(this.position=p,this._realloc(h),this.position=p+h)},o.prototype.writeUint64=function(e){var t=Math.floor(e/l);this.writeUint32(t),this.writeUint32(e&4294967295)},o.prototype.writeUint24=function(e){this.writeUint8((e&16711680)>>16),this.writeUint8((e&65280)>>8),this.writeUint8(e&255)},o.prototype.adjustUint32=function(e,t){var n=this.position;this.seek(e),this.writeUint32(t),this.seek(n)},o.prototype.mapInt32Array=function(e,t){this._realloc(e*4);var n=new Int32Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*4,n},o.prototype.mapInt16Array=function(e,t){this._realloc(e*2);var n=new Int16Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*2,n},o.prototype.mapInt8Array=function(e){this._realloc(e*1);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=e*1,t},o.prototype.mapUint32Array=function(e,t){this._realloc(e*4);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*4,n},o.prototype.mapUint16Array=function(e,t){this._realloc(e*2);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*2,n},o.prototype.mapFloat64Array=function(e,t){this._realloc(e*8);var n=new Float64Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*8,n},o.prototype.mapFloat32Array=function(e,t){this._realloc(e*4);var n=new Float32Array(this._buffer,this.byteOffset+this.position,e);return o.arrayToNative(n,t??this.endianness),this.position+=e*4,n};var u=function(e){this.buffers=[],this.bufferIndex=-1,e&&(this.insertBuffer(e),this.bufferIndex=0)};u.prototype=new o(new ArrayBuffer,0,o.BIG_ENDIAN),u.prototype.initialized=function(){var e;return this.bufferIndex>-1?!0:this.buffers.length>0?(e=this.buffers[0],e.fileStart===0?(this.buffer=e,this.bufferIndex=0,r.debug("MultiBufferStream","Stream ready for parsing"),!0):(r.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(r.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(e,t){r.debug("ArrayBuffer","Trying to create a new buffer of size: "+(e.byteLength+t.byteLength));var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer},u.prototype.reduceBuffer=function(e,t,n){var d;return d=new Uint8Array(n),d.set(new Uint8Array(e,t,n)),d.buffer.fileStart=e.fileStart+t,d.buffer.usedBytes=0,d.buffer},u.prototype.insertBuffer=function(e){for(var t=!0,n=0;n<this.buffers.length;n++){var d=this.buffers[n];if(e.fileStart<=d.fileStart){if(e.fileStart===d.fileStart)if(e.byteLength>d.byteLength){this.buffers.splice(n,1),n--;continue}else r.warn("MultiBufferStream","Buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+") already appended, ignoring");else e.fileStart+e.byteLength<=d.fileStart||(e=this.reduceBuffer(e,0,d.fileStart-e.fileStart)),r.debug("MultiBufferStream","Appending new buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+")"),this.buffers.splice(n,0,e),n===0&&(this.buffer=e);t=!1;break}else if(e.fileStart<d.fileStart+d.byteLength){var h=d.fileStart+d.byteLength-e.fileStart,g=e.byteLength-h;if(g>0)e=this.reduceBuffer(e,h,g);else{t=!1;break}}}t&&(r.debug("MultiBufferStream","Appending new buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+")"),this.buffers.push(e),n===0&&(this.buffer=e))},u.prototype.logBufferLevel=function(e){var t,n,d,h,g=[],p,v="";for(d=0,h=0,t=0;t<this.buffers.length;t++)n=this.buffers[t],t===0?(p={},g.push(p),p.start=n.fileStart,p.end=n.fileStart+n.byteLength,v+="["+p.start+"-"):p.end===n.fileStart?p.end=n.fileStart+n.byteLength:(p={},p.start=n.fileStart,v+=g[g.length-1].end-1+"], ["+p.start+"-",p.end=n.fileStart+n.byteLength,g.push(p)),d+=n.usedBytes,h+=n.byteLength;g.length>0&&(v+=p.end-1+"]");var b=e?r.info:r.debug;this.buffers.length===0?b("MultiBufferStream","No more buffer in memory"):b("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+d+"/"+h+" bytes), continuous ranges: "+v)},u.prototype.cleanBuffers=function(){var e,t;for(e=0;e<this.buffers.length;e++)t=this.buffers[e],t.usedBytes===t.byteLength&&(r.debug("MultiBufferStream","Removing buffer #"+e),this.buffers.splice(e,1),e--)},u.prototype.mergeNextBuffer=function(){var e;if(this.bufferIndex+1<this.buffers.length)if(e=this.buffers[this.bufferIndex+1],e.fileStart===this.buffer.fileStart+this.buffer.byteLength){var t=this.buffer.byteLength,n=this.buffer.usedBytes,d=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,e),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=n,this.buffer.fileStart=d,r.debug("ISOFile","Concatenating buffer for box parsing (length: "+t+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},u.prototype.findPosition=function(e,t,n){var d,h=null,g=-1;for(e===!0?d=0:d=this.bufferIndex;d<this.buffers.length&&(h=this.buffers[d],h.fileStart<=t);)g=d,n&&(h.fileStart+h.byteLength<=t?h.usedBytes=h.byteLength:h.usedBytes=t-h.fileStart,this.logBufferLevel()),d++;return g!==-1?(h=this.buffers[g],h.fileStart+h.byteLength>=t?(r.debug("MultiBufferStream","Found position in existing buffer #"+g),g):-1):-1},u.prototype.findEndContiguousBuf=function(e){var t,n,d,h=e!==void 0?e:this.bufferIndex;if(n=this.buffers[h],this.buffers.length>h+1)for(t=h+1;t<this.buffers.length&&(d=this.buffers[t],d.fileStart===n.fileStart+n.byteLength);t++)n=d;return n.fileStart+n.byteLength},u.prototype.getEndFilePositionAfter=function(e){var t=this.findPosition(!0,e,!1);return t!==-1?this.findEndContiguousBuf(t):e},u.prototype.addUsedBytes=function(e){this.buffer.usedBytes+=e,this.logBufferLevel()},u.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},u.prototype.seek=function(e,t,n){var d;return d=this.findPosition(t,e,n),d!==-1?(this.buffer=this.buffers[d],this.bufferIndex=d,this.position=e-this.buffer.fileStart,r.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(r.debug("MultiBufferStream","Position "+e+" not found in buffered data"),!1)},u.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},u.prototype.getLength=function(){return this.byteLength},u.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},c.MultiBufferStream=u;var f=function(){var e=3,t=4,n=5,d=6,h=[];h[e]="ES_Descriptor",h[t]="DecoderConfigDescriptor",h[n]="DecoderSpecificInfo",h[d]="SLConfigDescriptor",this.getDescriptorName=function(v){return h[v]};var g=this,p={};return this.parseOneDescriptor=function(v){var b=0,S,U,F;for(S=v.readUint8(),F=v.readUint8();F&128;)b=(F&127)<<7,F=v.readUint8();return b+=F&127,r.debug("MPEG4DescriptorParser","Found "+(h[S]||"Descriptor "+S)+", size "+b+" at position "+v.getPosition()),h[S]?U=new p[h[S]](b):U=new p.Descriptor(b),U.parse(v),U},p.Descriptor=function(v,b){this.tag=v,this.size=b,this.descs=[]},p.Descriptor.prototype.parse=function(v){this.data=v.readUint8Array(this.size)},p.Descriptor.prototype.findDescriptor=function(v){for(var b=0;b<this.descs.length;b++)if(this.descs[b].tag==v)return this.descs[b];return null},p.Descriptor.prototype.parseRemainingDescriptors=function(v){for(var b=v.position;v.position<b+this.size;){var S=g.parseOneDescriptor(v);this.descs.push(S)}},p.ES_Descriptor=function(v){p.Descriptor.call(this,e,v)},p.ES_Descriptor.prototype=new p.Descriptor,p.ES_Descriptor.prototype.parse=function(v){if(this.ES_ID=v.readUint16(),this.flags=v.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=v.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var b=v.readUint8();this.URL=v.readString(b),this.size-=b+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=v.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(v)},p.ES_Descriptor.prototype.getOTI=function(v){var b=this.findDescriptor(t);return b?b.oti:0},p.ES_Descriptor.prototype.getAudioConfig=function(v){var b=this.findDescriptor(t);if(!b)return null;var S=b.findDescriptor(n);if(S&&S.data){var U=(S.data[0]&248)>>3;return U===31&&S.data.length>=2&&(U=32+((S.data[0]&7)<<3)+((S.data[1]&224)>>5)),U}else return null},p.DecoderConfigDescriptor=function(v){p.Descriptor.call(this,t,v)},p.DecoderConfigDescriptor.prototype=new p.Descriptor,p.DecoderConfigDescriptor.prototype.parse=function(v){this.oti=v.readUint8(),this.streamType=v.readUint8(),this.bufferSize=v.readUint24(),this.maxBitrate=v.readUint32(),this.avgBitrate=v.readUint32(),this.size-=13,this.parseRemainingDescriptors(v)},p.DecoderSpecificInfo=function(v){p.Descriptor.call(this,n,v)},p.DecoderSpecificInfo.prototype=new p.Descriptor,p.SLConfigDescriptor=function(v){p.Descriptor.call(this,d,v)},p.SLConfigDescriptor.prototype=new p.Descriptor,this};c.MPEG4DescriptorParser=f;var s={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){s.FullBox.prototype=new s.Box,s.ContainerBox.prototype=new s.Box,s.SampleEntry.prototype=new s.Box,s.TrackGroupTypeBox.prototype=new s.FullBox,s.BASIC_BOXES.forEach(function(e){s.createBoxCtor(e)}),s.FULL_BOXES.forEach(function(e){s.createFullBoxCtor(e)}),s.CONTAINER_BOXES.forEach(function(e){s.createContainerBoxCtor(e[0],null,e[1])})},Box:function(e,t,n){this.type=e,this.size=t,this.uuid=n},FullBox:function(e,t,n){s.Box.call(this,e,t,n),this.flags=0,this.version=0},ContainerBox:function(e,t,n){s.Box.call(this,e,t,n),this.boxes=[]},SampleEntry:function(e,t,n,d){s.ContainerBox.call(this,e,t),this.hdr_size=n,this.start=d},SampleGroupEntry:function(e){this.grouping_type=e},TrackGroupTypeBox:function(e,t){s.FullBox.call(this,e,t)},createBoxCtor:function(e,t){s.boxCodes.push(e),s[e+"Box"]=function(n){s.Box.call(this,e,n)},s[e+"Box"].prototype=new s.Box,t&&(s[e+"Box"].prototype.parse=t)},createFullBoxCtor:function(e,t){s[e+"Box"]=function(n){s.FullBox.call(this,e,n)},s[e+"Box"].prototype=new s.FullBox,s[e+"Box"].prototype.parse=function(n){this.parseFullHeader(n),t&&t.call(this,n)}},addSubBoxArrays:function(e){if(e){this.subBoxNames=e;for(var t=e.length,n=0;n<t;n++)this[e[n]+"s"]=[]}},createContainerBoxCtor:function(e,t,n){s[e+"Box"]=function(d){s.ContainerBox.call(this,e,d),s.addSubBoxArrays.call(this,n)},s[e+"Box"].prototype=new s.ContainerBox,t&&(s[e+"Box"].prototype.parse=t)},createMediaSampleEntryCtor:function(e,t,n){s.sampleEntryCodes[e]=[],s[e+"SampleEntry"]=function(d,h){s.SampleEntry.call(this,d,h),s.addSubBoxArrays.call(this,n)},s[e+"SampleEntry"].prototype=new s.SampleEntry,t&&(s[e+"SampleEntry"].prototype.parse=t)},createSampleEntryCtor:function(e,t,n,d){s.sampleEntryCodes[e].push(t),s[t+"SampleEntry"]=function(h){s[e+"SampleEntry"].call(this,t,h),s.addSubBoxArrays.call(this,d)},s[t+"SampleEntry"].prototype=new s[e+"SampleEntry"],n&&(s[t+"SampleEntry"].prototype.parse=n)},createEncryptedSampleEntryCtor:function(e,t,n){s.createSampleEntryCtor.call(this,e,t,n,["sinf"])},createSampleGroupCtor:function(e,t){s[e+"SampleGroupEntry"]=function(n){s.SampleGroupEntry.call(this,e,n)},s[e+"SampleGroupEntry"].prototype=new s.SampleGroupEntry,t&&(s[e+"SampleGroupEntry"].prototype.parse=t)},createTrackGroupCtor:function(e,t){s[e+"TrackGroupTypeBox"]=function(n){s.TrackGroupTypeBox.call(this,e,n)},s[e+"TrackGroupTypeBox"].prototype=new s.TrackGroupTypeBox,t&&(s[e+"TrackGroupTypeBox"].prototype.parse=t)},createUUIDBox:function(e,t,n,d){s.UUIDs.push(e),s.UUIDBoxes[e]=function(h){t?s.FullBox.call(this,"uuid",h,e):n?s.ContainerBox.call(this,"uuid",h,e):s.Box.call(this,"uuid",h,e)},s.UUIDBoxes[e].prototype=t?new s.FullBox:n?new s.ContainerBox:new s.Box,d&&(t?s.UUIDBoxes[e].prototype.parse=function(h){this.parseFullHeader(h),d&&d.call(this,h)}:s.UUIDBoxes[e].prototype.parse=d)}};s.initialize(),s.TKHD_FLAG_ENABLED=1,s.TKHD_FLAG_IN_MOVIE=2,s.TKHD_FLAG_IN_PREVIEW=4,s.TFHD_FLAG_BASE_DATA_OFFSET=1,s.TFHD_FLAG_SAMPLE_DESC=2,s.TFHD_FLAG_SAMPLE_DUR=8,s.TFHD_FLAG_SAMPLE_SIZE=16,s.TFHD_FLAG_SAMPLE_FLAGS=32,s.TFHD_FLAG_DUR_EMPTY=65536,s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,s.TRUN_FLAGS_DATA_OFFSET=1,s.TRUN_FLAGS_FIRST_FLAG=4,s.TRUN_FLAGS_DURATION=256,s.TRUN_FLAGS_SIZE=512,s.TRUN_FLAGS_FLAGS=1024,s.TRUN_FLAGS_CTS_OFFSET=2048,s.Box.prototype.add=function(e){return this.addBox(new s[e+"Box"])},s.Box.prototype.addBox=function(e){return this.boxes.push(e),this[e.type+"s"]?this[e.type+"s"].push(e):this[e.type]=e,e},s.Box.prototype.set=function(e,t){return this[e]=t,this},s.Box.prototype.addEntry=function(e,t){var n=t||"entries";return this[n]||(this[n]=[]),this[n].push(e),this},c.BoxParser=s,s.parseUUID=function(e){return s.parseHex16(e)},s.parseHex16=function(e){for(var t="",n=0;n<16;n++){var d=e.readUint8().toString(16);t+=d.length===1?"0"+d:d}return t},s.parseOneBox=function(e,t,n){var d,h=e.getPosition(),g=0,p,v;if(e.getEndPosition()-h<8)return r.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:s.ERR_NOT_ENOUGH_DATA};if(n&&n<8)return r.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:s.ERR_NOT_ENOUGH_DATA};var b=e.readUint32(),S=e.readString(4),U=S;if(r.debug("BoxParser","Found box of type '"+S+"' and size "+b+" at position "+h),g=8,S=="uuid"){if(e.getEndPosition()-e.getPosition()<16||n-g<16)return e.seek(h),r.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:s.ERR_NOT_ENOUGH_DATA};v=s.parseUUID(e),g+=16,U=v}if(b==1){if(e.getEndPosition()-e.getPosition()<8||n&&n-g<8)return e.seek(h),r.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+S+'" box'),{code:s.ERR_NOT_ENOUGH_DATA};b=e.readUint64(),g+=8}else if(b===0){if(n)b=n;else if(S!=="mdat")return r.error("BoxParser","Unlimited box size not supported for type: '"+S+"'"),d=new s.Box(S,b),{code:s.OK,box:d,size:d.size}}return b!==0&&b<g?(r.error("BoxParser","Box of type "+S+" has an invalid size "+b+" (too small to be a box)"),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:b,hdr_size:g,start:h}):b!==0&&n&&b>n?(r.error("BoxParser","Box of type '"+S+"' has a size "+b+" greater than its container size "+n),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:b,hdr_size:g,start:h}):b!==0&&h+b>e.getEndPosition()?(e.seek(h),r.info("BoxParser","Not enough data in stream to parse the entire '"+S+"' box"),{code:s.ERR_NOT_ENOUGH_DATA,type:S,size:b,hdr_size:g,start:h}):t?{code:s.OK,type:S,size:b,hdr_size:g,start:h}:(s[S+"Box"]?d=new s[S+"Box"](b):S!=="uuid"?(r.warn("BoxParser","Unknown box type: '"+S+"'"),d=new s.Box(S,b),d.has_unparsed_data=!0):s.UUIDBoxes[v]?d=new s.UUIDBoxes[v](b):(r.warn("BoxParser","Unknown uuid type: '"+v+"'"),d=new s.Box(S,b),d.uuid=v,d.has_unparsed_data=!0),d.hdr_size=g,d.start=h,d.write===s.Box.prototype.write&&d.type!=="mdat"&&(r.info("BoxParser","'"+U+"' box writing not yet implemented, keeping unparsed data in memory for later write"),d.parseDataAndRewind(e)),d.parse(e),p=e.getPosition()-(d.start+d.size),p<0?(r.warn("BoxParser","Parsing of box '"+U+"' did not read the entire indicated box data size (missing "+-p+" bytes), seeking forward"),e.seek(d.start+d.size)):p>0&&(r.error("BoxParser","Parsing of box '"+U+"' read "+p+" more bytes than the indicated box data size, seeking backwards"),d.size!==0&&e.seek(d.start+d.size)),{code:s.OK,box:d,size:d.size})},s.Box.prototype.parse=function(e){this.type!="mdat"?this.data=e.readUint8Array(this.size-this.hdr_size):this.size===0?e.seek(e.getEndPosition()):e.seek(this.start+this.size)},s.Box.prototype.parseDataAndRewind=function(e){this.data=e.readUint8Array(this.size-this.hdr_size),e.position-=this.size-this.hdr_size},s.FullBox.prototype.parseDataAndRewind=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,e.position-=this.size-this.hdr_size},s.FullBox.prototype.parseFullHeader=function(e){this.version=e.readUint8(),this.flags=e.readUint24(),this.hdr_size+=4},s.FullBox.prototype.parse=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},s.ContainerBox.prototype.parse=function(e){for(var t,n;e.getPosition()<this.start+this.size;)if(t=s.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code===s.OK)if(n=t.box,this.boxes.push(n),this.subBoxNames&&this.subBoxNames.indexOf(n.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(n.type)]+"s"].push(n);else{var d=n.type!=="uuid"?n.type:n.uuid;this[d]?r.warn("Box of type "+d+" already stored in field of this type"):this[d]=n}else return},s.Box.prototype.parseLanguage=function(e){this.language=e.readUint16();var t=[];t[0]=this.language>>10&31,t[1]=this.language>>5&31,t[2]=this.language&31,this.languageString=String.fromCharCode(t[0]+96,t[1]+96,t[2]+96)},s.SAMPLE_ENTRY_TYPE_VISUAL="Visual",s.SAMPLE_ENTRY_TYPE_AUDIO="Audio",s.SAMPLE_ENTRY_TYPE_HINT="Hint",s.SAMPLE_ENTRY_TYPE_METADATA="Metadata",s.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",s.SAMPLE_ENTRY_TYPE_SYSTEM="System",s.SAMPLE_ENTRY_TYPE_TEXT="Text",s.SampleEntry.prototype.parseHeader=function(e){e.readUint8Array(6),this.data_reference_index=e.readUint16(),this.hdr_size+=8},s.SampleEntry.prototype.parse=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},s.SampleEntry.prototype.parseDataAndRewind=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,e.position-=this.size-this.hdr_size},s.SampleEntry.prototype.parseFooter=function(e){s.ContainerBox.prototype.parse.call(this,e)},s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_HINT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,function(e){var t;this.parseHeader(e),e.readUint16(),e.readUint16(),e.readUint32Array(3),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.readUint32(),this.frame_count=e.readUint16(),t=Math.min(31,e.readUint8()),this.compressorname=e.readString(t),t<31&&e.readString(31-t),this.depth=e.readUint16(),e.readUint16(),this.parseFooter(e)}),s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,function(e){this.parseHeader(e),e.readUint32Array(2),this.channel_count=e.readUint16(),this.samplesize=e.readUint16(),e.readUint16(),e.readUint16(),this.samplerate=e.readUint32()/65536,this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT,"enct"),s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"encm"),s.createBoxCtor("a1lx",function(e){var t=e.readUint8()&1,n=((t&1)+1)*16;this.layer_size=[];for(var d=0;d<3;d++)n==16?this.layer_size[d]=e.readUint16():this.layer_size[d]=e.readUint32()}),s.createBoxCtor("a1op",function(e){this.op_index=e.readUint8()}),s.createFullBoxCtor("auxC",function(e){this.aux_type=e.readCString();var t=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=e.readUint8Array(t)}),s.createBoxCtor("av1C",function(e){var t=e.readUint8();if(t>>7&!1){r.error("av1C marker problem");return}if(this.version=t&127,this.version!==1){r.error("av1C version "+this.version+" not supported");return}if(t=e.readUint8(),this.seq_profile=t>>5&7,this.seq_level_idx_0=t&31,t=e.readUint8(),this.seq_tier_0=t>>7&1,this.high_bitdepth=t>>6&1,this.twelve_bit=t>>5&1,this.monochrome=t>>4&1,this.chroma_subsampling_x=t>>3&1,this.chroma_subsampling_y=t>>2&1,this.chroma_sample_position=t&3,t=e.readUint8(),this.reserved_1=t>>5&7,this.reserved_1!==0){r.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=t>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=t&15;else if(this.reserved_2=t&15,this.reserved_2!==0){r.error("av1C reserved_2 parsing problem");return}var n=this.size-this.hdr_size-4;this.configOBUs=e.readUint8Array(n)}),s.createBoxCtor("avcC",function(e){var t,n;for(this.configurationVersion=e.readUint8(),this.AVCProfileIndication=e.readUint8(),this.profile_compatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=e.readUint8()&3,this.nb_SPS_nalus=e.readUint8()&31,n=this.size-this.hdr_size-6,this.SPS=[],t=0;t<this.nb_SPS_nalus;t++)this.SPS[t]={},this.SPS[t].length=e.readUint16(),this.SPS[t].nalu=e.readUint8Array(this.SPS[t].length),n-=2+this.SPS[t].length;for(this.nb_PPS_nalus=e.readUint8(),n--,this.PPS=[],t=0;t<this.nb_PPS_nalus;t++)this.PPS[t]={},this.PPS[t].length=e.readUint16(),this.PPS[t].nalu=e.readUint8Array(this.PPS[t].length),n-=2+this.PPS[t].length;n>0&&(this.ext=e.readUint8Array(n))}),s.createBoxCtor("btrt",function(e){this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32()}),s.createFullBoxCtor("ccst",function(e){var t=e.readUint8();this.all_ref_pics_intra=(t&128)==128,this.intra_pred_used=(t&64)==64,this.max_ref_per_pic=(t&63)>>2,e.readUint24()}),s.createBoxCtor("cdef",function(e){var t;for(this.channel_count=e.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],t=0;t<this.channel_count;t++)this.channel_indexes.push(e.readUint16()),this.channel_types.push(e.readUint16()),this.channel_associations.push(e.readUint16())}),s.createBoxCtor("clap",function(e){this.cleanApertureWidthN=e.readUint32(),this.cleanApertureWidthD=e.readUint32(),this.cleanApertureHeightN=e.readUint32(),this.cleanApertureHeightD=e.readUint32(),this.horizOffN=e.readUint32(),this.horizOffD=e.readUint32(),this.vertOffN=e.readUint32(),this.vertOffD=e.readUint32()}),s.createBoxCtor("clli",function(e){this.max_content_light_level=e.readUint16(),this.max_pic_average_light_level=e.readUint16()}),s.createFullBoxCtor("cmex",function(e){this.flags&1&&(this.pos_x=e.readInt32()),this.flags&2&&(this.pos_y=e.readInt32()),this.flags&4&&(this.pos_z=e.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=e.readInt32(),this.quat_y=e.readInt32(),this.quat_z=e.readInt32()):(this.quat_x=e.readInt16(),this.quat_y=e.readInt16(),this.quat_z=e.readInt16()):this.version==1),this.flags&32&&(this.id=e.readUint32())}),s.createFullBoxCtor("cmin",function(e){this.focal_length_x=e.readInt32(),this.principal_point_x=e.readInt32(),this.principal_point_y=e.readInt32(),this.flags&1&&(this.focal_length_y=e.readInt32(),this.skew_factor=e.readInt32())}),s.createBoxCtor("cmpd",function(e){for(this.component_count=e.readUint16(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var t=e.readUint16();this.component_types.push(t),t>=32768&&this.component_type_urls.push(e.readCString())}}),s.createFullBoxCtor("co64",function(e){var t,n;if(t=e.readUint32(),this.chunk_offsets=[],this.version===0)for(n=0;n<t;n++)this.chunk_offsets.push(e.readUint64())}),s.createFullBoxCtor("CoLL",function(e){this.maxCLL=e.readUint16(),this.maxFALL=e.readUint16()}),s.createBoxCtor("colr",function(e){if(this.colour_type=e.readString(4),this.colour_type==="nclx"){this.colour_primaries=e.readUint16(),this.transfer_characteristics=e.readUint16(),this.matrix_coefficients=e.readUint16();var t=e.readUint8();this.full_range_flag=t>>7}else this.colour_type==="rICC"?this.ICC_profile=e.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=e.readUint8Array(this.size-4))}),s.createFullBoxCtor("cprt",function(e){this.parseLanguage(e),this.notice=e.readCString()}),s.createFullBoxCtor("cslg",function(e){this.version===0&&(this.compositionToDTSShift=e.readInt32(),this.leastDecodeToDisplayDelta=e.readInt32(),this.greatestDecodeToDisplayDelta=e.readInt32(),this.compositionStartTime=e.readInt32(),this.compositionEndTime=e.readInt32())}),s.createFullBoxCtor("ctts",function(e){var t,n;if(t=e.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(n=0;n<t;n++){this.sample_counts.push(e.readUint32());var d=e.readInt32();d<0&&r.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(d)}else if(this.version==1)for(n=0;n<t;n++)this.sample_counts.push(e.readUint32()),this.sample_offsets.push(e.readInt32())}),s.createBoxCtor("dac3",function(e){var t=e.readUint8(),n=e.readUint8(),d=e.readUint8();this.fscod=t>>6,this.bsid=t>>1&31,this.bsmod=(t&1)<<2|n>>6&3,this.acmod=n>>3&7,this.lfeon=n>>2&1,this.bit_rate_code=n&3|d>>5&7}),s.createBoxCtor("dec3",function(e){var t=e.readUint16();this.data_rate=t>>3,this.num_ind_sub=t&7,this.ind_subs=[];for(var n=0;n<this.num_ind_sub+1;n++){var d={};this.ind_subs.push(d);var h=e.readUint8(),g=e.readUint8(),p=e.readUint8();d.fscod=h>>6,d.bsid=h>>1&31,d.bsmod=(h&1)<<4|g>>4&15,d.acmod=g>>1&7,d.lfeon=g&1,d.num_dep_sub=p>>1&15,d.num_dep_sub>0&&(d.chan_loc=(p&1)<<8|e.readUint8())}}),s.createFullBoxCtor("dfLa",function(e){var t=127,n=128,d=[],h=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];this.parseFullHeader(e);do{var g=e.readUint8(),p=Math.min(g&t,h.length-1);if(p?e.readUint8Array(e.readUint24()):(e.readUint8Array(13),this.samplerate=e.readUint32()>>12,e.readUint8Array(20)),d.push(h[p]),g&n)break}while(!0);this.numMetadataBlocks=d.length+" ("+d.join(", ")+")"}),s.createBoxCtor("dimm",function(e){this.bytessent=e.readUint64()}),s.createBoxCtor("dmax",function(e){this.time=e.readUint32()}),s.createBoxCtor("dmed",function(e){this.bytessent=e.readUint64()}),s.createBoxCtor("dOps",function(e){if(this.Version=e.readUint8(),this.OutputChannelCount=e.readUint8(),this.PreSkip=e.readUint16(),this.InputSampleRate=e.readUint32(),this.OutputGain=e.readInt16(),this.ChannelMappingFamily=e.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=e.readUint8(),this.CoupledCount=e.readUint8(),this.ChannelMapping=[];for(var t=0;t<this.OutputChannelCount;t++)this.ChannelMapping[t]=e.readUint8()}}),s.createFullBoxCtor("dref",function(e){var t,n;this.entries=[];for(var d=e.readUint32(),h=0;h<d;h++)if(t=s.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code===s.OK)n=t.box,this.entries.push(n);else return}),s.createBoxCtor("drep",function(e){this.bytessent=e.readUint64()}),s.createFullBoxCtor("elng",function(e){this.extended_language=e.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("elst",function(e){this.entries=[];for(var t=e.readUint32(),n=0;n<t;n++){var d={};this.entries.push(d),this.version===1?(d.segment_duration=e.readUint64(),d.media_time=e.readInt64()):(d.segment_duration=e.readUint32(),d.media_time=e.readInt32()),d.media_rate_integer=e.readInt16(),d.media_rate_fraction=e.readInt16()}}),s.createFullBoxCtor("emsg",function(e){this.version==1?(this.timescale=e.readUint32(),this.presentation_time=e.readUint64(),this.event_duration=e.readUint32(),this.id=e.readUint32(),this.scheme_id_uri=e.readCString(),this.value=e.readCString()):(this.scheme_id_uri=e.readCString(),this.value=e.readCString(),this.timescale=e.readUint32(),this.presentation_time_delta=e.readUint32(),this.event_duration=e.readUint32(),this.id=e.readUint32());var t=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(t-=4),this.message_data=e.readUint8Array(t)}),s.createEntityToGroupCtor=function(e,t){s[e+"Box"]=function(n){s.FullBox.call(this,e,n)},s[e+"Box"].prototype=new s.FullBox,s[e+"Box"].prototype.parse=function(n){if(this.parseFullHeader(n),t)t.call(this,n);else for(this.group_id=n.readUint32(),this.num_entities_in_group=n.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var d=n.readUint32();this.entity_ids.push(d)}}},s.createEntityToGroupCtor("aebr"),s.createEntityToGroupCtor("afbr"),s.createEntityToGroupCtor("albc"),s.createEntityToGroupCtor("altr"),s.createEntityToGroupCtor("brst"),s.createEntityToGroupCtor("dobr"),s.createEntityToGroupCtor("eqiv"),s.createEntityToGroupCtor("favc"),s.createEntityToGroupCtor("fobr"),s.createEntityToGroupCtor("iaug"),s.createEntityToGroupCtor("pano"),s.createEntityToGroupCtor("slid"),s.createEntityToGroupCtor("ster"),s.createEntityToGroupCtor("tsyn"),s.createEntityToGroupCtor("wbbr"),s.createEntityToGroupCtor("prgr"),s.createFullBoxCtor("esds",function(e){var t=e.readUint8Array(this.size-this.hdr_size);if(this.data=t,typeof f<"u"){var n=new f;this.esd=n.parseOneDescriptor(new o(t.buffer,0,o.BIG_ENDIAN))}}),s.createBoxCtor("fiel",function(e){this.fieldCount=e.readUint8(),this.fieldOrdering=e.readUint8()}),s.createBoxCtor("frma",function(e){this.data_format=e.readString(4)}),s.createBoxCtor("ftyp",function(e){var t=this.size-this.hdr_size;this.major_brand=e.readString(4),this.minor_version=e.readUint32(),t-=8,this.compatible_brands=[];for(var n=0;t>=4;)this.compatible_brands[n]=e.readString(4),t-=4,n++}),s.createFullBoxCtor("hdlr",function(e){this.version===0&&(e.readUint32(),this.handler=e.readString(4),e.readUint32Array(3),this.name=e.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),s.createBoxCtor("hvcC",function(e){var t,n,d,h;this.configurationVersion=e.readUint8(),h=e.readUint8(),this.general_profile_space=h>>6,this.general_tier_flag=(h&32)>>5,this.general_profile_idc=h&31,this.general_profile_compatibility=e.readUint32(),this.general_constraint_indicator=e.readUint8Array(6),this.general_level_idc=e.readUint8(),this.min_spatial_segmentation_idc=e.readUint16()&4095,this.parallelismType=e.readUint8()&3,this.chroma_format_idc=e.readUint8()&3,this.bit_depth_luma_minus8=e.readUint8()&7,this.bit_depth_chroma_minus8=e.readUint8()&7,this.avgFrameRate=e.readUint16(),h=e.readUint8(),this.constantFrameRate=h>>6,this.numTemporalLayers=(h&13)>>3,this.temporalIdNested=(h&4)>>2,this.lengthSizeMinusOne=h&3,this.nalu_arrays=[];var g=e.readUint8();for(t=0;t<g;t++){var p=[];this.nalu_arrays.push(p),h=e.readUint8(),p.completeness=(h&128)>>7,p.nalu_type=h&63;var v=e.readUint16();for(n=0;n<v;n++){var b={};p.push(b),d=e.readUint16(),b.data=e.readUint8Array(d)}}}),s.createFullBoxCtor("iinf",function(e){var t;this.version===0?this.entry_count=e.readUint16():this.entry_count=e.readUint32(),this.item_infos=[];for(var n=0;n<this.entry_count;n++)if(t=s.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code===s.OK)t.box.type!=="infe"&&r.error("BoxParser","Expected 'infe' box, got "+t.box.type),this.item_infos[n]=t.box;else return}),s.createFullBoxCtor("iloc",function(e){var t;t=e.readUint8(),this.offset_size=t>>4&15,this.length_size=t&15,t=e.readUint8(),this.base_offset_size=t>>4&15,this.version===1||this.version===2?this.index_size=t&15:this.index_size=0,this.items=[];var n=0;if(this.version<2)n=e.readUint16();else if(this.version===2)n=e.readUint32();else throw"version of iloc box not supported";for(var d=0;d<n;d++){var h={};if(this.items.push(h),this.version<2)h.item_ID=e.readUint16();else if(this.version===2)h.item_ID=e.readUint16();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?h.construction_method=e.readUint16()&15:h.construction_method=0,h.data_reference_index=e.readUint16(),this.base_offset_size){case 0:h.base_offset=0;break;case 4:h.base_offset=e.readUint32();break;case 8:h.base_offset=e.readUint64();break;default:throw"Error reading base offset size"}var g=e.readUint16();h.extents=[];for(var p=0;p<g;p++){var v={};if(h.extents.push(v),this.version===1||this.version===2)switch(this.index_size){case 0:v.extent_index=0;break;case 4:v.extent_index=e.readUint32();break;case 8:v.extent_index=e.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:v.extent_offset=0;break;case 4:v.extent_offset=e.readUint32();break;case 8:v.extent_offset=e.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:v.extent_length=0;break;case 4:v.extent_length=e.readUint32();break;case 8:v.extent_length=e.readUint64();break;default:throw"Error reading extent index"}}}}),s.createBoxCtor("imir",function(e){var t=e.readUint8();this.reserved=t>>7,this.axis=t&1}),s.createFullBoxCtor("infe",function(e){if((this.version===0||this.version===1)&&(this.item_ID=e.readUint16(),this.item_protection_index=e.readUint16(),this.item_name=e.readCString(),this.content_type=e.readCString(),this.content_encoding=e.readCString()),this.version===1){this.extension_type=e.readString(4),r.warn("BoxParser","Cannot parse extension type"),e.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=e.readUint16():this.version===3&&(this.item_ID=e.readUint32()),this.item_protection_index=e.readUint16(),this.item_type=e.readString(4),this.item_name=e.readCString(),this.item_type==="mime"?(this.content_type=e.readCString(),this.content_encoding=e.readCString()):this.item_type==="uri "&&(this.item_uri_type=e.readCString()))}),s.createFullBoxCtor("ipma",function(e){var t,n;for(entry_count=e.readUint32(),this.associations=[],t=0;t<entry_count;t++){var d={};this.associations.push(d),this.version<1?d.id=e.readUint16():d.id=e.readUint32();var h=e.readUint8();for(d.props=[],n=0;n<h;n++){var g=e.readUint8(),p={};d.props.push(p),p.essential=(g&128)>>7===1,this.flags&1?p.property_index=(g&127)<<8|e.readUint8():p.property_index=g&127}}}),s.createFullBoxCtor("iref",function(e){var t,n;for(this.references=[];e.getPosition()<this.start+this.size;)if(t=s.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),t.code===s.OK)this.version===0?n=new s.SingleItemTypeReferenceBox(t.type,t.size,t.hdr_size,t.start):n=new s.SingleItemTypeReferenceBoxLarge(t.type,t.size,t.hdr_size,t.start),n.write===s.Box.prototype.write&&n.type!=="mdat"&&(r.warn("BoxParser",n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(e)),n.parse(e),this.references.push(n);else return}),s.createBoxCtor("irot",function(e){this.angle=e.readUint8()&3}),s.createFullBoxCtor("ispe",function(e){this.image_width=e.readUint32(),this.image_height=e.readUint32()}),s.createFullBoxCtor("kind",function(e){this.schemeURI=e.readCString(),this.value=e.readCString()}),s.createFullBoxCtor("leva",function(e){var t=e.readUint8();this.levels=[];for(var n=0;n<t;n++){var d={};this.levels[n]=d,d.track_ID=e.readUint32();var h=e.readUint8();switch(d.padding_flag=h>>7,d.assignment_type=h&127,d.assignment_type){case 0:d.grouping_type=e.readString(4);break;case 1:d.grouping_type=e.readString(4),d.grouping_type_parameter=e.readUint32();break;case 2:break;case 3:break;case 4:d.sub_track_id=e.readUint32();break;default:r.warn("BoxParser","Unknown leva assignement type")}}}),s.createBoxCtor("lsel",function(e){this.layer_id=e.readUint16()}),s.createBoxCtor("maxr",function(e){this.period=e.readUint32(),this.bytes=e.readUint32()}),s.createBoxCtor("mdcv",function(e){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=e.readUint16(),this.display_primaries[0].y=e.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=e.readUint16(),this.display_primaries[1].y=e.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=e.readUint16(),this.display_primaries[2].y=e.readUint16(),this.white_point={},this.white_point.x=e.readUint16(),this.white_point.y=e.readUint16(),this.max_display_mastering_luminance=e.readUint32(),this.min_display_mastering_luminance=e.readUint32()}),s.createFullBoxCtor("mdhd",function(e){this.version==1?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.parseLanguage(e),e.readUint16()}),s.createFullBoxCtor("mehd",function(e){this.flags&1&&(r.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=e.readUint64():this.fragment_duration=e.readUint32()}),s.createFullBoxCtor("meta",function(e){this.boxes=[],s.ContainerBox.prototype.parse.call(this,e)}),s.createFullBoxCtor("mfhd",function(e){this.sequence_number=e.readUint32()}),s.createFullBoxCtor("mfro",function(e){this._size=e.readUint32()}),s.createFullBoxCtor("mvhd",function(e){this.version==1?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.rate=e.readUint32(),this.volume=e.readUint16()>>8,e.readUint16(),e.readUint32Array(2),this.matrix=e.readUint32Array(9),e.readUint32Array(6),this.next_track_id=e.readUint32()}),s.createBoxCtor("npck",function(e){this.packetssent=e.readUint32()}),s.createBoxCtor("nump",function(e){this.packetssent=e.readUint64()}),s.createFullBoxCtor("padb",function(e){var t=e.readUint32();this.padbits=[];for(var n=0;n<Math.floor((t+1)/2);n++)this.padbits=e.readUint8()}),s.createBoxCtor("pasp",function(e){this.hSpacing=e.readUint32(),this.vSpacing=e.readUint32()}),s.createBoxCtor("payl",function(e){this.text=e.readString(this.size-this.hdr_size)}),s.createBoxCtor("payt",function(e){this.payloadID=e.readUint32();var t=e.readUint8();this.rtpmap_string=e.readString(t)}),s.createFullBoxCtor("pdin",function(e){var t=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var n=0;n<t;n++)this.rate[n]=e.readUint32(),this.initial_delay[n]=e.readUint32()}),s.createFullBoxCtor("pitm",function(e){this.version===0?this.item_id=e.readUint16():this.item_id=e.readUint32()}),s.createFullBoxCtor("pixi",function(e){var t;for(this.num_channels=e.readUint8(),this.bits_per_channels=[],t=0;t<this.num_channels;t++)this.bits_per_channels[t]=e.readUint8()}),s.createBoxCtor("pmax",function(e){this.bytes=e.readUint32()}),s.createFullBoxCtor("prdi",function(e){if(this.step_count=e.readUint16(),this.item_count=[],this.flags&2)for(var t=0;t<this.step_count;t++)this.item_count[t]=e.readUint16()}),s.createFullBoxCtor("prft",function(e){this.ref_track_id=e.readUint32(),this.ntp_timestamp=e.readUint64(),this.version===0?this.media_time=e.readUint32():this.media_time=e.readUint64()}),s.createFullBoxCtor("pssh",function(e){if(this.system_id=s.parseHex16(e),this.version>0){var t=e.readUint32();this.kid=[];for(var n=0;n<t;n++)this.kid[n]=s.parseHex16(e)}var d=e.readUint32();d>0&&(this.data=e.readUint8Array(d))}),s.createFullBoxCtor("clef",function(e){this.width=e.readUint32(),this.height=e.readUint32()}),s.createFullBoxCtor("enof",function(e){this.width=e.readUint32(),this.height=e.readUint32()}),s.createFullBoxCtor("prof",function(e){this.width=e.readUint32(),this.height=e.readUint32()}),s.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),s.createBoxCtor("rtp ",function(e){this.descriptionformat=e.readString(4),this.sdptext=e.readString(this.size-this.hdr_size-4)}),s.createFullBoxCtor("saio",function(e){this.flags&1&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32());var t=e.readUint32();this.offset=[];for(var n=0;n<t;n++)this.version===0?this.offset[n]=e.readUint32():this.offset[n]=e.readUint64()}),s.createFullBoxCtor("saiz",function(e){this.flags&1&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32()),this.default_sample_info_size=e.readUint8();var t=e.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var n=0;n<t;n++)this.sample_info_size[n]=e.readUint8()}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(e){this.parseHeader(e),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.auxiliary_mime_types=e.readCString(),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(e){this.parseHeader(e),this.displayFlags=e.readUint32(),this.horizontal_justification=e.readInt8(),this.vertical_justification=e.readInt8(),this.bg_color_rgba=e.readUint8Array(4),this.box_record=e.readInt16Array(4),this.style_record=e.readUint8Array(12),this.parseFooter(e)}),s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(e){this.parseHeader(e),this.parseFooter(e)}),s.createSampleGroupCtor("alst",function(e){var t,n=e.readUint16();for(this.first_output_sample=e.readUint16(),this.sample_offset=[],t=0;t<n;t++)this.sample_offset[t]=e.readUint32();var d=this.description_length-4-4*n;for(this.num_output_samples=[],this.num_total_samples=[],t=0;t<d/4;t++)this.num_output_samples[t]=e.readUint16(),this.num_total_samples[t]=e.readUint16()}),s.createSampleGroupCtor("avll",function(e){this.layerNumber=e.readUint8(),this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()}),s.createSampleGroupCtor("avss",function(e){this.subSequenceIdentifier=e.readUint16(),this.layerNumber=e.readUint8();var t=e.readUint8();this.durationFlag=t>>7,this.avgRateFlag=t>>6&1,this.durationFlag&&(this.duration=e.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()),this.dependency=[];for(var n=e.readUint8(),d=0;d<n;d++){var h={};this.dependency.push(h),h.subSeqDirectionFlag=e.readUint8(),h.layerNumber=e.readUint8(),h.subSequenceIdentifier=e.readUint16()}}),s.createSampleGroupCtor("dtrt",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("mvif",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("prol",function(e){this.roll_distance=e.readInt16()}),s.createSampleGroupCtor("rap ",function(e){var t=e.readUint8();this.num_leading_samples_known=t>>7,this.num_leading_samples=t&127}),s.createSampleGroupCtor("rash",function(e){if(this.operation_point_count=e.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)r.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=e.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=e.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var t=0;t<this.operation_point_count;t++)this.available_bitrate[t]=e.readUint32(),this.target_rate_share[t]=e.readUint16()}this.maximum_bitrate=e.readUint32(),this.minimum_bitrate=e.readUint32(),this.discard_priority=e.readUint8()}}),s.createSampleGroupCtor("roll",function(e){this.roll_distance=e.readInt16()}),s.SampleGroupEntry.prototype.parse=function(e){r.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=e.readUint8Array(this.description_length)},s.createSampleGroupCtor("scif",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("scnm",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("seig",function(e){this.reserved=e.readUint8();var t=e.readUint8();this.crypt_byte_block=t>>4,this.skip_byte_block=t&15,this.isProtected=e.readUint8(),this.Per_Sample_IV_Size=e.readUint8(),this.KID=s.parseHex16(e),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=e.readUint8(),this.constant_IV=e.readUint8Array(this.constant_IV_size))}),s.createSampleGroupCtor("stsa",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("sync",function(e){var t=e.readUint8();this.NAL_unit_type=t&63}),s.createSampleGroupCtor("tele",function(e){var t=e.readUint8();this.level_independently_decodable=t>>7}),s.createSampleGroupCtor("tsas",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("tscl",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createSampleGroupCtor("vipr",function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),s.createFullBoxCtor("sbgp",function(e){this.grouping_type=e.readString(4),this.version===1?this.grouping_type_parameter=e.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var t=e.readUint32(),n=0;n<t;n++){var d={};this.entries.push(d),d.sample_count=e.readInt32(),d.group_description_index=e.readInt32()}}),s.createFullBoxCtor("schm",function(e){this.scheme_type=e.readString(4),this.scheme_version=e.readUint32(),this.flags&1&&(this.scheme_uri=e.readString(this.size-this.hdr_size-8))}),s.createBoxCtor("sdp ",function(e){this.sdptext=e.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("sdtp",function(e){var t,n=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var d=0;d<n;d++)t=e.readUint8(),this.is_leading[d]=t>>6,this.sample_depends_on[d]=t>>4&3,this.sample_is_depended_on[d]=t>>2&3,this.sample_has_redundancy[d]=t&3}),s.createFullBoxCtor("senc"),s.createFullBoxCtor("sgpd",function(e){this.grouping_type=e.readString(4),r.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=e.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=e.readUint32()),this.entries=[];for(var t=e.readUint32(),n=0;n<t;n++){var d;s[this.grouping_type+"SampleGroupEntry"]?d=new s[this.grouping_type+"SampleGroupEntry"](this.grouping_type):d=new s.SampleGroupEntry(this.grouping_type),this.entries.push(d),this.version===1?this.default_length===0?d.description_length=e.readUint32():d.description_length=this.default_length:d.description_length=this.default_length,d.write===s.SampleGroupEntry.prototype.write&&(r.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),d.data=e.readUint8Array(d.description_length),e.position-=d.description_length),d.parse(e)}}),s.createFullBoxCtor("sidx",function(e){this.reference_ID=e.readUint32(),this.timescale=e.readUint32(),this.version===0?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),e.readUint16(),this.references=[];for(var t=e.readUint16(),n=0;n<t;n++){var d={};this.references.push(d);var h=e.readUint32();d.reference_type=h>>31&1,d.referenced_size=h&2147483647,d.subsegment_duration=e.readUint32(),h=e.readUint32(),d.starts_with_SAP=h>>31&1,d.SAP_type=h>>28&7,d.SAP_delta_time=h&268435455}}),s.SingleItemTypeReferenceBox=function(e,t,n,d){s.Box.call(this,e,t),this.hdr_size=n,this.start=d},s.SingleItemTypeReferenceBox.prototype=new s.Box,s.SingleItemTypeReferenceBox.prototype.parse=function(e){this.from_item_ID=e.readUint16();var t=e.readUint16();this.references=[];for(var n=0;n<t;n++)this.references[n]={},this.references[n].to_item_ID=e.readUint16()},s.SingleItemTypeReferenceBoxLarge=function(e,t,n,d){s.Box.call(this,e,t),this.hdr_size=n,this.start=d},s.SingleItemTypeReferenceBoxLarge.prototype=new s.Box,s.SingleItemTypeReferenceBoxLarge.prototype.parse=function(e){this.from_item_ID=e.readUint32();var t=e.readUint16();this.references=[];for(var n=0;n<t;n++)this.references[n]={},this.references[n].to_item_ID=e.readUint32()},s.createFullBoxCtor("SmDm",function(e){this.primaryRChromaticity_x=e.readUint16(),this.primaryRChromaticity_y=e.readUint16(),this.primaryGChromaticity_x=e.readUint16(),this.primaryGChromaticity_y=e.readUint16(),this.primaryBChromaticity_x=e.readUint16(),this.primaryBChromaticity_y=e.readUint16(),this.whitePointChromaticity_x=e.readUint16(),this.whitePointChromaticity_y=e.readUint16(),this.luminanceMax=e.readUint32(),this.luminanceMin=e.readUint32()}),s.createFullBoxCtor("smhd",function(e){this.balance=e.readUint16(),e.readUint16()}),s.createFullBoxCtor("ssix",function(e){this.subsegments=[];for(var t=e.readUint32(),n=0;n<t;n++){var d={};this.subsegments.push(d),d.ranges=[];for(var h=e.readUint32(),g=0;g<h;g++){var p={};d.ranges.push(p),p.level=e.readUint8(),p.range_size=e.readUint24()}}}),s.createFullBoxCtor("stco",function(e){var t;if(t=e.readUint32(),this.chunk_offsets=[],this.version===0)for(var n=0;n<t;n++)this.chunk_offsets.push(e.readUint32())}),s.createFullBoxCtor("stdp",function(e){var t=(this.size-this.hdr_size)/2;this.priority=[];for(var n=0;n<t;n++)this.priority[n]=e.readUint16()}),s.createFullBoxCtor("sthd"),s.createFullBoxCtor("stri",function(e){this.switch_group=e.readUint16(),this.alternate_group=e.readUint16(),this.sub_track_id=e.readUint32();var t=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var n=0;n<t;n++)this.attribute_list[n]=e.readUint32()}),s.createFullBoxCtor("stsc",function(e){var t,n;if(t=e.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(n=0;n<t;n++)this.first_chunk.push(e.readUint32()),this.samples_per_chunk.push(e.readUint32()),this.sample_description_index.push(e.readUint32())}),s.createFullBoxCtor("stsd",function(e){var t,n,d,h;for(this.entries=[],d=e.readUint32(),t=1;t<=d;t++)if(n=s.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),n.code===s.OK)s[n.type+"SampleEntry"]?(h=new s[n.type+"SampleEntry"](n.size),h.hdr_size=n.hdr_size,h.start=n.start):(r.warn("BoxParser","Unknown sample entry type: "+n.type),h=new s.SampleEntry(n.type,n.size,n.hdr_size,n.start)),h.write===s.SampleEntry.prototype.write&&(r.info("BoxParser","SampleEntry "+h.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),h.parseDataAndRewind(e)),h.parse(e),this.entries.push(h);else return}),s.createFullBoxCtor("stsg",function(e){this.grouping_type=e.readUint32();var t=e.readUint16();this.group_description_index=[];for(var n=0;n<t;n++)this.group_description_index[n]=e.readUint32()}),s.createFullBoxCtor("stsh",function(e){var t,n;if(t=e.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(n=0;n<t;n++)this.shadowed_sample_numbers.push(e.readUint32()),this.sync_sample_numbers.push(e.readUint32())}),s.createFullBoxCtor("stss",function(e){var t,n;if(n=e.readUint32(),this.version===0)for(this.sample_numbers=[],t=0;t<n;t++)this.sample_numbers.push(e.readUint32())}),s.createFullBoxCtor("stsz",function(e){var t;if(this.sample_sizes=[],this.version===0)for(this.sample_size=e.readUint32(),this.sample_count=e.readUint32(),t=0;t<this.sample_count;t++)this.sample_size===0?this.sample_sizes.push(e.readUint32()):this.sample_sizes[t]=this.sample_size}),s.createFullBoxCtor("stts",function(e){var t,n,d;if(t=e.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(n=0;n<t;n++)this.sample_counts.push(e.readUint32()),d=e.readInt32(),d<0&&(r.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),d=1),this.sample_deltas.push(d)}),s.createFullBoxCtor("stvi",function(e){var t=e.readUint32();this.single_view_allowed=t&3,this.stereo_scheme=e.readUint32();var n=e.readUint32();this.stereo_indication_type=e.readString(n);var d,h;for(this.boxes=[];e.getPosition()<this.start+this.size;)if(d=s.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),d.code===s.OK)h=d.box,this.boxes.push(h),this[h.type]=h;else return}),s.createBoxCtor("styp",function(e){s.ftypBox.prototype.parse.call(this,e)}),s.createFullBoxCtor("stz2",function(e){var t,n;if(this.sample_sizes=[],this.version===0)if(this.reserved=e.readUint24(),this.field_size=e.readUint8(),n=e.readUint32(),this.field_size===4)for(t=0;t<n;t+=2){var d=e.readUint8();this.sample_sizes[t]=d>>4&15,this.sample_sizes[t+1]=d&15}else if(this.field_size===8)for(t=0;t<n;t++)this.sample_sizes[t]=e.readUint8();else if(this.field_size===16)for(t=0;t<n;t++)this.sample_sizes[t]=e.readUint16();else r.error("BoxParser","Error in length field in stz2 box")}),s.createFullBoxCtor("subs",function(e){var t,n,d,h;for(d=e.readUint32(),this.entries=[],t=0;t<d;t++){var g={};if(this.entries[t]=g,g.sample_delta=e.readUint32(),g.subsamples=[],h=e.readUint16(),h>0)for(n=0;n<h;n++){var p={};g.subsamples.push(p),this.version==1?p.size=e.readUint32():p.size=e.readUint16(),p.priority=e.readUint8(),p.discardable=e.readUint8(),p.codec_specific_parameters=e.readUint32()}}}),s.createFullBoxCtor("tenc",function(e){if(e.readUint8(),this.version===0)e.readUint8();else{var t=e.readUint8();this.default_crypt_byte_block=t>>4&15,this.default_skip_byte_block=t&15}this.default_isProtected=e.readUint8(),this.default_Per_Sample_IV_Size=e.readUint8(),this.default_KID=s.parseHex16(e),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=e.readUint8(),this.default_constant_IV=e.readUint8Array(this.default_constant_IV_size))}),s.createFullBoxCtor("tfdt",function(e){this.version==1?this.baseMediaDecodeTime=e.readUint64():this.baseMediaDecodeTime=e.readUint32()}),s.createFullBoxCtor("tfhd",function(e){var t=0;this.track_id=e.readUint32(),this.size-this.hdr_size>t&&this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=e.readUint64(),t+=8):this.base_data_offset=0,this.size-this.hdr_size>t&&this.flags&s.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=e.readUint32(),t+=4):this.default_sample_description_index=0,this.size-this.hdr_size>t&&this.flags&s.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=e.readUint32(),t+=4):this.default_sample_duration=0,this.size-this.hdr_size>t&&this.flags&s.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=e.readUint32(),t+=4):this.default_sample_size=0,this.size-this.hdr_size>t&&this.flags&s.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=e.readUint32(),t+=4):this.default_sample_flags=0}),s.createFullBoxCtor("tfra",function(e){this.track_ID=e.readUint32(),e.readUint24();var t=e.readUint8();this.length_size_of_traf_num=t>>4&3,this.length_size_of_trun_num=t>>2&3,this.length_size_of_sample_num=t&3,this.entries=[];for(var n=e.readUint32(),d=0;d<n;d++)this.version===1?(this.time=e.readUint64(),this.moof_offset=e.readUint64()):(this.time=e.readUint32(),this.moof_offset=e.readUint32()),this.traf_number=e["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=e["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=e["readUint"+8*(this.length_size_of_sample_num+1)]()}),s.createFullBoxCtor("tkhd",function(e){this.version==1?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint32()),e.readUint32Array(2),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16(),this.matrix=e.readInt32Array(9),this.width=e.readUint32(),this.height=e.readUint32()}),s.createBoxCtor("tmax",function(e){this.time=e.readUint32()}),s.createBoxCtor("tmin",function(e){this.time=e.readUint32()}),s.createBoxCtor("totl",function(e){this.bytessent=e.readUint32()}),s.createBoxCtor("tpay",function(e){this.bytessent=e.readUint32()}),s.createBoxCtor("tpyl",function(e){this.bytessent=e.readUint64()}),s.TrackGroupTypeBox.prototype.parse=function(e){this.parseFullHeader(e),this.track_group_id=e.readUint32()},s.createTrackGroupCtor("msrc"),s.TrackReferenceTypeBox=function(e,t,n,d){s.Box.call(this,e,t),this.hdr_size=n,this.start=d},s.TrackReferenceTypeBox.prototype=new s.Box,s.TrackReferenceTypeBox.prototype.parse=function(e){this.track_ids=e.readUint32Array((this.size-this.hdr_size)/4)},s.trefBox.prototype.parse=function(e){for(var t,n;e.getPosition()<this.start+this.size;)if(t=s.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),t.code===s.OK)n=new s.TrackReferenceTypeBox(t.type,t.size,t.hdr_size,t.start),n.write===s.Box.prototype.write&&n.type!=="mdat"&&(r.info("BoxParser","TrackReference "+n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(e)),n.parse(e),this.boxes.push(n);else return},s.createFullBoxCtor("trep",function(e){for(this.track_ID=e.readUint32(),this.boxes=[];e.getPosition()<this.start+this.size;)if(ret=s.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),ret.code===s.OK)box=ret.box,this.boxes.push(box);else return}),s.createFullBoxCtor("trex",function(e){this.track_id=e.readUint32(),this.default_sample_description_index=e.readUint32(),this.default_sample_duration=e.readUint32(),this.default_sample_size=e.readUint32(),this.default_sample_flags=e.readUint32()}),s.createBoxCtor("trpy",function(e){this.bytessent=e.readUint64()}),s.createFullBoxCtor("trun",function(e){var t=0;if(this.sample_count=e.readUint32(),t+=4,this.size-this.hdr_size>t&&this.flags&s.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=e.readInt32(),t+=4):this.data_offset=0,this.size-this.hdr_size>t&&this.flags&s.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=e.readUint32(),t+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>t)for(var n=0;n<this.sample_count;n++)this.flags&s.TRUN_FLAGS_DURATION&&(this.sample_duration[n]=e.readUint32()),this.flags&s.TRUN_FLAGS_SIZE&&(this.sample_size[n]=e.readUint32()),this.flags&s.TRUN_FLAGS_FLAGS&&(this.sample_flags[n]=e.readUint32()),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[n]=e.readUint32():this.sample_composition_time_offset[n]=e.readInt32())}),s.createFullBoxCtor("tsel",function(e){this.switch_group=e.readUint32();var t=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var n=0;n<t;n++)this.attribute_list[n]=e.readUint32()}),s.createFullBoxCtor("txtC",function(e){this.config=e.readCString()}),s.createBoxCtor("tyco",function(e){var t=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var n=0;n<t;n++)this.compatible_brands[n]=e.readString(4)}),s.createFullBoxCtor("udes",function(e){this.lang=e.readCString(),this.name=e.readCString(),this.description=e.readCString(),this.tags=e.readCString()}),s.createFullBoxCtor("uncC",function(e){var t;for(this.profile=e.readUint32(),this.component_count=e.readUint16(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],t=0;t<this.component_count;t++)this.component_index.push(e.readUint16()),this.component_bit_depth_minus_one.push(e.readUint8()),this.component_format.push(e.readUint8()),this.component_align_size.push(e.readUint8());this.sampling_type=e.readUint8(),this.interleave_type=e.readUint8(),this.block_size=e.readUint8();var n=e.readUint8();this.component_little_endian=n>>7&1,this.block_pad_lsb=n>>6&1,this.block_little_endian=n>>5&1,this.block_reversed=n>>4&1,this.pad_unknown=n>>3&1,this.pixel_size=e.readUint8(),this.row_align_size=e.readUint32(),this.tile_align_size=e.readUint32(),this.num_tile_cols_minus_one=e.readUint32(),this.num_tile_rows_minus_one=e.readUint32()}),s.createFullBoxCtor("url ",function(e){this.flags!==1&&(this.location=e.readCString())}),s.createFullBoxCtor("urn ",function(e){this.name=e.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=e.readCString())}),s.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(e){this.LiveServerManifest=e.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),s.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(e){this.system_id=s.parseHex16(e);var t=e.readUint32();t>0&&(this.data=e.readUint8Array(t))}),s.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),s.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(e){this.default_AlgorithmID=e.readUint24(),this.default_IV_size=e.readUint8(),this.default_KID=s.parseHex16(e)}),s.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(e){this.fragment_count=e.readUint8(),this.entries=[];for(var t=0;t<this.fragment_count;t++){var n={},d=0,h=0;this.version===1?(d=e.readUint64(),h=e.readUint64()):(d=e.readUint32(),h=e.readUint32()),n.absolute_time=d,n.absolute_duration=h,this.entries.push(n)}}),s.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(e){this.version===1?(this.absolute_time=e.readUint64(),this.duration=e.readUint64()):(this.absolute_time=e.readUint32(),this.duration=e.readUint32())}),s.createFullBoxCtor("vmhd",function(e){this.graphicsmode=e.readUint16(),this.opcolor=e.readUint16Array(3)}),s.createFullBoxCtor("vpcC",function(e){var t;this.version===1?(this.profile=e.readUint8(),this.level=e.readUint8(),t=e.readUint8(),this.bitDepth=t>>4,this.chromaSubsampling=t>>1&7,this.videoFullRangeFlag=t&1,this.colourPrimaries=e.readUint8(),this.transferCharacteristics=e.readUint8(),this.matrixCoefficients=e.readUint8(),this.codecIntializationDataSize=e.readUint16(),this.codecIntializationData=e.readUint8Array(this.codecIntializationDataSize)):(this.profile=e.readUint8(),this.level=e.readUint8(),t=e.readUint8(),this.bitDepth=t>>4&15,this.colorSpace=t&15,t=e.readUint8(),this.chromaSubsampling=t>>4&15,this.transferFunction=t>>1&7,this.videoFullRangeFlag=t&1,this.codecIntializationDataSize=e.readUint16(),this.codecIntializationData=e.readUint8Array(this.codecIntializationDataSize))}),s.createBoxCtor("vttC",function(e){this.text=e.readString(this.size-this.hdr_size)}),s.createFullBoxCtor("vvcC",function(e){var t,n,d={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(w){this.held_bits=w.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(w){this.held_bits=w.readUint16(),this.num_held_bits=16},extract_bits:function(w){var I=this.held_bits>>this.num_held_bits-w&(1<<w)-1;return this.num_held_bits-=w,I}};if(d.stream_read_1_bytes(e),d.extract_bits(5),this.lengthSizeMinusOne=d.extract_bits(2),this.ptl_present_flag=d.extract_bits(1),this.ptl_present_flag){d.stream_read_2_bytes(e),this.ols_idx=d.extract_bits(9),this.num_sublayers=d.extract_bits(3),this.constant_frame_rate=d.extract_bits(2),this.chroma_format_idc=d.extract_bits(2),d.stream_read_1_bytes(e),this.bit_depth_minus8=d.extract_bits(3),d.extract_bits(5);{if(d.stream_read_2_bytes(e),d.extract_bits(2),this.num_bytes_constraint_info=d.extract_bits(6),this.general_profile_idc=d.extract_bits(7),this.general_tier_flag=d.extract_bits(1),this.general_level_idc=e.readUint8(),d.stream_read_1_bytes(e),this.ptl_frame_only_constraint_flag=d.extract_bits(1),this.ptl_multilayer_enabled_flag=d.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(t=0;t<this.num_bytes_constraint_info-1;t++){var h=d.extract_bits(6);d.stream_read_1_bytes(e);var g=d.extract_bits(2);this.general_constraint_info[t]=h<<2|g}this.general_constraint_info[this.num_bytes_constraint_info-1]=d.extract_bits(6)}else d.extract_bits(6);if(this.num_sublayers>1){for(d.stream_read_1_bytes(e),this.ptl_sublayer_present_mask=0,n=this.num_sublayers-2;n>=0;--n){var p=d.extract_bits(1);this.ptl_sublayer_present_mask|=p<<n}for(n=this.num_sublayers;n<=8&&this.num_sublayers>1;++n)d.extract_bits(1);for(this.sublayer_level_idc=[],n=this.num_sublayers-2;n>=0;--n)this.ptl_sublayer_present_mask&1<<n&&(this.sublayer_level_idc[n]=e.readUint8())}if(this.ptl_num_sub_profiles=e.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(t=0;t<this.ptl_num_sub_profiles;t++)this.general_sub_profile_idc.push(e.readUint32())}this.max_picture_width=e.readUint16(),this.max_picture_height=e.readUint16(),this.avg_frame_rate=e.readUint16()}var v=12,b=13;this.nalu_arrays=[];var S=e.readUint8();for(t=0;t<S;t++){var U=[];this.nalu_arrays.push(U),d.stream_read_1_bytes(e),U.completeness=d.extract_bits(1),d.extract_bits(2),U.nalu_type=d.extract_bits(5);var F=1;for(U.nalu_type!=b&&U.nalu_type!=v&&(F=e.readUint16()),n=0;n<F;n++){var k=e.readUint16();U.push({data:e.readUint8Array(k),length:k})}}}),s.createFullBoxCtor("vvnC",function(e){var t=strm.readUint8();this.lengthSizeMinusOne=t&3}),s.SampleEntry.prototype.isVideo=function(){return!1},s.SampleEntry.prototype.isAudio=function(){return!1},s.SampleEntry.prototype.isSubtitle=function(){return!1},s.SampleEntry.prototype.isMetadata=function(){return!1},s.SampleEntry.prototype.isHint=function(){return!1},s.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},s.SampleEntry.prototype.getWidth=function(){return""},s.SampleEntry.prototype.getHeight=function(){return""},s.SampleEntry.prototype.getChannelCount=function(){return""},s.SampleEntry.prototype.getSampleRate=function(){return""},s.SampleEntry.prototype.getSampleSize=function(){return""},s.VisualSampleEntry.prototype.isVideo=function(){return!0},s.VisualSampleEntry.prototype.getWidth=function(){return this.width},s.VisualSampleEntry.prototype.getHeight=function(){return this.height},s.AudioSampleEntry.prototype.isAudio=function(){return!0},s.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},s.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},s.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},s.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},s.MetadataSampleEntry.prototype.isMetadata=function(){return!0},s.decimalToHex=function(e,t){var n=Number(e).toString(16);for(t=typeof t>"u"||t===null?t=2:t;n.length<t;)n="0"+n;return n},s.avc1SampleEntry.prototype.getCodec=s.avc2SampleEntry.prototype.getCodec=s.avc3SampleEntry.prototype.getCodec=s.avc4SampleEntry.prototype.getCodec=function(){var e=s.SampleEntry.prototype.getCodec.call(this);return this.avcC?e+"."+s.decimalToHex(this.avcC.AVCProfileIndication)+s.decimalToHex(this.avcC.profile_compatibility)+s.decimalToHex(this.avcC.AVCLevelIndication):e},s.hev1SampleEntry.prototype.getCodec=s.hvc1SampleEntry.prototype.getCodec=function(){var e,t=s.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C";break}t+=this.hvcC.general_profile_idc,t+=".";var n=this.hvcC.general_profile_compatibility,d=0;for(e=0;e<32&&(d|=n&1,e!=31);e++)d<<=1,n>>=1;t+=s.decimalToHex(d,0),t+=".",this.hvcC.general_tier_flag===0?t+="L":t+="H",t+=this.hvcC.general_level_idc;var h=!1,g="";for(e=5;e>=0;e--)(this.hvcC.general_constraint_indicator[e]||h)&&(g="."+s.decimalToHex(this.hvcC.general_constraint_indicator[e],0)+g,h=!0);t+=g}return t},s.vvc1SampleEntry.prototype.getCodec=s.vvi1SampleEntry.prototype.getCodec=function(){var e,t=s.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){t+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?t+=".H":t+=".L",t+=this.vvcC.general_level_idc;var n="";if(this.vvcC.general_constraint_info){var d=[],h=0;h|=this.vvcC.ptl_frame_only_constraint<<7,h|=this.vvcC.ptl_multilayer_enabled<<6;var g;for(e=0;e<this.vvcC.general_constraint_info.length;++e)h|=this.vvcC.general_constraint_info[e]>>2&63,d.push(h),h&&(g=e),h=this.vvcC.general_constraint_info[e]>>2&3;if(g===void 0)n=".CA";else{n=".C";var p="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",v=0,b=0;for(e=0;e<=g;++e)for(v=v<<8|d[e],b+=8;b>=5;){var S=v>>b-5&31;n+=p[S],b-=5,v&=(1<<b)-1}b&&(v<<=5-b,n+=p[v&31])}}t+=n}return t},s.mp4aSampleEntry.prototype.getCodec=function(){var e=s.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var t=this.esds.esd.getOTI(),n=this.esds.esd.getAudioConfig();return e+"."+s.decimalToHex(t)+(n?"."+n:"")}else return e},s.stxtSampleEntry.prototype.getCodec=function(){var e=s.SampleEntry.prototype.getCodec.call(this);return this.mime_format?e+"."+this.mime_format:e},s.vp08SampleEntry.prototype.getCodec=s.vp09SampleEntry.prototype.getCodec=function(){var e=s.SampleEntry.prototype.getCodec.call(this),t=this.vpcC.level;t==0&&(t="00");var n=this.vpcC.bitDepth;return n==8&&(n="08"),e+".0"+this.vpcC.profile+"."+t+"."+n},s.av01SampleEntry.prototype.getCodec=function(){var e=s.SampleEntry.prototype.getCodec.call(this),t=this.av1C.seq_level_idx_0;t<10&&(t="0"+t);var n;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?n=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(n=this.av1C.high_bitdepth===1?"10":"08"),e+"."+this.av1C.seq_profile+"."+t+(this.av1C.seq_tier_0?"H":"M")+"."+n},s.Box.prototype.writeHeader=function(e,t){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),r.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+e.getPosition()+(t||"")),this.size>l?e.writeUint32(1):(this.sizePosition=e.getPosition(),e.writeUint32(this.size)),e.writeString(this.type,null,4),this.type==="uuid"&&e.writeUint8Array(this.uuid),this.size>l&&e.writeUint64(this.size)},s.FullBox.prototype.writeHeader=function(e){this.size+=4,s.Box.prototype.writeHeader.call(this,e," v="+this.version+" f="+this.flags),e.writeUint8(this.version),e.writeUint24(this.flags)},s.Box.prototype.write=function(e){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(e),e.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(e),this.data&&e.writeUint8Array(this.data))},s.ContainerBox.prototype.write=function(e){this.size=0,this.writeHeader(e);for(var t=0;t<this.boxes.length;t++)this.boxes[t]&&(this.boxes[t].write(e),this.size+=this.boxes[t].size);r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},s.TrackReferenceTypeBox.prototype.write=function(e){this.size=this.track_ids.length*4,this.writeHeader(e),e.writeUint32Array(this.track_ids)},s.avcCBox.prototype.write=function(e){var t;for(this.size=7,t=0;t<this.SPS.length;t++)this.size+=2+this.SPS[t].length;for(t=0;t<this.PPS.length;t++)this.size+=2+this.PPS[t].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(e),e.writeUint8(this.configurationVersion),e.writeUint8(this.AVCProfileIndication),e.writeUint8(this.profile_compatibility),e.writeUint8(this.AVCLevelIndication),e.writeUint8(this.lengthSizeMinusOne+252),e.writeUint8(this.SPS.length+224),t=0;t<this.SPS.length;t++)e.writeUint16(this.SPS[t].length),e.writeUint8Array(this.SPS[t].nalu);for(e.writeUint8(this.PPS.length),t=0;t<this.PPS.length;t++)e.writeUint16(this.PPS[t].length),e.writeUint8Array(this.PPS[t].nalu);this.ext&&e.writeUint8Array(this.ext)},s.co64Box.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),t=0;t<this.chunk_offsets.length;t++)e.writeUint64(this.chunk_offsets[t])},s.cslgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(e),e.writeInt32(this.compositionToDTSShift),e.writeInt32(this.leastDecodeToDisplayDelta),e.writeInt32(this.greatestDecodeToDisplayDelta),e.writeInt32(this.compositionStartTime),e.writeInt32(this.compositionEndTime)},s.cttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),this.version===1?e.writeInt32(this.sample_offsets[t]):e.writeUint32(this.sample_offsets[t])},s.drefBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},s.elngBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(e),e.writeString(this.extended_language)},s.elstBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var n=this.entries[t];e.writeUint32(n.segment_duration),e.writeInt32(n.media_time),e.writeInt16(n.media_rate_integer),e.writeInt16(n.media_rate_fraction)}},s.emsgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(e),e.writeCString(this.scheme_id_uri),e.writeCString(this.value),e.writeUint32(this.timescale),e.writeUint32(this.presentation_time_delta),e.writeUint32(this.event_duration),e.writeUint32(this.id),e.writeUint8Array(this.message_data)},s.ftypBox.prototype.write=function(e){this.size=8+4*this.compatible_brands.length,this.writeHeader(e),e.writeString(this.major_brand,null,4),e.writeUint32(this.minor_version);for(var t=0;t<this.compatible_brands.length;t++)e.writeString(this.compatible_brands[t],null,4)},s.hdlrBox.prototype.write=function(e){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(e),e.writeUint32(0),e.writeString(this.handler,null,4),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeCString(this.name)},s.hvcCBox.prototype.write=function(e){var t,n;for(this.size=23,t=0;t<this.nalu_arrays.length;t++)for(this.size+=3,n=0;n<this.nalu_arrays[t].length;n++)this.size+=2+this.nalu_arrays[t][n].data.length;for(this.writeHeader(e),e.writeUint8(this.configurationVersion),e.writeUint8(this.general_profile_space<<6+this.general_tier_flag<<5+this.general_profile_idc),e.writeUint32(this.general_profile_compatibility),e.writeUint8Array(this.general_constraint_indicator),e.writeUint8(this.general_level_idc),e.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),e.writeUint8(this.parallelismType+252),e.writeUint8(this.chroma_format_idc+252),e.writeUint8(this.bit_depth_luma_minus8+248),e.writeUint8(this.bit_depth_chroma_minus8+248),e.writeUint16(this.avgFrameRate),e.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),e.writeUint8(this.nalu_arrays.length),t=0;t<this.nalu_arrays.length;t++)for(e.writeUint8((this.nalu_arrays[t].completeness<<7)+this.nalu_arrays[t].nalu_type),e.writeUint16(this.nalu_arrays[t].length),n=0;n<this.nalu_arrays[t].length;n++)e.writeUint16(this.nalu_arrays[t][n].data.length),e.writeUint8Array(this.nalu_arrays[t][n].data)},s.kindBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(e),e.writeCString(this.schemeURI),e.writeCString(this.value)},s.mdhdBox.prototype.write=function(e){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint16(this.language),e.writeUint16(0)},s.mehdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.fragment_duration)},s.mfhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.sequence_number)},s.mvhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint32(this.rate),e.writeUint16(this.volume<<8),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32Array(this.matrix),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(this.next_track_id)},s.SampleEntry.prototype.writeHeader=function(e){this.size=8,s.Box.prototype.writeHeader.call(this,e),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint16(this.data_reference_index)},s.SampleEntry.prototype.writeFooter=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e),this.size+=this.boxes[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},s.SampleEntry.prototype.write=function(e){this.writeHeader(e),e.writeUint8Array(this.data),this.size+=this.data.length,r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},s.VisualSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=2*7+6*4+32,e.writeUint16(0),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.width),e.writeUint16(this.height),e.writeUint32(this.horizresolution),e.writeUint32(this.vertresolution),e.writeUint32(0),e.writeUint16(this.frame_count),e.writeUint8(Math.min(31,this.compressorname.length)),e.writeString(this.compressorname,null,31),e.writeUint16(this.depth),e.writeInt16(-1),this.writeFooter(e)},s.AudioSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=2*4+3*4,e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.channel_count),e.writeUint16(this.samplesize),e.writeUint16(0),e.writeUint16(0),e.writeUint32(this.samplerate<<16),this.writeFooter(e)},s.stppSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,e.writeCString(this.namespace),e.writeCString(this.schema_location),e.writeCString(this.auxiliary_mime_types),this.writeFooter(e)},s.SampleGroupEntry.prototype.write=function(e){e.writeUint8Array(this.data)},s.sbgpBox.prototype.write=function(e){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(e),e.writeString(this.grouping_type,null,4),e.writeUint32(this.grouping_type_parameter),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var n=this.entries[t];e.writeInt32(n.sample_count),e.writeInt32(n.group_description_index)}},s.sgpdBox.prototype.write=function(e){var t,n;for(this.flags=0,this.size=12,t=0;t<this.entries.length;t++)n=this.entries[t],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=n.data.length);for(this.writeHeader(e),e.writeString(this.grouping_type,null,4),this.version===1&&e.writeUint32(this.default_length),this.version>=2&&e.writeUint32(this.default_sample_description_index),e.writeUint32(this.entries.length),t=0;t<this.entries.length;t++)n=this.entries[t],this.version===1&&this.default_length===0&&e.writeUint32(n.description_length),n.write(e)},s.sidxBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(e),e.writeUint32(this.reference_ID),e.writeUint32(this.timescale),e.writeUint32(this.earliest_presentation_time),e.writeUint32(this.first_offset),e.writeUint16(0),e.writeUint16(this.references.length);for(var t=0;t<this.references.length;t++){var n=this.references[t];e.writeUint32(n.reference_type<<31|n.referenced_size),e.writeUint32(n.subsegment_duration),e.writeUint32(n.starts_with_SAP<<31|n.SAP_type<<28|n.SAP_delta_time)}},s.smhdBox.prototype.write=function(e){this.version=0,this.flags=1,this.size=4,this.writeHeader(e),e.writeUint16(this.balance),e.writeUint16(0)},s.stcoBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),e.writeUint32Array(this.chunk_offsets)},s.stscBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(e),e.writeUint32(this.first_chunk.length),t=0;t<this.first_chunk.length;t++)e.writeUint32(this.first_chunk[t]),e.writeUint32(this.samples_per_chunk[t]),e.writeUint32(this.sample_description_index[t])},s.stsdBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(e),e.writeUint32(this.entries.length),this.size+=4,t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},s.stshBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(e),e.writeUint32(this.shadowed_sample_numbers.length),t=0;t<this.shadowed_sample_numbers.length;t++)e.writeUint32(this.shadowed_sample_numbers[t]),e.writeUint32(this.sync_sample_numbers[t])},s.stssBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(e),e.writeUint32(this.sample_numbers.length),e.writeUint32Array(this.sample_numbers)},s.stszBox.prototype.write=function(e){var t,n=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(t=0;t+1<this.sample_sizes.length;)if(this.sample_sizes[t+1]!==this.sample_sizes[0]){n=!1;break}else t++;else n=!1;this.size=8,n||(this.size+=4*this.sample_sizes.length),this.writeHeader(e),n?e.writeUint32(this.sample_sizes[0]):e.writeUint32(0),e.writeUint32(this.sample_sizes.length),n||e.writeUint32Array(this.sample_sizes)},s.sttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),e.writeUint32(this.sample_deltas[t])},s.tfdtBox.prototype.write=function(e){var t=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>t?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(e),this.version===1?e.writeUint64(this.baseMediaDecodeTime):e.writeUint32(this.baseMediaDecodeTime)},s.tfhdBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(e),e.writeUint32(this.track_id),this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&e.writeUint64(this.base_data_offset),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&e.writeUint32(this.default_sample_description_index),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&e.writeUint32(this.default_sample_duration),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&e.writeUint32(this.default_sample_size),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&e.writeUint32(this.default_sample_flags)},s.tkhdBox.prototype.write=function(e){this.version=0,this.size=4*18+2*4,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.track_id),e.writeUint32(0),e.writeUint32(this.duration),e.writeUint32(0),e.writeUint32(0),e.writeInt16(this.layer),e.writeInt16(this.alternate_group),e.writeInt16(this.volume<<8),e.writeUint16(0),e.writeInt32Array(this.matrix),e.writeUint32(this.width),e.writeUint32(this.height)},s.trexBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(e),e.writeUint32(this.track_id),e.writeUint32(this.default_sample_description_index),e.writeUint32(this.default_sample_duration),e.writeUint32(this.default_sample_size),e.writeUint32(this.default_sample_flags)},s.trunBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&s.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&s.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&s.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(e),e.writeUint32(this.sample_count),this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=e.getPosition(),e.writeInt32(this.data_offset)),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&e.writeUint32(this.first_sample_flags);for(var t=0;t<this.sample_count;t++)this.flags&s.TRUN_FLAGS_DURATION&&e.writeUint32(this.sample_duration[t]),this.flags&s.TRUN_FLAGS_SIZE&&e.writeUint32(this.sample_size[t]),this.flags&s.TRUN_FLAGS_FLAGS&&e.writeUint32(this.sample_flags[t]),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?e.writeUint32(this.sample_composition_time_offset[t]):e.writeInt32(this.sample_composition_time_offset[t]))},s["url Box"].prototype.write=function(e){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(e),this.location&&e.writeCString(this.location)},s["urn Box"].prototype.write=function(e){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(e),e.writeCString(this.name),this.location&&e.writeCString(this.location)},s.vmhdBox.prototype.write=function(e){this.version=0,this.flags=1,this.size=8,this.writeHeader(e),e.writeUint16(this.graphicsmode),e.writeUint16Array(this.opcolor)},s.cttsBox.prototype.unpack=function(e){var t,n,d;for(d=0,t=0;t<this.sample_counts.length;t++)for(n=0;n<this.sample_counts[t];n++)e[d].pts=e[d].dts+this.sample_offsets[t],d++},s.sttsBox.prototype.unpack=function(e){var t,n,d;for(d=0,t=0;t<this.sample_counts.length;t++)for(n=0;n<this.sample_counts[t];n++)d===0?e[d].dts=0:e[d].dts=e[d-1].dts+this.sample_deltas[t],d++},s.stcoBox.prototype.unpack=function(e){var t;for(t=0;t<this.chunk_offsets.length;t++)e[t].offset=this.chunk_offsets[t]},s.stscBox.prototype.unpack=function(e){var t,n,d,h,g;for(h=0,g=0,t=0;t<this.first_chunk.length;t++)for(n=0;n<(t+1<this.first_chunk.length?this.first_chunk[t+1]:1/0);n++)for(g++,d=0;d<this.samples_per_chunk[t];d++){if(e[h])e[h].description_index=this.sample_description_index[t],e[h].chunk_index=g;else return;h++}},s.stszBox.prototype.unpack=function(e){var t;for(t=0;t<this.sample_sizes.length;t++)e[t].size=this.sample_sizes[t]},s.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],s.boxEqualFields=function(e,t){if(e&&!t)return!1;var n;for(n in e)if(!(s.DIFF_BOXES_PROP_NAMES.indexOf(n)>-1)){if(e[n]instanceof s.Box||t[n]instanceof s.Box||typeof e[n]>"u"||typeof t[n]>"u"||typeof e[n]=="function"||typeof t[n]=="function"||e.subBoxNames&&e.subBoxNames.indexOf(n.slice(0,4))>-1||t.subBoxNames&&t.subBoxNames.indexOf(n.slice(0,4))>-1||n==="data"||n==="start"||n==="size"||n==="creation_time"||n==="modification_time"||s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(n)>-1)continue;if(e[n]!==t[n])return!1}return!0},s.boxEqual=function(e,t){if(!s.boxEqualFields(e,t))return!1;for(var n=0;n<s.DIFF_BOXES_PROP_NAMES.length;n++){var d=s.DIFF_BOXES_PROP_NAMES[n];if(e[d]&&t[d]&&!s.boxEqual(e[d],t[d]))return!1}return!0};var _=function(){};_.prototype.parseSample=function(e){var t={},n;t.resources=[];var d=new a(e.data.buffer);if(!e.subsamples||e.subsamples.length===0)t.documentString=d.readString(e.data.length);else if(t.documentString=d.readString(e.subsamples[0].size),e.subsamples.length>1)for(n=1;n<e.subsamples.length;n++)t.resources[n]=d.readUint8Array(e.subsamples[n].size);return typeof DOMParser<"u"&&(t.document=new DOMParser().parseFromString(t.documentString,"application/xml")),t};var y=function(){};y.prototype.parseSample=function(e){var t,n=new a(e.data.buffer);return t=n.readString(e.data.length),t},y.prototype.parseConfig=function(e){var t,n=new a(e.buffer);return n.readUint32(),t=n.readCString(),t},c.XMLSubtitlein4Parser=_,c.Textin4Parser=y;var m=function(e){this.stream=e||new u,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};m.prototype.setSegmentOptions=function(e,t,n){var d=this.getTrackById(e);if(d){var h={};this.fragmentedTracks.push(h),h.id=e,h.user=t,h.trak=d,d.nextSample=0,h.segmentStream=null,h.nb_samples=1e3,h.rapAlignement=!0,n&&(n.nbSamples&&(h.nb_samples=n.nbSamples),n.rapAlignement&&(h.rapAlignement=n.rapAlignement))}},m.prototype.unsetSegmentOptions=function(e){for(var t=-1,n=0;n<this.fragmentedTracks.length;n++){var d=this.fragmentedTracks[n];d.id==e&&(t=n)}t>-1&&this.fragmentedTracks.splice(t,1)},m.prototype.setExtractionOptions=function(e,t,n){var d=this.getTrackById(e);if(d){var h={};this.extractedTracks.push(h),h.id=e,h.user=t,h.trak=d,d.nextSample=0,h.nb_samples=1e3,h.samples=[],n&&n.nbSamples&&(h.nb_samples=n.nbSamples)}},m.prototype.unsetExtractionOptions=function(e){for(var t=-1,n=0;n<this.extractedTracks.length;n++){var d=this.extractedTracks[n];d.id==e&&(t=n)}t>-1&&this.extractedTracks.splice(t,1)},m.prototype.parse=function(){var e,t,n=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),e=s.parseOneBox(this.stream,n),e.code===s.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(e))continue;return}else return;else{var d;switch(t=e.box,d=t.type!=="uuid"?t.type:t.uuid,this.boxes.push(t),d){case"mdat":this.mdats.push(t);break;case"moof":this.moofs.push(t);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[d]!==void 0&&r.warn("ISOFile","Duplicate Box of type: "+d+", overriding previous occurrence"),this[d]=t;break}this.updateUsedBytes&&this.updateUsedBytes(t,e)}},m.prototype.checkBuffer=function(e){if(e==null)throw"Buffer must be defined and non empty";if(e.fileStart===void 0)throw"Buffer must have a fileStart property";return e.byteLength===0?(r.warn("ISOFile","Ignoring empty buffer (fileStart: "+e.fileStart+")"),this.stream.logBufferLevel(),!1):(r.info("ISOFile","Processing buffer (fileStart: "+e.fileStart+")"),e.usedBytes=0,this.stream.insertBuffer(e),this.stream.logBufferLevel(),this.stream.initialized()?!0:(r.warn("ISOFile","Not ready to start parsing"),!1))},m.prototype.appendBuffer=function(e,t){var n;if(this.checkBuffer(e))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(t),this.nextSeekPosition?(n=this.nextSeekPosition,this.nextSeekPosition=void 0):n=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(n=this.stream.getEndFilePositionAfter(n))):this.nextParsePosition?n=this.nextParsePosition:n=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(r.info("ISOFile","Done processing buffer (fileStart: "+e.fileStart+") - next buffer to fetch should have a fileStart position of "+n),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),r.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),n},m.prototype.getInfo=function(){var e,t,n={},d,h,g,p,v=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(n.hasMoov=!0,n.duration=this.moov.mvhd.duration,n.timescale=this.moov.mvhd.timescale,n.isFragmented=this.moov.mvex!=null,n.isFragmented&&this.moov.mvex.mehd&&(n.fragment_duration=this.moov.mvex.mehd.fragment_duration),n.isProgressive=this.isProgressive,n.hasIOD=this.moov.iods!=null,n.brands=[],n.brands.push(this.ftyp.major_brand),n.brands=n.brands.concat(this.ftyp.compatible_brands),n.created=new Date(v+this.moov.mvhd.creation_time*1e3),n.modified=new Date(v+this.moov.mvhd.modification_time*1e3),n.tracks=[],n.audioTracks=[],n.videoTracks=[],n.subtitleTracks=[],n.metadataTracks=[],n.hintTracks=[],n.otherTracks=[],e=0;e<this.moov.traks.length;e++){if(d=this.moov.traks[e],p=d.mdia.minf.stbl.stsd.entries[0],h={},n.tracks.push(h),h.id=d.tkhd.track_id,h.name=d.mdia.hdlr.name,h.references=[],d.tref)for(t=0;t<d.tref.boxes.length;t++)g={},h.references.push(g),g.type=d.tref.boxes[t].type,g.track_ids=d.tref.boxes[t].track_ids;d.edts&&(h.edits=d.edts.elst.entries),h.created=new Date(v+d.tkhd.creation_time*1e3),h.modified=new Date(v+d.tkhd.modification_time*1e3),h.movie_duration=d.tkhd.duration,h.movie_timescale=n.timescale,h.layer=d.tkhd.layer,h.alternate_group=d.tkhd.alternate_group,h.volume=d.tkhd.volume,h.matrix=d.tkhd.matrix,h.track_width=d.tkhd.width/65536,h.track_height=d.tkhd.height/65536,h.timescale=d.mdia.mdhd.timescale,h.cts_shift=d.mdia.minf.stbl.cslg,h.duration=d.mdia.mdhd.duration,h.samples_duration=d.samples_duration,h.codec=p.getCodec(),h.kind=d.udta&&d.udta.kinds.length?d.udta.kinds[0]:{schemeURI:"",value:""},h.language=d.mdia.elng?d.mdia.elng.extended_language:d.mdia.mdhd.languageString,h.nb_samples=d.samples.length,h.size=d.samples_size,h.bitrate=h.size*8*h.timescale/h.samples_duration,p.isAudio()?(h.type="audio",n.audioTracks.push(h),h.audio={},h.audio.sample_rate=p.getSampleRate(),h.audio.channel_count=p.getChannelCount(),h.audio.sample_size=p.getSampleSize()):p.isVideo()?(h.type="video",n.videoTracks.push(h),h.video={},h.video.width=p.getWidth(),h.video.height=p.getHeight()):p.isSubtitle()?(h.type="subtitles",n.subtitleTracks.push(h)):p.isHint()?(h.type="metadata",n.hintTracks.push(h)):p.isMetadata()?(h.type="metadata",n.metadataTracks.push(h)):(h.type="metadata",n.otherTracks.push(h))}else n.hasMoov=!1;if(n.mime="",n.hasMoov&&n.tracks){for(n.videoTracks&&n.videoTracks.length>0?n.mime+='video/mp4; codecs="':n.audioTracks&&n.audioTracks.length>0?n.mime+='audio/mp4; codecs="':n.mime+='application/mp4; codecs="',e=0;e<n.tracks.length;e++)e!==0&&(n.mime+=","),n.mime+=n.tracks[e].codec;n.mime+='"; profiles="',n.mime+=this.ftyp.compatible_brands.join(),n.mime+='"'}return n},m.prototype.setNextSeekPositionFromSample=function(e){e&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(e.offset+e.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=e.offset+e.alreadyRead)},m.prototype.processSamples=function(e){var t,n;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(t=0;t<this.fragmentedTracks.length;t++){var d=this.fragmentedTracks[t];for(n=d.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){r.debug("ISOFile","Creating media fragment on track #"+d.id+" for sample "+n.nextSample);var h=this.createFragment(d.id,n.nextSample,d.segmentStream);if(h)d.segmentStream=h,n.nextSample++;else break;if((n.nextSample%d.nb_samples===0||e||n.nextSample>=n.samples.length)&&(r.info("ISOFile","Sending fragmented data on track #"+d.id+" for samples ["+Math.max(0,n.nextSample-d.nb_samples)+","+(n.nextSample-1)+"]"),r.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(d.id,d.user,d.segmentStream.buffer,n.nextSample,e||n.nextSample>=n.samples.length),d.segmentStream=null,d!==this.fragmentedTracks[t]))break}}if(this.onSamples!==null)for(t=0;t<this.extractedTracks.length;t++){var g=this.extractedTracks[t];for(n=g.trak;n.nextSample<n.samples.length&&this.sampleProcessingStarted;){r.debug("ISOFile","Exporting on track #"+g.id+" sample #"+n.nextSample);var p=this.getSample(n,n.nextSample);if(p)n.nextSample++,g.samples.push(p);else{this.setNextSeekPositionFromSample(n.samples[n.nextSample]);break}if((n.nextSample%g.nb_samples===0||n.nextSample>=n.samples.length)&&(r.debug("ISOFile","Sending samples on track #"+g.id+" for sample "+n.nextSample),this.onSamples&&this.onSamples(g.id,g.user,g.samples),g.samples=[],g!==this.extractedTracks[t]))break}}}},m.prototype.getBox=function(e){var t=this.getBoxes(e,!0);return t.length?t[0]:null},m.prototype.getBoxes=function(e,t){var n=[];return m._sweep.call(this,e,n,t),n},m._sweep=function(e,t,n){this.type&&this.type==e&&t.push(this);for(var d in this.boxes){if(t.length&&n)return;m._sweep.call(this.boxes[d],e,t,n)}},m.prototype.getTrackSamplesInfo=function(e){var t=this.getTrackById(e);if(t)return t.samples},m.prototype.getTrackSample=function(e,t){var n=this.getTrackById(e),d=this.getSample(n,t);return d},m.prototype.releaseUsedSamples=function(e,t){var n=0,d=this.getTrackById(e);d.lastValidSample||(d.lastValidSample=0);for(var h=d.lastValidSample;h<t;h++)n+=this.releaseSample(d,h);r.info("ISOFile","Track #"+e+" released samples up to "+t+" (released size: "+n+", remaining: "+this.samplesDataSize+")"),d.lastValidSample=t},m.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},m.prototype.stop=function(){this.sampleProcessingStarted=!1},m.prototype.flush=function(){r.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},m.prototype.seekTrack=function(e,t,n){var d,h,g=1/0,p=0,v=0,b;if(n.samples.length===0)return r.info("ISOFile","No sample in track, cannot seek! Using time "+r.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(d=0;d<n.samples.length;d++){if(h=n.samples[d],d===0)v=0,b=h.timescale;else if(h.cts>e*h.timescale){v=d-1;break}t&&h.is_sync&&(p=d)}for(t&&(v=p),e=n.samples[v].cts,n.nextSample=v;n.samples[v].alreadyRead===n.samples[v].size&&n.samples[v+1];)v++;return g=n.samples[v].offset+n.samples[v].alreadyRead,r.info("ISOFile","Seeking to "+(t?"RAP":"")+" sample #"+n.nextSample+" on track "+n.tkhd.track_id+", time "+r.getDurationString(e,b)+" and offset: "+g),{offset:g,time:e/b}},m.prototype.getTrackDuration=function(e){var t;return e.samples?(t=e.samples[e.samples.length-1],(t.cts+t.duration)/t.timescale):1/0},m.prototype.seek=function(e,t){var n=this.moov,d,h,g,p={offset:1/0,time:1/0};if(this.moov){for(g=0;g<n.traks.length;g++)d=n.traks[g],!(e>this.getTrackDuration(d))&&(h=this.seekTrack(e,t,d),h.offset<p.offset&&(p.offset=h.offset),h.time<p.time&&(p.time=h.time));return r.info("ISOFile","Seeking at time "+r.getDurationString(p.time,1)+" needs a buffer with a fileStart position of "+p.offset),p.offset===1/0?p={offset:this.nextParsePosition,time:0}:p.offset=this.stream.getEndFilePositionAfter(p.offset),r.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+p.offset),p}else throw"Cannot seek: moov not received!"},m.prototype.equal=function(e){for(var t=0;t<this.boxes.length&&t<e.boxes.length;){var n=this.boxes[t],d=e.boxes[t];if(!s.boxEqual(n,d))return!1;t++}return!0},c.ISOFile=m,m.prototype.lastBoxStartPosition=0,m.prototype.parsingMdat=null,m.prototype.nextParsePosition=0,m.prototype.discardMdatData=!1,m.prototype.processIncompleteBox=function(e){var t,n,d;return e.type==="mdat"?(t=new s[e.type+"Box"](e.size),this.parsingMdat=t,this.boxes.push(t),this.mdats.push(t),t.start=e.start,t.hdr_size=e.hdr_size,this.stream.addUsedBytes(t.hdr_size),this.lastBoxStartPosition=t.start+t.size,d=this.stream.seek(t.start+t.size,!1,this.discardMdatData),d?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=t.start+t.size,!1)):(e.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),n=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,n?(this.nextParsePosition=this.stream.getEndPosition(),!0):(e.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+e.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},m.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},m.prototype.processIncompleteMdat=function(){var e,t;return e=this.parsingMdat,t=this.stream.seek(e.start+e.size,!1,this.discardMdatData),t?(r.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},m.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},m.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},m.prototype.updateUsedBytes=function(e,t){this.stream.addUsedBytes&&(e.type==="mdat"?(this.stream.addUsedBytes(e.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(e.size-e.hdr_size)):this.stream.addUsedBytes(e.size))},m.prototype.add=s.Box.prototype.add,m.prototype.addBox=s.Box.prototype.addBox,m.prototype.init=function(e){var t=e||{};this.add("ftyp").set("major_brand",t.brands&&t.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",t.brands||["iso4"]);var n=this.add("moov");return n.add("mvhd").set("timescale",t.timescale||600).set("rate",t.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",t.duration||0).set("volume",t.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),n.add("mvex"),this},m.prototype.addTrack=function(e){this.moov||this.init(e);var t=e||{};t.width=t.width||320,t.height=t.height||320,t.id=t.id||this.moov.mvhd.next_track_id,t.type=t.type||"avc1";var n=this.moov.add("trak");this.moov.mvhd.next_track_id=t.id+1,n.add("tkhd").set("flags",s.TKHD_FLAG_ENABLED|s.TKHD_FLAG_IN_MOVIE|s.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",t.id).set("duration",t.duration||0).set("layer",t.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",t.width<<16).set("height",t.height<<16);var d=n.add("mdia");d.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",t.timescale||1).set("duration",t.media_duration||0).set("language",t.language||"und"),d.add("hdlr").set("handler",t.hdlr||"vide").set("name",t.name||"Track created with MP4Box.js"),d.add("elng").set("extended_language",t.language||"fr-FR");var h=d.add("minf");if(s[t.type+"SampleEntry"]!==void 0){var g=new s[t.type+"SampleEntry"];g.data_reference_index=1;var p="";for(var v in s.sampleEntryCodes)for(var b=s.sampleEntryCodes[v],S=0;S<b.length;S++)if(b.indexOf(t.type)>-1){p=v;break}switch(p){case"Visual":if(h.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),g.set("width",t.width).set("height",t.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",t.type+" Compressor").set("depth",24),t.avcDecoderConfigRecord){var U=new s.avcCBox;U.parse(new a(t.avcDecoderConfigRecord)),g.addBox(U)}else if(t.hevcDecoderConfigRecord){var F=new s.hvcCBox;F.parse(new a(t.hevcDecoderConfigRecord)),g.addBox(F)}break;case"Audio":h.add("smhd").set("balance",t.balance||0),g.set("channel_count",t.channel_count||2).set("samplesize",t.samplesize||16).set("samplerate",t.samplerate||65536);break;case"Hint":h.add("hmhd");break;case"Subtitle":switch(h.add("sthd"),t.type){case"stpp":g.set("namespace",t.namespace||"nonamespace").set("schema_location",t.schema_location||"").set("auxiliary_mime_types",t.auxiliary_mime_types||"");break}break;case"Metadata":h.add("nmhd");break;case"System":h.add("nmhd");break;default:h.add("nmhd");break}t.description&&g.addBox(t.description),t.description_boxes&&t.description_boxes.forEach(function(w){g.addBox(w)}),h.add("dinf").add("dref").addEntry(new s["url Box"]().set("flags",1));var k=h.add("stbl");return k.add("stsd").addEntry(g),k.add("stts").set("sample_counts",[]).set("sample_deltas",[]),k.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),k.add("stco").set("chunk_offsets",[]),k.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",t.id).set("default_sample_description_index",t.default_sample_description_index||1).set("default_sample_duration",t.default_sample_duration||0).set("default_sample_size",t.default_sample_size||0).set("default_sample_flags",t.default_sample_flags||0),this.buildTrakSampleLists(n),t.id}},s.Box.prototype.computeSize=function(e){var t=e||new o;t.endianness=o.BIG_ENDIAN,this.write(t)},m.prototype.addSample=function(e,t,n){var d=n||{},h={},g=this.getTrackById(e);if(g!==null){h.number=g.samples.length,h.track_id=g.tkhd.track_id,h.timescale=g.mdia.mdhd.timescale,h.description_index=d.sample_description_index?d.sample_description_index-1:0,h.description=g.mdia.minf.stbl.stsd.entries[h.description_index],h.data=t,h.size=t.byteLength,h.alreadyRead=h.size,h.duration=d.duration||1,h.cts=d.cts||0,h.dts=d.dts||0,h.is_sync=d.is_sync||!1,h.is_leading=d.is_leading||0,h.depends_on=d.depends_on||0,h.is_depended_on=d.is_depended_on||0,h.has_redundancy=d.has_redundancy||0,h.degradation_priority=d.degradation_priority||0,h.offset=0,h.subsamples=d.subsamples,g.samples.push(h),g.samples_size+=h.size,g.samples_duration+=h.duration,g.first_dts===void 0&&(g.first_dts=d.dts),this.processSamples();var p=this.createSingleSampleMoof(h);return this.addBox(p),p.computeSize(),p.trafs[0].truns[0].data_offset=p.size+8,this.add("mdat").data=new Uint8Array(t),h}},m.prototype.createSingleSampleMoof=function(e){var t=0;e.is_sync?t=1<<25:t=65536;var n=new s.moofBox;n.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var d=n.add("traf"),h=this.getTrackById(e.track_id);return d.add("tfhd").set("track_id",e.track_id).set("flags",s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),d.add("tfdt").set("baseMediaDecodeTime",e.dts-(h.first_dts||0)),d.add("trun").set("flags",s.TRUN_FLAGS_DATA_OFFSET|s.TRUN_FLAGS_DURATION|s.TRUN_FLAGS_SIZE|s.TRUN_FLAGS_FLAGS|s.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[e.duration]).set("sample_size",[e.size]).set("sample_flags",[t]).set("sample_composition_time_offset",[e.cts-e.dts]),n},m.prototype.lastMoofIndex=0,m.prototype.samplesDataSize=0,m.prototype.resetTables=function(){var e,t,n,d,h,g,p,v;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,e=0;e<this.moov.traks.length;e++){t=this.moov.traks[e],t.tkhd.duration=0,t.mdia.mdhd.duration=0,n=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,n.chunk_offsets=[],d=t.mdia.minf.stbl.stsc,d.first_chunk=[],d.samples_per_chunk=[],d.sample_description_index=[],h=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,h.sample_sizes=[],g=t.mdia.minf.stbl.stts,g.sample_counts=[],g.sample_deltas=[],p=t.mdia.minf.stbl.ctts,p&&(p.sample_counts=[],p.sample_offsets=[]),v=t.mdia.minf.stbl.stss;var b=t.mdia.minf.stbl.boxes.indexOf(v);b!=-1&&(t.mdia.minf.stbl.boxes[b]=null)}},m.initSampleGroups=function(e,t,n,d,h){var g,p,v,b;function S(U,F,k){this.grouping_type=U,this.grouping_type_parameter=F,this.sbgp=k,this.last_sample_in_run=-1,this.entry_index=-1}for(t&&(t.sample_groups_info=[]),e.sample_groups_info||(e.sample_groups_info=[]),p=0;p<n.length;p++){for(b=n[p].grouping_type+"/"+n[p].grouping_type_parameter,v=new S(n[p].grouping_type,n[p].grouping_type_parameter,n[p]),t&&(t.sample_groups_info[b]=v),e.sample_groups_info[b]||(e.sample_groups_info[b]=v),g=0;g<d.length;g++)d[g].grouping_type===n[p].grouping_type&&(v.description=d[g],v.description.used=!0);if(h)for(g=0;g<h.length;g++)h[g].grouping_type===n[p].grouping_type&&(v.fragment_description=h[g],v.fragment_description.used=!0,v.is_fragment=!0)}if(t){if(h)for(p=0;p<h.length;p++)!h[p].used&&h[p].version>=2&&(b=h[p].grouping_type+"/0",v=new S(h[p].grouping_type,0),v.is_fragment=!0,t.sample_groups_info[b]||(t.sample_groups_info[b]=v))}else for(p=0;p<d.length;p++)!d[p].used&&d[p].version>=2&&(b=d[p].grouping_type+"/0",v=new S(d[p].grouping_type,0),e.sample_groups_info[b]||(e.sample_groups_info[b]=v))},m.setSampleGroupProperties=function(e,t,n,d){var h,g;t.sample_groups=[];for(h in d)if(t.sample_groups[h]={},t.sample_groups[h].grouping_type=d[h].grouping_type,t.sample_groups[h].grouping_type_parameter=d[h].grouping_type_parameter,n>=d[h].last_sample_in_run&&(d[h].last_sample_in_run<0&&(d[h].last_sample_in_run=0),d[h].entry_index++,d[h].entry_index<=d[h].sbgp.entries.length-1&&(d[h].last_sample_in_run+=d[h].sbgp.entries[d[h].entry_index].sample_count)),d[h].entry_index<=d[h].sbgp.entries.length-1?t.sample_groups[h].group_description_index=d[h].sbgp.entries[d[h].entry_index].group_description_index:t.sample_groups[h].group_description_index=-1,t.sample_groups[h].group_description_index!==0){var p;d[h].fragment_description?p=d[h].fragment_description:p=d[h].description,t.sample_groups[h].group_description_index>0?(t.sample_groups[h].group_description_index>65535?g=(t.sample_groups[h].group_description_index>>16)-1:g=t.sample_groups[h].group_description_index-1,p&&g>=0&&(t.sample_groups[h].description=p.entries[g])):p&&p.version>=2&&p.default_group_description_index>0&&(t.sample_groups[h].description=p.entries[p.default_group_description_index-1])}},m.process_sdtp=function(e,t,n){t&&(e?(t.is_leading=e.is_leading[n],t.depends_on=e.sample_depends_on[n],t.is_depended_on=e.sample_is_depended_on[n],t.has_redundancy=e.sample_has_redundancy[n]):(t.is_leading=0,t.depends_on=0,t.is_depended_on=0,t.has_redundancy=0))},m.prototype.buildSampleLists=function(){var e,t;for(e=0;e<this.moov.traks.length;e++)t=this.moov.traks[e],this.buildTrakSampleLists(t)},m.prototype.buildTrakSampleLists=function(e){var t,n,d,h,g,p,v,b,S,U,F,k,w,I,P,R,z,T,O,L,Y,re,ee,se;if(e.samples=[],e.samples_duration=0,e.samples_size=0,n=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,d=e.mdia.minf.stbl.stsc,h=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,g=e.mdia.minf.stbl.stts,p=e.mdia.minf.stbl.ctts,v=e.mdia.minf.stbl.stss,b=e.mdia.minf.stbl.stsd,S=e.mdia.minf.stbl.subs,k=e.mdia.minf.stbl.stdp,U=e.mdia.minf.stbl.sbgps,F=e.mdia.minf.stbl.sgpds,T=-1,O=-1,L=-1,Y=-1,re=0,ee=0,se=0,m.initSampleGroups(e,null,U,F),!(typeof h>"u")){for(t=0;t<h.sample_sizes.length;t++){var V={};V.number=t,V.track_id=e.tkhd.track_id,V.timescale=e.mdia.mdhd.timescale,V.alreadyRead=0,e.samples[t]=V,V.size=h.sample_sizes[t],e.samples_size+=V.size,t===0?(I=1,w=0,V.chunk_index=I,V.chunk_run_index=w,z=d.samples_per_chunk[w],R=0,w+1<d.first_chunk.length?P=d.first_chunk[w+1]-1:P=1/0):t<z?(V.chunk_index=I,V.chunk_run_index=w):(I++,V.chunk_index=I,R=0,I<=P||(w++,w+1<d.first_chunk.length?P=d.first_chunk[w+1]-1:P=1/0),V.chunk_run_index=w,z+=d.samples_per_chunk[w]),V.description_index=d.sample_description_index[V.chunk_run_index]-1,V.description=b.entries[V.description_index],V.offset=n.chunk_offsets[V.chunk_index-1]+R,R+=V.size,t>T&&(O++,T<0&&(T=0),T+=g.sample_counts[O]),t>0?(e.samples[t-1].duration=g.sample_deltas[O],e.samples_duration+=e.samples[t-1].duration,V.dts=e.samples[t-1].dts+e.samples[t-1].duration):V.dts=0,p?(t>=L&&(Y++,L<0&&(L=0),L+=p.sample_counts[Y]),V.cts=e.samples[t].dts+p.sample_offsets[Y]):V.cts=V.dts,v?(t==v.sample_numbers[re]-1?(V.is_sync=!0,re++):(V.is_sync=!1,V.degradation_priority=0),S&&S.entries[ee].sample_delta+se==t+1&&(V.subsamples=S.entries[ee].subsamples,se+=S.entries[ee].sample_delta,ee++)):V.is_sync=!0,m.process_sdtp(e.mdia.minf.stbl.sdtp,V,V.number),k?V.degradation_priority=k.priority[t]:V.degradation_priority=0,S&&S.entries[ee].sample_delta+se==t&&(V.subsamples=S.entries[ee].subsamples,se+=S.entries[ee].sample_delta),(U.length>0||F.length>0)&&m.setSampleGroupProperties(e,V,t,e.sample_groups_info)}t>0&&(e.samples[t-1].duration=Math.max(e.mdia.mdhd.duration-e.samples[t-1].dts,0),e.samples_duration+=e.samples[t-1].duration)}},m.prototype.updateSampleLists=function(){var e,t,n,d,h,g,p,v,b,S,U,F,k,w,I;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(b=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,b.type=="moof")for(S=b,e=0;e<S.trafs.length;e++){for(U=S.trafs[e],F=this.getTrackById(U.tfhd.track_id),k=this.getTrexById(U.tfhd.track_id),U.tfhd.flags&s.TFHD_FLAG_SAMPLE_DESC?d=U.tfhd.default_sample_description_index:d=k?k.default_sample_description_index:1,U.tfhd.flags&s.TFHD_FLAG_SAMPLE_DUR?h=U.tfhd.default_sample_duration:h=k?k.default_sample_duration:0,U.tfhd.flags&s.TFHD_FLAG_SAMPLE_SIZE?g=U.tfhd.default_sample_size:g=k?k.default_sample_size:0,U.tfhd.flags&s.TFHD_FLAG_SAMPLE_FLAGS?p=U.tfhd.default_sample_flags:p=k?k.default_sample_flags:0,U.sample_number=0,U.sbgps.length>0&&m.initSampleGroups(F,U,U.sbgps,F.mdia.minf.stbl.sgpds,U.sgpds),t=0;t<U.truns.length;t++){var P=U.truns[t];for(n=0;n<P.sample_count;n++){w={},w.moof_number=this.lastMoofIndex,w.number_in_traf=U.sample_number,U.sample_number++,w.number=F.samples.length,U.first_sample_index=F.samples.length,F.samples.push(w),w.track_id=F.tkhd.track_id,w.timescale=F.mdia.mdhd.timescale,w.description_index=d-1,w.description=F.mdia.minf.stbl.stsd.entries[w.description_index],w.size=g,P.flags&s.TRUN_FLAGS_SIZE&&(w.size=P.sample_size[n]),F.samples_size+=w.size,w.duration=h,P.flags&s.TRUN_FLAGS_DURATION&&(w.duration=P.sample_duration[n]),F.samples_duration+=w.duration,F.first_traf_merged||n>0?w.dts=F.samples[F.samples.length-2].dts+F.samples[F.samples.length-2].duration:(U.tfdt?w.dts=U.tfdt.baseMediaDecodeTime:w.dts=0,F.first_traf_merged=!0),w.cts=w.dts,P.flags&s.TRUN_FLAGS_CTS_OFFSET&&(w.cts=w.dts+P.sample_composition_time_offset[n]),I=p,P.flags&s.TRUN_FLAGS_FLAGS?I=P.sample_flags[n]:n===0&&P.flags&s.TRUN_FLAGS_FIRST_FLAG&&(I=P.first_sample_flags),w.is_sync=!(I>>16&1),w.is_leading=I>>26&3,w.depends_on=I>>24&3,w.is_depended_on=I>>22&3,w.has_redundancy=I>>20&3,w.degradation_priority=I&65535;var R=!!(U.tfhd.flags&s.TFHD_FLAG_BASE_DATA_OFFSET),z=!!(U.tfhd.flags&s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),T=!!(P.flags&s.TRUN_FLAGS_DATA_OFFSET),O=0;R?O=U.tfhd.base_data_offset:z||t===0?O=S.start:O=v,t===0&&n===0?T?w.offset=O+P.data_offset:w.offset=O:w.offset=v,v=w.offset+w.size,(U.sbgps.length>0||U.sgpds.length>0||F.mdia.minf.stbl.sbgps.length>0||F.mdia.minf.stbl.sgpds.length>0)&&m.setSampleGroupProperties(F,w,w.number_in_traf,U.sample_groups_info)}}if(U.subs){F.has_fragment_subsamples=!0;var L=U.first_sample_index;for(t=0;t<U.subs.entries.length;t++)L+=U.subs.entries[t].sample_delta,w=F.samples[L-1],w.subsamples=U.subs.entries[t].subsamples}}}},m.prototype.getSample=function(e,t){var n,d=e.samples[t];if(!this.moov)return null;if(!d.data)d.data=new Uint8Array(d.size),d.alreadyRead=0,this.samplesDataSize+=d.size,r.debug("ISOFile","Allocating sample #"+t+" on track #"+e.tkhd.track_id+" of size "+d.size+" (total: "+this.samplesDataSize+")");else if(d.alreadyRead==d.size)return d;for(;;){var h=this.stream.findPosition(!0,d.offset+d.alreadyRead,!1);if(h>-1){n=this.stream.buffers[h];var g=n.byteLength-(d.offset+d.alreadyRead-n.fileStart);if(d.size-d.alreadyRead<=g)return r.debug("ISOFile","Getting sample #"+t+" data (alreadyRead: "+d.alreadyRead+" offset: "+(d.offset+d.alreadyRead-n.fileStart)+" read size: "+(d.size-d.alreadyRead)+" full size: "+d.size+")"),o.memcpy(d.data.buffer,d.alreadyRead,n,d.offset+d.alreadyRead-n.fileStart,d.size-d.alreadyRead),n.usedBytes+=d.size-d.alreadyRead,this.stream.logBufferLevel(),d.alreadyRead=d.size,d;if(g===0)return null;r.debug("ISOFile","Getting sample #"+t+" partial data (alreadyRead: "+d.alreadyRead+" offset: "+(d.offset+d.alreadyRead-n.fileStart)+" read size: "+g+" full size: "+d.size+")"),o.memcpy(d.data.buffer,d.alreadyRead,n,d.offset+d.alreadyRead-n.fileStart,g),d.alreadyRead+=g,n.usedBytes+=g,this.stream.logBufferLevel()}else return null}},m.prototype.releaseSample=function(e,t){var n=e.samples[t];return n.data?(this.samplesDataSize-=n.size,n.data=null,n.alreadyRead=0,n.size):0},m.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},m.prototype.getCodecs=function(){var e,t="";for(e=0;e<this.moov.traks.length;e++){var n=this.moov.traks[e];e>0&&(t+=","),t+=n.mdia.minf.stbl.stsd.entries[0].getCodec()}return t},m.prototype.getTrexById=function(e){var t;if(!this.moov||!this.moov.mvex)return null;for(t=0;t<this.moov.mvex.trexs.length;t++){var n=this.moov.mvex.trexs[t];if(n.track_id==e)return n}return null},m.prototype.getTrackById=function(e){if(this.moov===void 0)return null;for(var t=0;t<this.moov.traks.length;t++){var n=this.moov.traks[t];if(n.tkhd.track_id==e)return n}return null},m.prototype.items=[],m.prototype.itemsDataSize=0,m.prototype.flattenItemInfo=function(){var e=this.items,t,n,d,h=this.meta;if(h!=null&&h.hdlr!==void 0&&h.iinf!==void 0){for(t=0;t<h.iinf.item_infos.length;t++)d={},d.id=h.iinf.item_infos[t].item_ID,e[d.id]=d,d.ref_to=[],d.name=h.iinf.item_infos[t].item_name,h.iinf.item_infos[t].protection_index>0&&(d.protection=h.ipro.protections[h.iinf.item_infos[t].protection_index-1]),h.iinf.item_infos[t].item_type?d.type=h.iinf.item_infos[t].item_type:d.type="mime",d.content_type=h.iinf.item_infos[t].content_type,d.content_encoding=h.iinf.item_infos[t].content_encoding;if(h.iloc)for(t=0;t<h.iloc.items.length;t++){var g=h.iloc.items[t];switch(d=e[g.item_ID],g.data_reference_index!==0&&(r.warn("Item storage with reference to other files: not supported"),d.source=h.dinf.boxes[g.data_reference_index-1]),g.construction_method){case 0:break;case 1:r.warn("Item storage with construction_method : not supported");break;case 2:r.warn("Item storage with construction_method : not supported");break}for(d.extents=[],d.size=0,n=0;n<g.extents.length;n++)d.extents[n]={},d.extents[n].offset=g.extents[n].extent_offset+g.base_offset,d.extents[n].length=g.extents[n].extent_length,d.extents[n].alreadyRead=0,d.size+=d.extents[n].length}if(h.pitm&&(e[h.pitm.item_id].primary=!0),h.iref)for(t=0;t<h.iref.references.length;t++){var p=h.iref.references[t];for(n=0;n<p.references.length;n++)e[p.from_item_ID].ref_to.push({type:p.type,id:p.references[n]})}if(h.iprp)for(var v=0;v<h.iprp.ipmas.length;v++){var b=h.iprp.ipmas[v];for(t=0;t<b.associations.length;t++){var S=b.associations[t];for(d=e[S.id],d.properties===void 0&&(d.properties={},d.properties.boxes=[]),n=0;n<S.props.length;n++){var U=S.props[n];if(U.property_index>0&&U.property_index-1<h.iprp.ipco.boxes.length){var F=h.iprp.ipco.boxes[U.property_index-1];d.properties[F.type]=F,d.properties.boxes.push(F)}}}}}},m.prototype.getItem=function(e){var t,n;if(!this.meta)return null;if(n=this.items[e],!n.data&&n.size)n.data=new Uint8Array(n.size),n.alreadyRead=0,this.itemsDataSize+=n.size,r.debug("ISOFile","Allocating item #"+e+" of size "+n.size+" (total: "+this.itemsDataSize+")");else if(n.alreadyRead===n.size)return n;for(var d=0;d<n.extents.length;d++){var h=n.extents[d];if(h.alreadyRead!==h.length){var g=this.stream.findPosition(!0,h.offset+h.alreadyRead,!1);if(g>-1){t=this.stream.buffers[g];var p=t.byteLength-(h.offset+h.alreadyRead-t.fileStart);if(h.length-h.alreadyRead<=p)r.debug("ISOFile","Getting item #"+e+" extent #"+d+" data (alreadyRead: "+h.alreadyRead+" offset: "+(h.offset+h.alreadyRead-t.fileStart)+" read size: "+(h.length-h.alreadyRead)+" full extent size: "+h.length+" full item size: "+n.size+")"),o.memcpy(n.data.buffer,n.alreadyRead,t,h.offset+h.alreadyRead-t.fileStart,h.length-h.alreadyRead),t.usedBytes+=h.length-h.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead+=h.length-h.alreadyRead,h.alreadyRead=h.length;else return r.debug("ISOFile","Getting item #"+e+" extent #"+d+" partial data (alreadyRead: "+h.alreadyRead+" offset: "+(h.offset+h.alreadyRead-t.fileStart)+" read size: "+p+" full extent size: "+h.length+" full item size: "+n.size+")"),o.memcpy(n.data.buffer,n.alreadyRead,t,h.offset+h.alreadyRead-t.fileStart,p),h.alreadyRead+=p,n.alreadyRead+=p,t.usedBytes+=p,this.stream.logBufferLevel(),null}else return null}}return n.alreadyRead===n.size?n:null},m.prototype.releaseItem=function(e){var t=this.items[e];if(t.data){this.itemsDataSize-=t.size,t.data=null,t.alreadyRead=0;for(var n=0;n<t.extents.length;n++){var d=t.extents[n];d.alreadyRead=0}return t.size}else return 0},m.prototype.processItems=function(e){for(var t in this.items){var n=this.items[t];this.getItem(n.id),e&&!n.sent&&(e(n),n.sent=!0,n.data=null)}},m.prototype.hasItem=function(e){for(var t in this.items){var n=this.items[t];if(n.name===e)return n.id}return-1},m.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},m.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},m.prototype.itemToFragmentedTrackFile=function(e){var t=e||{},n=null;if(t.itemId?n=this.getItem(t.itemId):n=this.getPrimaryItem(),n==null)return null;var d=new m;d.discardMdatData=!1;var h={type:n.type,description_boxes:n.properties.boxes};n.properties.ispe&&(h.width=n.properties.ispe.image_width,h.height=n.properties.ispe.image_height);var g=d.addTrack(h);return g?(d.addSample(g,n.data),d):null},m.prototype.write=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e)},m.prototype.createFragment=function(e,t,n){var d=this.getTrackById(e),h=this.getSample(d,t);if(h==null)return this.setNextSeekPositionFromSample(d.samples[t]),null;var g=n||new o;g.endianness=o.BIG_ENDIAN;var p=this.createSingleSampleMoof(h);p.write(g),p.trafs[0].truns[0].data_offset=p.size+8,r.debug("MP4Box","Adjusting data_offset with new value "+p.trafs[0].truns[0].data_offset),g.adjustUint32(p.trafs[0].truns[0].data_offset_position,p.trafs[0].truns[0].data_offset);var v=new s.mdatBox;return v.data=h.data,v.write(g),g},m.writeInitializationSegment=function(e,t,n,d){var h;r.debug("ISOFile","Generating initialization segment");var g=new o;g.endianness=o.BIG_ENDIAN,e.write(g);var p=t.add("mvex");for(n&&p.add("mehd").set("fragment_duration",n),h=0;h<t.traks.length;h++)p.add("trex").set("track_id",t.traks[h].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",d).set("default_sample_size",0).set("default_sample_flags",65536);return t.write(g),g.buffer},m.prototype.save=function(e){var t=new o;t.endianness=o.BIG_ENDIAN,this.write(t),t.save(e)},m.prototype.getBuffer=function(){var e=new o;return e.endianness=o.BIG_ENDIAN,this.write(e),e.buffer},m.prototype.initializeSegmentation=function(){var e,t,n,d;for(this.onSegment===null&&r.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),t=[],e=0;e<this.fragmentedTracks.length;e++){var h=new s.moovBox;h.mvhd=this.moov.mvhd,h.boxes.push(h.mvhd),n=this.getTrackById(this.fragmentedTracks[e].id),h.boxes.push(n),h.traks.push(n),d={},d.id=n.tkhd.track_id,d.user=this.fragmentedTracks[e].user,d.buffer=m.writeInitializationSegment(this.ftyp,h,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[e].samples.length>0?this.moov.traks[e].samples[0].duration:0),t.push(d)}return t},s.Box.prototype.printHeader=function(e){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),e.log(e.indent+"size:"+this.size),e.log(e.indent+"type:"+this.type)},s.FullBox.prototype.printHeader=function(e){this.size+=4,s.Box.prototype.printHeader.call(this,e),e.log(e.indent+"version:"+this.version),e.log(e.indent+"flags:"+this.flags)},s.Box.prototype.print=function(e){this.printHeader(e)},s.ContainerBox.prototype.print=function(e){this.printHeader(e);for(var t=0;t<this.boxes.length;t++)if(this.boxes[t]){var n=e.indent;e.indent+=" ",this.boxes[t].print(e),e.indent=n}},m.prototype.print=function(e){e.indent="";for(var t=0;t<this.boxes.length;t++)this.boxes[t]&&this.boxes[t].print(e)},s.mvhdBox.prototype.print=function(e){s.FullBox.prototype.printHeader.call(this,e),e.log(e.indent+"creation_time: "+this.creation_time),e.log(e.indent+"modification_time: "+this.modification_time),e.log(e.indent+"timescale: "+this.timescale),e.log(e.indent+"duration: "+this.duration),e.log(e.indent+"rate: "+this.rate),e.log(e.indent+"volume: "+(this.volume>>8)),e.log(e.indent+"matrix: "+this.matrix.join(", ")),e.log(e.indent+"next_track_id: "+this.next_track_id)},s.tkhdBox.prototype.print=function(e){s.FullBox.prototype.printHeader.call(this,e),e.log(e.indent+"creation_time: "+this.creation_time),e.log(e.indent+"modification_time: "+this.modification_time),e.log(e.indent+"track_id: "+this.track_id),e.log(e.indent+"duration: "+this.duration),e.log(e.indent+"volume: "+(this.volume>>8)),e.log(e.indent+"matrix: "+this.matrix.join(", ")),e.log(e.indent+"layer: "+this.layer),e.log(e.indent+"alternate_group: "+this.alternate_group),e.log(e.indent+"width: "+this.width),e.log(e.indent+"height: "+this.height)};var x={};x.createFile=function(e,t){var n=e!==void 0?e:!0,d=new m(t);return d.discardMdatData=!n,d},c.createFile=x.createFile})(un);const Hi=So(un),_e={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2"};function xo(c,r){const a=r.videoTracks[0],o={};if(a!=null){const u=Uo(c.getTrackById(a.id)).buffer,{descKey:f,type:s}=a.codec.startsWith("avc1")?{descKey:"avcDecoderConfigRecord",type:"avc1"}:a.codec.startsWith("hvc1")?{descKey:"hevcDecoderConfigRecord",type:"hvc1"}:{descKey:"",type:""};f!==""&&(o.videoTrackConf={timescale:a.timescale,duration:a.duration,width:a.video.width,height:a.video.height,brands:r.brands,type:s,[f]:u}),o.videoDecoderConf={codec:a.codec,codedHeight:a.video.height,codedWidth:a.video.width,description:u}}const l=r.audioTracks[0];if(l!=null){const u=Fr(c);o.audioTrackConf={timescale:l.timescale,samplerate:l.audio.sample_rate,channel_count:l.audio.channel_count,hdlr:"soun",type:l.codec.startsWith("mp4a")?"mp4a":l.codec,description:Fr(c)},o.audioDecoderConf={codec:l.codec.startsWith("mp4a")?_e.codec:l.codec,numberOfChannels:l.audio.channel_count,sampleRate:l.audio.sample_rate,...u==null?{}:Co(u)}}return o}function Uo(c){for(const r of c.mdia.minf.stbl.stsd.entries){const a=r.avcC??r.hvcC??r.vpcC;if(a!=null){const o=new Hi.DataStream(void 0,0,Hi.DataStream.BIG_ENDIAN);return a.write(o),new Uint8Array(o.buffer.slice(8))}}throw Error("avcC, hvcC or VPX not found")}function Fr(c,r="mp4a"){var a;const o=(a=c.moov)==null?void 0:a.traks.map(l=>l.mdia.minf.stbl.stsd.entries).flat().find(({type:l})=>l===r);return o==null?void 0:o.esds}function Eo(c){return{type:c.is_sync?"key":"delta",timestamp:1e6*c.cts/c.timescale,duration:1e6*c.duration/c.timescale,data:c.data}}function Co(c){var r;const a=(r=c.esd.descs[0])==null?void 0:r.descs[0];if(a==null)return{};const[o,l]=a.data,u=((o&7)<<1)+(l>>7),f=(l&127)>>3;return{sampleRate:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][u],numberOfChannels:f}}var Ct;class Fo{constructor(){K(this,"readable"),K(this,"writable"),M(this,Ct,0);const r=Hi.createFile();let a=!1;this.readable=new ReadableStream({start:o=>{r.onReady=u=>{var f,s;const _=(f=u.videoTracks[0])==null?void 0:f.id;_!=null&&r.setExtractionOptions(_,"video",{nbSamples:100});const y=(s=u.audioTracks[0])==null?void 0:s.id;y!=null&&r.setExtractionOptions(y,"audio",{nbSamples:100}),o.enqueue({chunkType:"ready",data:{info:u,file:r}}),r.start()};const l={};r.onSamples=(u,f,s)=>{o.enqueue({chunkType:"samples",data:{id:u,type:f,samples:s.map(_=>({..._}))}}),l[u]=(l[u]??0)+s.length,r.releaseUsedSamples(u,l[u])},r.onFlush=()=>{o.close()}},cancel:()=>{r.stop(),a=!0}},{highWaterMark:50}),this.writable=new WritableStream({write:async o=>{if(a){this.writable.abort();return}const l=o.buffer;l.fileStart=E(this,Ct),B(this,Ct,E(this,Ct)+l.byteLength),r.appendBuffer(l)},close:()=>{var o;r.flush(),r.stop(),(o=r.onFlush)==null||o.call(r)}})}}Ct=new WeakMap;let ko=0;var Qt,ei,be,le,ti,we,Ge,Ft,kt,ge,Se;const Ao=class st{constructor(r,a={audio:!0}){if(M(this,Qt,Q.create(`MP4Clip id:${ko++},`)),K(this,"ready"),M(this,ei,!1),M(this,be,{duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0}),M(this,le,void 0),M(this,ti,1),M(this,we,[]),M(this,Ge,[]),M(this,Ft,null),M(this,kt,null),M(this,ge,{video:null,audio:null}),M(this,Se,{audio:!0}),K(this,"tickInterceptor",async(l,u)=>u),!(r instanceof ReadableStream)&&!Array.isArray(r.videoSamples))throw Error("Illegal argument");B(this,Se,{...a}),B(this,ti,typeof a.audio=="object"&&"volume"in a.audio?a.audio.volume:1);const o=async l=>(await Ki(E(this,le),l),await E(this,le).stream());B(this,le,"localFile"in r?r.localFile:sn()),this.ready=(r instanceof ReadableStream?o(r).then(l=>Bo(l,E(this,Se))):Promise.resolve(r)).then(async({videoSamples:l,audioSamples:u,decoderConf:f})=>{B(this,we,l),B(this,Ge,u),B(this,ge,f);const{videoFrameFinder:s,audioFrameFinder:_}=To(f,await E(this,le).createReader(),l,u,E(this,Se).audio!==!1?E(this,ti):null);return B(this,Ft,s),B(this,kt,_),B(this,be,Io(f,l,u)),E(this,Qt).info("MP4Clip meta:",E(this,be)),{...E(this,be)}})}get meta(){return{...E(this,be)}}async tick(r){var a,o;if(r>=E(this,be).duration)return await this.tickInterceptor(r,{audio:[],state:"done"});let l=!1,u=!1,f=0;const[s,_]=await Promise.race([Promise.all([((a=E(this,kt))==null?void 0:a.find(r).then(y=>(l=!0,y)))??[],(o=E(this,Ft))==null?void 0:o.find(r).then(y=>(u=!0,y))]),new Promise((y,m)=>{f=self.setTimeout(()=>m(Error(`MP4Clip.tick timeout, ${JSON.stringify({videoReady:u,audioReady:l})}`)),3e3)})]);return clearTimeout(f),_==null?await this.tickInterceptor(r,{audio:s,state:"success"}):await this.tickInterceptor(r,{video:_,audio:s,state:"success"})}async thumbnails(r=100,a){const o=E(this,ge).video,l=await E(this,le).createReader();if(o==null||l==null)return Promise.resolve([]);const{width:u,height:f}=E(this,be),s=Mo(r,Math.round(f*(r/u)),{quality:.1,type:"image/png"});return new Promise(async _=>{const y=[];async function m(){_(await Promise.all(y.map(async d=>({ts:d.ts,img:await d.img}))))}function x(d){y.push({ts:d.timestamp,img:s(d)})}const{start:e=0,end:t=E(this,be).duration,step:n}=a??{};if(n){if(E(this,ge).video==null||E(this,we).length===0){m();return}let d=e;const h=new fn(await E(this,le).createReader(),E(this,we),E(this,ge).video);for(;d<=t;){const g=await h.find(d);g&&x(g),d+=n}m()}else{const d=await Promise.all(E(this,we).filter(p=>!p.deleted&&p.is_sync&&p.cts>=e&&p.cts<=t).map(p=>Ji(p,EncodedVideoChunk,l)));if(d.length===0){m();return}let h=0;const g=new VideoDecoder({output:p=>{h+=1,x(p),h===d.length&&m()},error:Q.error});g.configure(o),d.forEach(p=>{g.decode(p)}),await g.flush()}})}async split(r){if(await this.ready,r<=0||r>=E(this,be).duration)throw Error('"time" out of bounds');const[a,o]=No(E(this,we),r),[l,u]=Oo(E(this,Ge),r),f=new st({localFile:E(this,le),videoSamples:a,audioSamples:l,decoderConf:E(this,ge)},E(this,Se)),s=new st({localFile:E(this,le),videoSamples:o,audioSamples:u,decoderConf:E(this,ge)},E(this,Se));return await Promise.all([f.ready,s.ready]),[f,s]}async clone(){await this.ready;const r=new st({localFile:E(this,le),videoSamples:[...E(this,we)],audioSamples:[...E(this,Ge)],decoderConf:E(this,ge)},E(this,Se));return await r.ready,r.tickInterceptor=this.tickInterceptor,r}async splitTrack(){await this.ready;const r=[];if(E(this,we).length>0){const a=new st({localFile:E(this,le),videoSamples:[...E(this,we)],audioSamples:[],decoderConf:{video:E(this,ge).video,audio:null}},E(this,Se));await a.ready,a.tickInterceptor=this.tickInterceptor,r.push(a)}if(E(this,Ge).length>0){const a=new st({localFile:E(this,le),videoSamples:[],audioSamples:[...E(this,Ge)],decoderConf:{audio:E(this,ge).audio,video:null}},E(this,Se));await a.ready,a.tickInterceptor=this.tickInterceptor,r.push(a)}return r}destroy(){var r,a;E(this,ei)||(E(this,Qt).info("MP4Clip destroy"),B(this,ei,!0),(r=E(this,Ft))==null||r.destroy(),(a=E(this,kt))==null||a.destroy())}};Qt=new WeakMap,ei=new WeakMap,be=new WeakMap,le=new WeakMap,ti=new WeakMap,we=new WeakMap,Ge=new WeakMap,Ft=new WeakMap,kt=new WeakMap,ge=new WeakMap,Se=new WeakMap;let Po=Ao;function Io(c,r,a){const o={duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0};c.video!=null&&r.length>0&&(o.width=c.video.codedWidth??0,o.height=c.video.codedHeight??0),c.audio!=null&&a.length>0&&(o.audioSampleRate=_e.sampleRate,o.audioChanCount=_e.channelCount);let l=0,u=0;if(r.length>0)for(let f=r.length-1;f>=0;f--){const s=r[f];if(!s.deleted){l=s.cts+s.duration;break}}if(a.length>0){const f=a.at(-1);u=f.cts+f.duration}return o.duration=Math.max(l,u),o}function To(c,r,a,o,l){return{audioFrameFinder:l==null||c.audio==null||o.length===0?null:new zo(r,o,c.audio,{volume:l,targetSampleRate:_e.sampleRate}),videoFrameFinder:c.video==null||a.length===0?null:new fn(r,a,c.video)}}async function Bo(c,r={}){let a;const o={video:null,audio:null};let l=[],u=[];return new Promise(async(s,_)=>{let y=-1,m=-1;const x=hn(c.pipeThrough(new Fo),{onChunk:async({chunkType:e,data:t})=>{if(e==="ready"){a=t.info;let{videoDecoderConf:n,audioDecoderConf:d}=xo(t.file,t.info);o.video=n??null,o.audio=d??null,n==null&&d==null&&(x(),_(Error("MP4Clip must contain at least one video or audio track"))),Q.info("mp4BoxFile moov ready",{...t.info,tracks:null,videoTracks:null,audioTracks:null},o)}else if(e==="samples"){if(t.type==="video"){y===-1&&(y=t.samples[0].dts);for(const n of t.samples)l.push(f(n,y))}else if(t.type==="audio"&&r.audio){m===-1&&(m=t.samples[0].dts);for(const n of t.samples)u.push(f(n,m))}}},onDone:()=>{const e=l.at(-1)??u.at(-1);if(a==null){_(Error("MP4Clip stream is done, but not emit ready"));return}else if(e==null){_(Error("MP4Clip stream not contain any sample"));return}const t=l[0];t!=null&&t.cts<2e5&&(t.cts=0),Q.info("mp4 stream parsed"),s({videoSamples:l,audioSamples:u,decoderConf:o})}})});function f(s,_=0){return{...s,cts:(s.cts-_)/s.timescale*1e6,dts:(s.dts-_)/s.timescale*1e6,duration:s.duration/s.timescale*1e6,timescale:1e6,data:null}}}var Ce,At,at,He,xe,ot,lt,Pt,$i;class fn{constructor(r,a,o){M(this,Ce,null),M(this,At,0),M(this,at,{abort:!1}),K(this,"find",async l=>((E(this,Ce)==null||l<=E(this,At)||l-E(this,At)>3e6)&&E(this,$i).call(this),E(this,at).abort=!0,B(this,At,l),B(this,at,{abort:!1}),await E(this,Pt).call(this,l,E(this,Ce),E(this,at)))),M(this,He,0),M(this,xe,[]),M(this,ot,0),M(this,lt,0),M(this,Pt,async(l,u,f)=>{if(u==null||u.state==="closed"||f.abort)return null;if(E(this,xe).length>0){const s=E(this,xe)[0];return l<s.timestamp?null:(E(this,xe).shift(),l>s.timestamp+(s.duration??0)?(s.close(),E(this,Pt).call(this,l,u,f)):s)}if(E(this,ot)<E(this,lt))await cn(15);else{if(E(this,He)>=this.samples.length)return null;{let s=E(this,He)+1,_=!1;for(;s<this.samples.length;s++){const y=this.samples[s];if(!_&&!y.deleted&&l<y.cts+y.duration&&(_=!0),y.is_sync)break}if(_){const y=await Promise.all(this.samples.slice(E(this,He),s).map(m=>Ji(m,EncodedVideoChunk,this.localFileReader)));if(f.abort)return null;for(const m of y)u.decode(m);B(this,lt,E(this,lt)+y.length),u.flush().catch(Q.error)}B(this,He,s)}}return E(this,Pt).call(this,l,u,f)}),M(this,$i,()=>{var l;E(this,xe).forEach(u=>u.close()),B(this,xe,[]),B(this,He,0),B(this,lt,0),B(this,ot,0),(l=E(this,Ce))==null||l.close(),B(this,Ce,new VideoDecoder({output:u=>{B(this,ot,E(this,ot)+1),E(this,xe).push(u)},error:Q.error})),E(this,Ce).configure(this.conf)}),K(this,"destroy",()=>{var l;(l=E(this,Ce))==null||l.close(),B(this,Ce,null),E(this,at).abort=!0,E(this,xe).forEach(u=>u.close()),B(this,xe,[])}),this.localFileReader=r,this.samples=a,this.conf=o}}Ce=new WeakMap,At=new WeakMap,at=new WeakMap,He=new WeakMap,xe=new WeakMap,ot=new WeakMap,lt=new WeakMap,Pt=new WeakMap,$i=new WeakMap;var It,ii,dt,ct,Re,$e,Tt,de,ri,Yi;class zo{constructor(r,a,o,l){M(this,It,1),M(this,ii,void 0),M(this,dt,null),M(this,ct,{abort:!1}),K(this,"find",async u=>{if(E(this,dt)==null||u<=E(this,Re)||u-E(this,Re)>1e5){E(this,Yi).call(this),B(this,Re,u);for(let s=0;s<this.samples.length;s++)if(!(this.samples[s].cts<u)){B(this,$e,s);break}return[]}E(this,ct).abort=!0;const f=u-E(this,Re);return B(this,Re,u),B(this,ct,{abort:!1}),await E(this,ri).call(this,f,E(this,dt),E(this,ct))}),M(this,Re,0),M(this,$e,0),M(this,Tt,!1),M(this,de,[new Float32Array(0),new Float32Array(0)]),M(this,ri,async(u,f=null,s)=>{if(f==null||s.abort)return[];const _=Math.ceil(u*(E(this,ii)/1e6));if(_===0)return[];if(E(this,de)[0].length>_){const y=[E(this,de)[0].slice(0,_),E(this,de)[1].slice(0,_)];return E(this,de)[0]=E(this,de)[0].slice(_),E(this,de)[1]=E(this,de)[1].slice(_),y}if(E(this,Tt))await cn(15);else{if(E(this,$e)>=this.samples.length-1)return[];{const y=[];for(let m=E(this,$e);m<this.samples.length;m++){B(this,$e,m);const x=this.samples[m];if(!x.deleted){if(y.length>=10)break;y.push(x)}}B(this,Tt,!0),f.decode(await Promise.all(y.map(m=>Ji(m,EncodedAudioChunk,this.localFileReader))),(m,x)=>{if(m.length!==0){if(E(this,It)!==1)for(const e of m)for(let t=0;t<e.length;t++)e[t]*=E(this,It);m.length===1&&(m=[m[0],m[0]]),B(this,de,yo([E(this,de),m])),x&&B(this,Tt,!1)}})}}return E(this,ri).call(this,u,f,s)}),M(this,Yi,()=>{B(this,Re,0),B(this,$e,0),B(this,de,[new Float32Array(0),new Float32Array(0)]),B(this,dt,Ro(this.conf,_e.sampleRate))}),K(this,"destroy",()=>{B(this,dt,null),E(this,ct).abort=!0,B(this,de,[new Float32Array(0),new Float32Array(0)])}),this.localFileReader=r,this.samples=a,this.conf=o,B(this,It,l.volume),B(this,ii,l.targetSampleRate)}}It=new WeakMap,ii=new WeakMap,dt=new WeakMap,ct=new WeakMap,Re=new WeakMap,$e=new WeakMap,Tt=new WeakMap,de=new WeakMap,ri=new WeakMap,Yi=new WeakMap;function Ro(c,r){let a=null;const o=r!==c.sampleRate,l=Lo(([_,y])=>{a==null||a(_,y)}),u=new AudioDecoder({output:_=>{const y=vo(_),m=u.decodeQueueSize===0;o?l(async()=>[await wo(y,_.sampleRate,{rate:r,chanCount:_.numberOfChannels}),m]):a==null||a(y,m),_.close()},error:Q.error});u.configure(c);let f=[];async function s(){if(a!=null)return;const _=f.shift();if(_!=null){if(_.chunks.length<=0){_.cb([],!0),s().catch(Q.error);return}a=(y,m)=>{_.cb(y,m),m&&(a=null,s().catch(Q.error))};for(const y of _.chunks)u.decode(y)}}return{decode(_,y){f.push({chunks:_,cb:y}),s().catch(Q.error)}}}function Lo(c){const r=[];let a=0;function o(f,s){r[s]=f,l()}function l(){const f=r[a];f!=null&&(c(f),a+=1,l())}let u=0;return f=>{const s=u;u+=1,f().then(_=>o(_,s)).catch(_=>o(_,s))}}async function Ji(c,r,a){const o=await a.read(c.size,{at:c.offset});return new r(Eo({...c,data:o}))}function Mo(c,r,a){const o=new OffscreenCanvas(c,r),l=o.getContext("2d");return async u=>(l.drawImage(u,0,0,c,r),u.close(),await o.convertToBlob(a))}function No(c,r){let a=0,o=0,l=-1;for(let _=0;_<c.length;_++){const y=c[_];if(l===-1&&r<y.cts&&(l=_-1),y.is_sync)if(l===-1)a=_;else{o=_;break}}const u=c[l];if(u==null)throw Error("Not found video sample by time");const f=c.slice(0,o===0?c.length:o).map(_=>({..._}));for(let _=a;_<f.length;_++){const y=f[_];r<y.cts&&(y.deleted=!0,y.cts=-1)}const s=c.slice(u.is_sync?o:a).map(_=>({..._,cts:_.cts-r}));for(let _=0;_<o-o;_++){const y=f[_];y.cts<0&&(y.deleted=!0,y.cts=-1)}return[f,s]}function Oo(c,r){let a=-1;for(let u=0;u<c.length;u++){const f=c[u];if(!(r>f.cts)){a=u;break}}if(a===-1)throw Error("Not found audio sample by time");const o=c.slice(0,a),l=c.slice(a).map(u=>({...u,cts:u.cts-r}));return[o,l]}var mt,Me,qe,ke,Wi,pn,Ye,Fe;const Zt=class ni{constructor(r,a={}){M(this,Wi),K(this,"ready"),M(this,mt,{duration:0,width:0,height:0}),M(this,Me,new Float32Array),M(this,qe,new Float32Array),M(this,ke,void 0),M(this,Ye,0),M(this,Fe,0),B(this,ke,{loop:!1,volume:1,...a}),this.ready=rt(this,Wi,pn).call(this,r).then(()=>({width:0,height:0,duration:a.loop?1/0:E(this,mt).duration}))}get meta(){return{...E(this,mt),sampleRate:_e.sampleRate,chanCount:2}}getPCMData(){return[E(this,Me),E(this,qe)]}async tick(r){if(!E(this,ke).loop&&r>=E(this,mt).duration)return{audio:[],state:"done"};const a=r-E(this,Ye);if(r<E(this,Ye)||a>3e6)return B(this,Ye,r),B(this,Fe,Math.ceil(E(this,Ye)/1e6*_e.sampleRate)),{audio:[new Float32Array(0),new Float32Array(0)],state:"success"};B(this,Ye,r);const o=Math.ceil(a/1e6*_e.sampleRate),l=E(this,Fe)+o,u=E(this,ke).loop?[Cr(E(this,Me),E(this,Fe),l),Cr(E(this,qe),E(this,Fe),l)]:[E(this,Me).slice(E(this,Fe),l),E(this,qe).slice(E(this,Fe),l)];return B(this,Fe,l),{audio:u,state:"success"}}async split(r){await this.ready;const a=Math.ceil(r/1e6*_e.sampleRate),o=new ni(this.getPCMData().map(u=>u.slice(0,a)),E(this,ke)),l=new ni(this.getPCMData().map(u=>u.slice(a)),E(this,ke));return[o,l]}async clone(){await this.ready;const r=new ni(this.getPCMData(),E(this,ke));return await r.ready,r}destroy(){B(this,Me,new Float32Array(0)),B(this,qe,new Float32Array(0)),Q.info("---- audioclip destroy ----")}};mt=new WeakMap,Me=new WeakMap,qe=new WeakMap,ke=new WeakMap,Wi=new WeakSet,pn=async function(c){Zt.ctx==null&&(Zt.ctx=new AudioContext({sampleRate:_e.sampleRate}));const r=performance.now(),a=c instanceof ReadableStream?await Do(c,Zt.ctx):c;Q.info("Audio clip decoded complete:",performance.now()-r);const o=E(this,ke).volume;if(o!==1)for(const l of a)for(let u=0;u<l.length;u+=1)l[u]*=o;E(this,mt).duration=a[0].length/_e.sampleRate*1e6,B(this,Me,a[0]),B(this,qe,a[1]??E(this,Me)),Q.info("Audio clip convert to AudioData, time:",performance.now()-r)},Ye=new WeakMap,Fe=new WeakMap,K(Zt,"ctx",null);async function Do(c,r){const a=await new Response(c).arrayBuffer();return dn(await r.decodeAudioData(a))}var ht,si,ut,Bt;const Vo=class mn{constructor(r){K(this,"ready"),M(this,ht,{duration:0,width:0,height:0}),M(this,si,()=>{}),K(this,"audioTrack"),M(this,ut,null),M(this,Bt,void 0),B(this,Bt,r);const a=r.getVideoTracks()[0];if(a!=null){const{width:o,height:l}=a.getSettings();a.contentHint="motion",E(this,ht).width=o??0,E(this,ht).height=l??0,B(this,ut,new OffscreenCanvas(o??0,l??0)),B(this,si,Go(E(this,ut).getContext("2d"),a))}this.audioTrack=r.getAudioTracks()[0]??null,E(this,ht).duration=1/0,this.ready=Promise.resolve(this.meta)}get meta(){return{...E(this,ht)}}async tick(){return{video:E(this,ut)==null?null:await createImageBitmap(E(this,ut)),audio:[],state:"success"}}async split(){return[await this.clone(),await this.clone()]}async clone(){return new mn(E(this,Bt).clone())}destroy(){E(this,Bt).getTracks().forEach(r=>r.stop()),E(this,si).call(this)}};ht=new WeakMap,si=new WeakMap,ut=new WeakMap,Bt=new WeakMap,K(Vo,"ctx",null);function Go(c,r){return hn(new MediaStreamTrackProcessor({track:r}).readable,{onChunk:async a=>{c.drawImage(a,0,0),a.close()},onDone:async()=>{}})}var Le;class Ho{constructor(){M(this,Le,new Map),K(this,"on",(r,a)=>{const o=E(this,Le).get(r)??new Set;return o.add(a),E(this,Le).has(r)||E(this,Le).set(r,o),()=>{o.delete(a),o.size===0&&E(this,Le).delete(r)}}),K(this,"once",(r,a)=>{const o=this.on(r,(...l)=>{o(),a(...l)});return o}),K(this,"emit",(r,...a)=>{const o=E(this,Le).get(r);o!=null&&o.forEach(l=>l(...a))})}static forwardEvent(r,a,o){const l=o.map(u=>{const[f,s]=Array.isArray(u)?u:[u,u];return r.on(f,(..._)=>{a.emit(s,..._)})});return()=>{l.forEach(u=>u())}}destroy(){E(this,Le).clear()}}Le=new WeakMap;var di,ci,hi,ui,fi,pi,We,ft;const kr=class fe{constructor(r,a,o,l,u){M(this,We),M(this,di,new Ho),K(this,"on",E(this,di).on),M(this,ci,0),M(this,hi,0),M(this,ui,0),M(this,fi,0),M(this,pi,0),K(this,"master",null),K(this,"fixedAspectRatio",!1),this.x=r??0,this.y=a??0,this.w=o??0,this.h=l??0,this.master=u??null}get x(){return E(this,ci)}set x(r){rt(this,We,ft).call(this,"x",r)}get y(){return E(this,hi)}set y(r){rt(this,We,ft).call(this,"y",r)}get w(){return E(this,ui)}set w(r){rt(this,We,ft).call(this,"w",r)}get h(){return E(this,fi)}set h(r){rt(this,We,ft).call(this,"h",r)}get angle(){return E(this,pi)}set angle(r){rt(this,We,ft).call(this,"angle",r)}get center(){const{x:r,y:a,w:o,h:l}=this;return{x:r+o/2,y:a+l/2}}get ctrls(){const{w:r,h:a}=this,o=fe.CTRL_SIZE,l=o/2,u=r/2,f=a/2,s=o*1.5,_=s/2;return{...this.fixedAspectRatio?{}:{t:new fe(-l,-f-l,o,o,this),b:new fe(-l,f-l,o,o,this),l:new fe(-u-l,-l,o,o,this),r:new fe(u-l,-l,o,o,this)},lt:new fe(-u-l,-f-l,o,o,this),lb:new fe(-u-l,f-l,o,o,this),rt:new fe(u-l,-f-l,o,o,this),rb:new fe(u-l,f-l,o,o,this),rotate:new fe(-_,-f-o*2-_,s,s,this)}}clone(){const{x:r,y:a,w:o,h:l,master:u}=this,f=new fe(r,a,o,l,u);return f.angle=this.angle,f.fixedAspectRatio=this.fixedAspectRatio,f}checkHit(r,a){let{angle:o,center:l,x:u,y:f,w:s,h:_,master:y}=this;const m=(y==null?void 0:y.center)??l,x=(y==null?void 0:y.angle)??o;y==null&&(u=u-m.x,f=f-m.y);const e=r-m.x,t=a-m.y;let n=e,d=t;return x!==0&&(n=e*Math.cos(x)+t*Math.sin(x),d=t*Math.cos(x)-e*Math.sin(x)),!(n<u||n>u+s||d<f||d>f+_)}};di=new WeakMap,ci=new WeakMap,hi=new WeakMap,ui=new WeakMap,fi=new WeakMap,pi=new WeakMap,We=new WeakSet,ft=function(c,r){const a=this[c]!==r;switch(c){case"x":B(this,ci,r);break;case"y":B(this,hi,r);break;case"w":B(this,ui,r);break;case"h":B(this,fi,r);break;case"angle":B(this,pi,r);break}a&&E(this,di).emit("propsChange",{[c]:r})},K(kr,"CTRL_SIZE",16),K(kr,"CTRL_KEYS",["t","b","l","r","lt","lb","rt","rb","rotate"]);const $o={"test1.mp4":"/video/demo/bunny_0.mp4","bear.mp4":"video/bear-vp9.mp4"},Wo=()=>{const c=C.useRef({speed:1,isPlay:!1}),r=C.useRef(),a=async(l,u,f)=>{if(c.current.isPlay){Xr.warning("视频正在播放中...");return}const s=await fetch($o[u]),_=new Po(s.body);await _.ready,o(l,_,f)},o=async(l,u,f)=>{if(c.current.isPlay=!0,l===1/0){let s=0;for(;;){const{state:_,video:y}=await u.tick(s);if(_==="done"){c.current.isPlay=!1,u.destroy();break}_==="success"&&y&&(f.clearRect(0,0,f.canvas.width,f.canvas.height),f.drawImage(y,0,0,y.codedWidth,y.codedHeight,0,0,f.canvas.width,f.canvas.height),y.close()),s+=33e3}u.destroy()}else{let s=performance.now();const _=setInterval(async()=>{const{state:y,video:m}=await u.tick(Math.round((performance.now()-s)*1e3)*l);if(y==="done"){clearInterval(_),c.current.isPlay=!1,u.destroy();return}y==="success"&&m&&(f.clearRect(0,0,f.canvas.width,f.canvas.height),f.drawImage(m,0,0,m.codedWidth,m.codedHeight,0,0,f.canvas.width,f.canvas.height),m.close())},1e3/30)}};return Te.jsxs("div",{className:" w-[500px] h-[600px] flex-col flex gap-6 items-center justify-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:[Te.jsx("canvas",{width:520,height:350,ref:l=>r.current=l==null?void 0:l.getContext("2d"),className:" w-[520px] h-[350px]"}),Te.jsx(Mn,{children:Te.jsxs(Xe.Group,{defaultValue:c.current.speed,onChange:l=>c.current.speed=l.target.value,children:[Te.jsx(Xe,{value:1,children:"1倍速"}),Te.jsx(Xe,{value:3,children:"3倍速"}),Te.jsx(Xe,{value:1/0,children:"最快"}),Te.jsx(Nn,{onClick:()=>a(c.current.speed,"test1.mp4",r.current),children:"启动"})]})})]})};export{Wo as default};
